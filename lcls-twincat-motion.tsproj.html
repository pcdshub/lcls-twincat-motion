
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLC Project (1): Library &#8212; pcdshub/lcls-twincat-motion  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Library.tmc" href="Library.tmc.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="plc-project-1-library">
<h1>PLC Project (1): Library<a class="headerlink" href="#plc-project-1-library" title="Permalink to this headline">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Project</span> <span class="n">root</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">travis</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">pcdshub</span><span class="o">/</span><span class="n">lcls</span><span class="o">-</span><span class="n">twincat</span><span class="o">-</span><span class="n">motion</span><span class="o">/</span><span class="n">lcls</span><span class="o">-</span><span class="n">twincat</span><span class="o">-</span><span class="n">motion</span>
<span class="n">Project</span> <span class="n">path</span><span class="p">:</span> <span class="n">Library</span><span class="o">/</span><span class="n">Library</span><span class="o">.</span><span class="n">plcproj</span>
<span class="n">TMC</span> <span class="n">path</span><span class="p">:</span>     <span class="n">Library</span><span class="o">/</span><span class="n">Library</span><span class="o">.</span><span class="n">tmc</span>
<span class="n">AMS</span> <span class="n">ID</span><span class="p">:</span>       
<span class="n">IP</span> <span class="n">Address</span><span class="p">:</span>    <span class="p">(</span><span class="o">*</span> <span class="n">based</span> <span class="n">on</span> <span class="n">AMS</span> <span class="n">ID</span><span class="p">)</span>
<span class="n">Port</span><span class="p">:</span>         <span class="mi">851</span>

<span class="n">Source</span> <span class="n">files</span><span class="p">:</span>
    <span class="mf">1.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">DUT_MotionStage</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">2.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">DUT_PositionState</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">3.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">EL5042_Status</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">4.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">5.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_EpicsInOut</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">6.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_EpicsMotorCmd</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">7.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_MotionRequest</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">8.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">9.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">10.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">DUT_MotionPneumaticActuator</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">11.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_PnuematicActuatorPositionState</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">12.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">ST_RenishawAbsEnc</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">13.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">PlcTask</span><span class="o">.</span><span class="n">TcTTO</span>
    <span class="mf">14.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Deprecated</span><span class="o">/</span><span class="n">FB_StatePTPMove</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">15.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ImplicitChecks</span><span class="o">/</span><span class="n">CheckBounds</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">16.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ImplicitChecks</span><span class="o">/</span><span class="n">CheckDivDInt</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">17.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ImplicitChecks</span><span class="o">/</span><span class="n">CheckDivLInt</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">18.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ImplicitChecks</span><span class="o">/</span><span class="n">CheckDivLReal</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">19.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ImplicitChecks</span><span class="o">/</span><span class="n">CheckDivReal</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">20.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">FB_MotionRequest</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">21.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">FB_MotionStage</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">22.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">FB_MotionStageSim</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">23.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">FB_MotionPneumaticActuator</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">24.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Gantry</span><span class="o">/</span><span class="n">FB_GantryAutoCoupling</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">25.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Gantry</span><span class="o">/</span><span class="n">FB_GantryDiffVirtualLimitSwitch</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">26.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">States</span><span class="o">/</span><span class="n">FB_EpicsInOut</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">27.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">States</span><span class="o">/</span><span class="n">FB_PositionStateLock</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">28.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">States</span><span class="o">/</span><span class="n">FB_PositionStateManager</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">29.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">States</span><span class="o">/</span><span class="n">FB_PositionStateMove</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">30.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">States</span><span class="o">/</span><span class="n">F_AtPositionState</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">31.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Utils</span><span class="o">/</span><span class="n">FB_SetEnables</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">32.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Utils</span><span class="o">/</span><span class="n">F_MotionErrorCodeLookup</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">33.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">MotorTesting</span><span class="o">/</span><span class="n">FB_MicroStepCountTest</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">34.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">DUTs</span><span class="o">/</span><span class="n">DUT_AxisStatus_v0_01</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">35.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">GVLs</span><span class="o">/</span><span class="n">GVL</span><span class="o">.</span><span class="n">TcGVL</span>
    <span class="mf">36.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ChangeConfig</span><span class="o">/</span><span class="n">FB_ReadFloatParameter</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">37.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ChangeConfig</span><span class="o">/</span><span class="n">FB_ReadParameterInNc_v1_00</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">38.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ChangeConfig</span><span class="o">/</span><span class="n">FB_WriteFloatParameter</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">39.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ChangeConfig</span><span class="o">/</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">40.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ErrorHandling</span><span class="o">/</span><span class="n">DUT_ErrorState</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">41.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ErrorHandling</span><span class="o">/</span><span class="n">DUT_TerminalError</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">42.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ErrorHandling</span><span class="o">/</span><span class="n">FB_ErrorList</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">43.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ErrorHandling</span><span class="o">/</span><span class="n">FB_TerminalError</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">44.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ErrorHandling</span><span class="o">/</span><span class="n">GVL_ErrorSystem</span><span class="o">.</span><span class="n">TcGVL</span>
    <span class="mf">45.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ErrorHandling</span><span class="o">/</span><span class="n">ST_ErrorSystem</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">46.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Analog_Inputs</span><span class="o">/</span><span class="n">EL3174_0002</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">47.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Analog_Inputs</span><span class="o">/</span><span class="n">EL3214</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">48.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Analog_Inputs</span><span class="o">/</span><span class="n">EL3255</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">49.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Analog_Inputs</span><span class="o">/</span><span class="n">FB_CalculateFrequency_3702_v0_01</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">50.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Inputs</span><span class="o">/</span><span class="n">EL1008</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">51.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Inputs</span><span class="o">/</span><span class="n">EL1018</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">52.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Inputs</span><span class="o">/</span><span class="n">EL1808</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">53.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Inputs</span><span class="o">/</span><span class="n">EL1809</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">54.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Inputs</span><span class="o">/</span><span class="n">EL1819</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">55.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Inputs</span><span class="o">/</span><span class="n">FB_EL1252ASM_v1_00</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">56.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Outputs</span><span class="o">/</span><span class="n">EL2014</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">57.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Outputs</span><span class="o">/</span><span class="n">EL2252</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">58.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Outputs</span><span class="o">/</span><span class="n">EL2808</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">59.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Outputs</span><span class="o">/</span><span class="n">EL2819</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">60.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Outputs</span><span class="o">/</span><span class="n">External_Types</span><span class="o">/</span><span class="n">dutEL2521_Ctrl</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">61.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Digital_Outputs</span><span class="o">/</span><span class="n">External_Types</span><span class="o">/</span><span class="n">dutEL2521_Status</span><span class="o">.</span><span class="n">TcDUT</span>
    <span class="mf">62.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Measuring_Terminals</span><span class="o">/</span><span class="n">EL5002</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">63.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Measuring_Terminals</span><span class="o">/</span><span class="n">EL5021</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">64.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Measuring_Terminals</span><span class="o">/</span><span class="n">EL5042</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">65.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Measuring_Terminals</span><span class="o">/</span><span class="n">EL5101</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">66.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">EL7211_v1_00</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">67.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">EL9576_v1_00</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">68.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">System</span><span class="o">/</span><span class="n">EL9410</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">69.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">EtherCAT_Terminals</span><span class="o">/</span><span class="n">System</span><span class="o">/</span><span class="n">EL9505</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">70.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Hardware</span><span class="o">/</span><span class="n">Other</span><span class="o">/</span><span class="n">EK1200</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">71.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">FB_DriveVirtual</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">72.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">FB_NcAxis</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">73.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Homing</span><span class="o">/</span><span class="n">FB_HomeDirect</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">74.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Homing</span><span class="o">/</span><span class="n">FB_HomeFinish</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">75.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Homing</span><span class="o">/</span><span class="n">FB_HomePrepare</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">76.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Homing</span><span class="o">/</span><span class="n">FB_HomeReadNcVelocities</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">77.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Homing</span><span class="o">/</span><span class="n">FB_HomeReadSoftLimEnable</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">78.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Homing</span><span class="o">/</span><span class="n">FB_HomeToSwitch</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">79.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Homing</span><span class="o">/</span><span class="n">FB_HomeVirtual</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">80.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Homing</span><span class="o">/</span><span class="n">FB_HomeWriteNcVelocities</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">81.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">Homing</span><span class="o">/</span><span class="n">FB_HomeWriteSoftLimEnable</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">82.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">UnitTests</span><span class="o">/</span><span class="n">BasicTests</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">83.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">UnitTests</span><span class="o">/</span><span class="n">Interactive</span><span class="o">.</span><span class="n">TcPOU</span>
    <span class="mf">84.</span><span class="p">)</span> <span class="n">Library</span><span class="o">/</span><span class="n">Version</span><span class="o">/</span><span class="n">Global_Version</span><span class="o">.</span><span class="n">TcGVL</span>

<span class="n">POUs</span><span class="p">:</span>
    <span class="mf">1.</span><span class="p">)</span> <span class="n">BasicTests</span>
    <span class="mf">2.</span><span class="p">)</span> <span class="n">CheckBounds</span>
    <span class="mf">3.</span><span class="p">)</span> <span class="n">CheckDivDInt</span>
    <span class="mf">4.</span><span class="p">)</span> <span class="n">CheckDivLInt</span>
    <span class="mf">5.</span><span class="p">)</span> <span class="n">CheckDivLReal</span>
    <span class="mf">6.</span><span class="p">)</span> <span class="n">CheckDivReal</span>
    <span class="mf">7.</span><span class="p">)</span> <span class="n">EK1200</span>
    <span class="mf">8.</span><span class="p">)</span> <span class="n">EL1008</span>
    <span class="mf">9.</span><span class="p">)</span> <span class="n">EL1018</span>
    <span class="mf">10.</span><span class="p">)</span> <span class="n">EL1808</span>
    <span class="mf">11.</span><span class="p">)</span> <span class="n">EL1809</span>
    <span class="mf">12.</span><span class="p">)</span> <span class="n">EL1819</span>
    <span class="mf">13.</span><span class="p">)</span> <span class="n">EL2014</span>
    <span class="mf">14.</span><span class="p">)</span> <span class="n">EL2252</span>
    <span class="mf">15.</span><span class="p">)</span> <span class="n">EL2808</span>
    <span class="mf">16.</span><span class="p">)</span> <span class="n">EL2819</span>
    <span class="mf">17.</span><span class="p">)</span> <span class="n">EL3174_0002</span>
    <span class="mf">18.</span><span class="p">)</span> <span class="n">EL3214</span>
    <span class="mf">19.</span><span class="p">)</span> <span class="n">EL3255</span>
    <span class="mf">20.</span><span class="p">)</span> <span class="n">EL5002</span>
    <span class="mf">21.</span><span class="p">)</span> <span class="n">EL5021</span>
    <span class="mf">22.</span><span class="p">)</span> <span class="n">EL5042</span>
    <span class="mf">23.</span><span class="p">)</span> <span class="n">EL5101</span>
    <span class="mf">24.</span><span class="p">)</span> <span class="n">EL7211_v1_00</span>
    <span class="mf">25.</span><span class="p">)</span> <span class="n">EL9410</span>
    <span class="mf">26.</span><span class="p">)</span> <span class="n">EL9505</span>
    <span class="mf">27.</span><span class="p">)</span> <span class="n">EL9576_v1_00</span>
    <span class="mf">28.</span><span class="p">)</span> <span class="n">FB_CalculateFrequency_3702_v0_01</span>
    <span class="mf">29.</span><span class="p">)</span> <span class="n">FB_DriveVirtual</span>
    <span class="mf">30.</span><span class="p">)</span> <span class="n">FB_EL1252ASM_v1_00</span>
    <span class="mf">31.</span><span class="p">)</span> <span class="n">FB_EpicsInOut</span>
    <span class="mf">32.</span><span class="p">)</span> <span class="n">FB_ErrorList</span>
    <span class="mf">33.</span><span class="p">)</span> <span class="n">FB_GantryAutoCoupling</span>
    <span class="mf">34.</span><span class="p">)</span> <span class="n">FB_GantryDiffVirtualLimitSwitch</span>
    <span class="mf">35.</span><span class="p">)</span> <span class="n">FB_HomeDirect</span>
    <span class="mf">36.</span><span class="p">)</span> <span class="n">FB_HomeFinish</span>
    <span class="mf">37.</span><span class="p">)</span> <span class="n">FB_HomePrepare</span>
    <span class="mf">38.</span><span class="p">)</span> <span class="n">FB_HomeReadNcVelocities</span>
    <span class="mf">39.</span><span class="p">)</span> <span class="n">FB_HomeReadSoftLimEnable</span>
    <span class="mf">40.</span><span class="p">)</span> <span class="n">FB_HomeToSwitch</span>
    <span class="mf">41.</span><span class="p">)</span> <span class="n">FB_HomeVirtual</span>
    <span class="mf">42.</span><span class="p">)</span> <span class="n">FB_HomeWriteNcVelocities</span>
    <span class="mf">43.</span><span class="p">)</span> <span class="n">FB_HomeWriteSoftLimEnable</span>
    <span class="mf">44.</span><span class="p">)</span> <span class="n">FB_MicroStepCountTest</span>
    <span class="mf">45.</span><span class="p">)</span> <span class="n">FB_MotionPneumaticActuator</span>
    <span class="mf">46.</span><span class="p">)</span> <span class="n">FB_MotionRequest</span>
    <span class="mf">47.</span><span class="p">)</span> <span class="n">FB_MotionStage</span>
    <span class="mf">48.</span><span class="p">)</span> <span class="n">FB_MotionStageSim</span>
    <span class="mf">49.</span><span class="p">)</span> <span class="n">FB_NcAxis</span>
    <span class="mf">50.</span><span class="p">)</span> <span class="n">FB_PositionStateLock</span>
    <span class="mf">51.</span><span class="p">)</span> <span class="n">FB_PositionStateManager</span>
    <span class="mf">52.</span><span class="p">)</span> <span class="n">FB_PositionStateMove</span>
    <span class="mf">53.</span><span class="p">)</span> <span class="n">FB_ReadFloatParameter</span>
    <span class="mf">54.</span><span class="p">)</span> <span class="n">FB_ReadParameterInNc_v1_00</span>
    <span class="mf">55.</span><span class="p">)</span> <span class="n">FB_SetEnables</span>
    <span class="mf">56.</span><span class="p">)</span> <span class="n">FB_StatePTPMove</span>
    <span class="mf">57.</span><span class="p">)</span> <span class="n">FB_TerminalError</span>
    <span class="mf">58.</span><span class="p">)</span> <span class="n">FB_WriteFloatParameter</span>
    <span class="mf">59.</span><span class="p">)</span> <span class="n">FB_WriteParameterInNc_v1_00</span>
    <span class="mf">60.</span><span class="p">)</span> <span class="n">F_AtPositionState</span>
    <span class="mf">61.</span><span class="p">)</span> <span class="n">F_MotionErrorCodeLookup</span>
    <span class="mf">62.</span><span class="p">)</span> <span class="n">Interactive</span>

<span class="n">GVLs</span><span class="p">:</span>
    <span class="mf">1.</span><span class="p">)</span> <span class="n">GVL</span>
    <span class="mf">2.</span><span class="p">)</span> <span class="n">GVL_ErrorSystem</span>
    <span class="mf">3.</span><span class="p">)</span> <span class="n">Global_Version</span>
</pre></div>
</div>
<div class="section" id="dut-dut-axisstatus-v0-01">
<h2>DUT: DUT_AxisStatus_v0_01<a class="headerlink" href="#dut-dut-axisstatus-v0-01" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/DUTs/DUT_AxisStatus_v0_01.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">TYPE</span> <span class="n">DUT_AxisStatus_v0_01</span> <span class="o">:</span>
<span class="n">STRUCT</span>
	<span class="n">bEnable</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bReset</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nCommand</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">nCmdData</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">fVelocity</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">fPosition</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">fAcceleration</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">fDeceleration</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">bJogFwd</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bJogBwd</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bLimitFwd</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bLimitBwd</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">fOverride</span><span class="o">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="n">bHomeSensor</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bEnabled</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">fActVelocity</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">fActPosition</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">fActDiff</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">bHomed</span><span class="o">:</span><span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bBusy</span><span class="o">:</span><span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="dut-dut-errorstate">
<h2>DUT: DUT_ErrorState<a class="headerlink" href="#dut-dut-errorstate" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/ErrorHandling/DUT_ErrorState.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;qualified_only&#39;}
{attribute &#39;strict&#39;}
TYPE DUT_ErrorState :
(
	None,
	Active,
	Inactive,
	Acknowledged
);
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-dut-motionpneumaticactuator">
<h2>DUT: DUT_MotionPneumaticActuator<a class="headerlink" href="#dut-dut-motionpneumaticactuator" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/DUT_MotionPneumaticActuator.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;qualified_only&#39;}
{attribute &#39;strict&#39;}
TYPE DUT_MotionPneumaticActuator :
    // Defines the EPICS interface to actuating a pneumatic stage
STRUCT
     (* Hardware *)
    //Readbacks
    //Limit Switch
    {attribute &#39;pytmc&#39; := &#39;
     pv: PLC:bInLimitSwitch
     io: i
     field: ZNAM FALSE
     field: ONAM TRUE
     field: DESC TRUE if IN limit is reached
    &#39;}
    i_bInLimitSwitch    :    BOOL;
    {attribute &#39;pytmc&#39; := &#39;
     pv: PLC:bOutLimitSwitch
     io: i
     field: ZNAM FALSE
     field: ONAM TRUE
     field: DESC TRUE if OUT limit is reached
    &#39;}
    i_bOutLimitSwitch    :    BOOL;
    //Controls
    //Digital outputs
    {attribute &#39;pytmc&#39; := &#39;
    pv: bRetractDigitalOutput;
    io: i;
    field: ONAM FALSE
    field: ZNAM TRUE
    field: DESC TRUE if Retract digital output is active
    &#39;}
    q_bRetract    :    BOOL;
    {attribute &#39;pytmc&#39; := &#39;
    pv: bInsetDigitalOutput;
    io: i;
    field: ONAM FALSE
    field: ZNAM TRUE
    field: DESC TRUE if Insert digital output is active
    &#39;}
    q_bInsert    :    BOOL;


    //Logic and supervisory
    {attribute &#39;pytmc&#39; := &#39;
    pv: bInterlockOK;
    io: i;
    field: ZNAM FALSE
    field: ONAM TRUE
    field: DESC True if the actuator has permission to move in either direction
    &#39;}
    bILK_OK: BOOL;
    {attribute &#39;pytmc&#39; := &#39;
    pv: bInsertEnable;
    io: i;
    field: ZNAM FALSE
    field: ONAM TRUE
    field: DESC True if the actuator had permission to be retracted
    &#39;}
    bInsertOK    :    BOOL;
    {attribute &#39;pytmc&#39; := &#39;
    pv: bRetractEnable;
    io: i;
    field: ZNAM FALSE
    field: ONAM TRUE
    field: DESC True if the actuator had permission to be inserted
    &#39;}
    bRetractOK    :    BOOL;

    (* Commands *)
    // Used from Epics to comand the actuator to  move
    {attribute &#39;pytmc&#39; := &#39;
    pv: CMD:IN;
    io: io;
    field: DESC Used by EPICS and internally to request Insert motion
    &#39;}
    bInsert_SW        :    BOOL;
    {attribute &#39;pytmc&#39; := &#39;
    pv: CMD:OUT;
    io: io;
    field: DESC Used by EPICS and internally to request retract motion
    &#39;}
    bRetract_SW    :    BOOL;

    (*Returns*)
     // TRUE if in the middle of a command
    {attribute &#39;pytmc&#39; := &#39;
     pv: bBusy
     io: i
     field: ONAM FALSE
     field: ZNAM TRUE
     field: DESC TRUE if in the middle of a command
    &#39;}
    bBusy: BOOL;
    // TRUE if we&#39;ve done a command and it has finished
    {attribute &#39;pytmc&#39; := &#39;
     pv: bDone
     io: i
     field: ONAM FALSE
     field: ZNAM TRUE
      field: DESC TRUE if command finished successfully
    &#39;}
    bDone: BOOL;
     {attribute &#39;pytmc&#39; := &#39;
        pv: bReset
        io: io
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC Used internally to reset errors
    &#39;}
    bReset: BOOL;
    // TRUE if we&#39;re in an error state
    {attribute &#39;pytmc&#39; := &#39;
     pv: PLC:bError
     io: i
     field: ONAM FALSE
     field: ZNAM TRUE
     field: DESC TRUE if we&#39;re in an error state
    &#39;}
    bError: BOOL;

     // Error code if nonzero
    {attribute &#39;pytmc&#39; := &#39;
     pv: PLC:nErrorId
     io: i
     field: DESC Error code if nonzero
    &#39;}
    nErrorId: UDINT;
    // Message to identify the error state
    {attribute &#39;pytmc&#39; := &#39;
     pv: PLC:sErrorMessage
     io: i
     field: DESC Message to identify the error state
    &#39;}
    sErrorMessage: STRING;
    {attribute &#39;pytmc&#39; := &#39;
    pv: nPositionState ;
    type: mbbi ;
    field: ZRST RETRACTED ;
    field: ONST INSERTED ;
    field: TWST MOVING ;
    field: THST INVALID ;
    io: i
    field: DESC Pneumatic actuator position
    &#39;}

    eState    :    ENUM_PnuematicActuatorPositionState := ENUM_PnuematicActuatorPositionState.INVALID;

END_STRUCT
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-dut-motionstage">
<h2>DUT: DUT_MotionStage<a class="headerlink" href="#dut-dut-motionstage" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/DUT_MotionStage.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>TYPE DUT_MotionStage :
    // Defines the EPICS interface to moving a motor in TwinCAT
STRUCT
    (* Hardware *)

    // PLC Axis Reference
    Axis: AXIS_REF;
    // NC Forward Limit Switch: TRUE if ok to move
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bLimitForwardEnable
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC FALSE if forward limit hit
    &#39;}
    bLimitForwardEnable AT %I*: BOOL;
    // NC Backward Limit Switch: TRUE if ok to move
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bLimitBackwardEnable
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC FALSE if reverse limit hit
    &#39;}
    bLimitBackwardEnable AT %I*: BOOL;
    // NO Home Switch: TRUE if at home
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bHome
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC TRUE if at homing switch
    &#39;}
    bHome AT %I*: BOOL;
    // NC Brake Output: TRUE to release brake
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bBrakeRelease
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC TRUE if brake released
    &#39;}
    bBrakeRelease AT %Q*: BOOL;
    // NC STO Input: TRUE if ok to move
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bHardwareEnable
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC TRUE if STO not hit
    &#39;}
    bHardwareEnable AT %I*: BOOL;

    (* Psuedo-hardware *)

    // Forward enable EPS summary
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bAllForwardEnable
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC Summary of axis permission to move forward
    &#39;}
    bAllForwardEnable: BOOL:=FALSE;
    // Backward enable EPS summary
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bAllBackwardEnable
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC Summary of axis permission to move backward
    &#39;}
    bAllBackwardEnable: BOOL:=FALSE;
    // Enable EPS summary encapsulating emergency stop button and any additional motion preventive hardware
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bAllEnable
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC Summary of axis permission to have power
    &#39;}
    bAllEnable: BOOL:=FALSE;
    // Forward virtual gantry limit switch
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bGantryForwardEnable
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC TRUE if gantry ok to move forward
    &#39;}
    bGantryForwardEnable: BOOL:=FALSE;
    // Backward virtual gantry limit switch
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bGantryBackwardEnable
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC TRUE if gantry ok to move backward
    &#39;}
    bGantryBackwardEnable: BOOL:=FALSE;

    (* Settings *)
    // If TRUE, we want to enable the motor independently of PMPS or other safety systems.
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bPowerSelf
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC FALSE if axis is in PMPS
    &#39;}
    bPowerSelf: BOOL:=FALSE;
    // Determines when we automatically enable the motor
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:nEnableMode
        io: i
        field: DESC Describes when the axis will automatically get power
    &#39;}
    nEnableMode: ENUM_StageEnableMode:=ENUM_StageEnableMode.DURING_MOTION;
    // Determines when we automatically disengage the brake
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:nBrakeMode
        io: i
        field: DESC Describes when the brake will be released
    &#39;}
    nBrakeMode: ENUM_StageBrakeMode:=ENUM_StageBrakeMode.IF_ENABLED;
    // Determines our encoder homing strategy
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:nHomingMode
        io: i
        field: DESC Describes our homing strategy
    &#39;}
    nHomingMode: ENUM_EpicsHomeCmd:=ENUM_EpicsHomeCmd.NONE;
    // Set true to activate gantry EPS
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bGantryAxis
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC TRUE if gantry EPS active
    &#39;}
    bGantryAxis: BOOL:=FALSE;

    // Set to gantry difference tolerance
    nGantryTol: LINT:=0;

    // Encoder count at which this axis is aligned with other axis
    nEncRef: ULINT:=0;

    (* Commands *)
    // Used internally to request enables
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bEnable
        io: io
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC Used internally to request enables
    &#39;}
    bEnable: BOOL;
    // Used internally to reset errors and other state
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bReset
        io: io
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC Used internally to reset errors
    &#39;}
    bReset: BOOL;
    // Used internally and by the IOC to start or stop a move
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bExecute
        io: io
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC Used internally and by the IOC to start or stop
    &#39;}
    bExecute: BOOL;

    (* Command Args *)
    // Used internally and by the IOC to pick what kind of move to do
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:nCommand
        io: io
        field: DESC Used internally and by the IOC to pick move type
    &#39;}
    nCommand: INT;
    // Used internally and by the IOC to pass additional data to some commands
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:nCmdData
        io: io
        field: DESC Used internally and by the IOC to pass extra args
    &#39;}
    nCmdData: INT;
    // Used internally and by the IOC to pick a destination for the move
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:fPosition
        io: io
        field: DESC Used internally and by the IOC as the set position
    &#39;}
    fPosition: LREAL;
    // Used internally and by the IOC to pick a move velocity
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:fVelocity
        io: io
        field: DESC Used internally and by the IOC to set velocity
    &#39;}
    fVelocity: LREAL;
    // Used internally and by the IOC to pick a move acceleration
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:fAcceleration
        io: io
        field: DESC Used internally and by the IOC to set acceleration
    &#39;}
    fAcceleration: LREAL;
    // Used internally and by the IOC to pick a move deceleration
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:fDeceleration
        io: io
        field: DESC Used internally and by the IOC to set deceleration
    &#39;}
    fDeceleration: LREAL;
    // Used internally and by the IOC to pick a home position
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:fHomePosition
        io: io
        field: DESC Used internally and by the IOC to pick home position
    &#39;}
    fHomePosition: LREAL;

    (* Info *)
    // Unique ID assigned to each axis in the NC
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:nMotionAxisID
        io: i
        field: DESC Unique ID assigned to each axis in the NC
    &#39;}
    nMotionAxisID: UDINT:=0;

    (* Returns *)
    // TRUE if done enabling
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bEnableDone
        io: i
        field: ONAM FALSE
        field: ZNAM TRUE
        field: DESC TRUE if done enabling
    &#39;}
    bEnableDone: BOOL;
    // TRUE if in the middle of a command
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bBusy
        io: i
        field: ONAM FALSE
        field: ZNAM TRUE
        field: DESC TRUE if in the middle of a command
    &#39;}
    bBusy: BOOL;
    // TRUE if we&#39;ve done a command and it has finished
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bDone
        io: i
        field: ONAM FALSE
        field: ZNAM TRUE
        field: DESC TRUE if command finished successfully
    &#39;}
    bDone: BOOL;
    // TRUE if we&#39;re in an error state
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:bError
        io: i
        field: ONAM FALSE
        field: ZNAM TRUE
        field: DESC TRUE if we&#39;re in an error state
    &#39;}
    bError: BOOL;
    // Error code if nonzero
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:nErrorId
        io: i
        field: DESC Error code if nonzero
    &#39;}
    nErrorId: UDINT;
    // Message to identify the error state
    {attribute &#39;pytmc&#39; := &#39;
        pv: PLC:sErrorMessage
        io: i
        field: DESC Message to identify the error state
    &#39;}
    sErrorMessage: STRING;
    // Misc axis status information for the IOC
    stAxisStatus: DUT_AxisStatus_v0_01;
END_STRUCT
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-dut-positionstate">
<h2>DUT: DUT_PositionState<a class="headerlink" href="#dut-dut-positionstate" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/DUT_PositionState.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>TYPE DUT_PositionState :
    // Defines settings and current safety status for moves to specific positions for an axis
STRUCT
    // Name as queried via the NAME PV in EPICS
    {attribute &#39;pytmc&#39; := &#39;
        pv: NAME
        io: input
        field: DESC Name of this position state
    &#39;}
    sName: STRING := &#39;Invalid&#39;;

    // Position associated with this state
    {attribute &#39;pytmc&#39; := &#39;
        pv: SETPOINT
        io: io
        field: DESC Axis position associated with this state
    &#39;}
    fPosition: LREAL;

    // Maximum allowable deviation from fPosition while at the state
    {attribute &#39;pytmc&#39; := &#39;
        pv: DELTA
        io: io
        field: DRVL 0.0
        field: DESC Max deviation from position at this state
    &#39;}
    fDelta: LREAL;

    // Speed at which to move to this state
    {attribute &#39;pytmc&#39; := &#39;
        pv: VELO
        io: io
        field: DESC Speed at which to move to this state
    &#39;}
    fVelocity: LREAL;

    // (optional) Acceleration to use for moves to this state
    {attribute &#39;pytmc&#39; := &#39;
        pv: ACCL
        io: io
        field: DESC Acceleration to use for moves to this state
    &#39;}
    fAccel: LREAL;

    // (optional) Deceleration to use for moves to this state
    {attribute &#39;pytmc&#39; := &#39;
        pv: DCCL
        io: io
        field: DESC Deceleration to use for moves to this state
    &#39;}
    fDecel: LREAL;

    // Safety parameter. This must be set to TRUE by the PLC program to allow moves to this state. This is expected to change as conditions change.
    {attribute &#39;pytmc&#39; := &#39;
        pv: MOVE_OK
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC TRUE if the move would be safe
    &#39;}
    bMoveOk: BOOL;

    // Signifies to FB_PositionStateLock that this state should be immutable
    {attribute &#39;pytmc&#39; := &#39;
        pv: LOCKED
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC TRUE if state is immutable
    &#39;}
    bLocked: BOOL;

    // Set this to TRUE when you make your state. This defaults to FALSE so that uninitialized states can never be moved to
    {attribute &#39;pytmc&#39; := &#39;
        pv: VALID
        io: i
        field: ZNAM FALSE
        field: ONAM TRUE
        field: DESC TRUE if this is a real state
    &#39;}
    bValid: BOOL;
END_STRUCT
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-dut-terminalerror">
<h2>DUT: DUT_TerminalError<a class="headerlink" href="#dut-dut-terminalerror" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/ErrorHandling/DUT_TerminalError.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">TYPE</span> <span class="n">DUT_TerminalError</span> <span class="o">:</span>
<span class="n">STRUCT</span>
	<span class="o">//</span><span class="n">Error</span> <span class="n">system</span> <span class="n">related</span>
	<span class="n">iTerminalID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>					<span class="o">//</span><span class="n">ID</span> <span class="k">of</span> <span class="n">the</span> <span class="n">terminal</span>
	<span class="n">Error_ID</span> <span class="o">:</span> <span class="n">ULINT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>				<span class="o">//</span><span class="n">ID</span> <span class="k">for</span> <span class="n">the</span> <span class="n">Error</span> <span class="n">entry</span>
	<span class="n">ErrorState</span> <span class="o">:</span> <span class="n">DUT_ErrorState</span><span class="p">;</span>		<span class="o">//</span><span class="n">State</span> <span class="k">of</span> <span class="n">the</span> <span class="n">error</span>
	
	<span class="o">//</span><span class="n">Error</span> <span class="n">related</span>
	<span class="n">nDateTimeOn</span> <span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>				<span class="o">//</span><span class="n">Date</span> <span class="k">and</span> <span class="kt">time</span> <span class="k">when</span> <span class="n">the</span> <span class="n">error</span> <span class="n">occured</span><span class="p">.</span> <span class="n">Raw</span> <span class="n">data</span>
	<span class="n">sDateTimeOn</span> <span class="o">:</span> <span class="kt">STRING</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>			<span class="o">//</span><span class="n">Date</span> <span class="k">and</span> <span class="kt">time</span> <span class="k">when</span> <span class="n">the</span> <span class="n">error</span> <span class="n">occured</span><span class="p">.</span> <span class="n">Readable</span> <span class="n">format</span>
	<span class="n">nDateTimeOff</span> <span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>				<span class="o">//</span><span class="n">Date</span> <span class="k">and</span> <span class="kt">time</span> <span class="k">when</span> <span class="n">the</span> <span class="n">error</span> <span class="n">disapeared</span><span class="p">.</span> <span class="n">Raw</span> <span class="n">data</span>
	<span class="n">sDateTimeOff</span> <span class="o">:</span> <span class="kt">STRING</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>			<span class="o">//</span><span class="n">Date</span> <span class="k">and</span> <span class="kt">time</span> <span class="k">when</span> <span class="n">the</span> <span class="n">error</span> <span class="n">disapeared</span><span class="p">.</span> <span class="n">Readable</span> <span class="n">format</span>
	<span class="n">bWcState</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>					<span class="o">//</span><span class="n">WcState</span> <span class="k">variable</span> <span class="k">of</span> <span class="n">the</span> <span class="n">terminal</span>
	<span class="n">uiInfoDataState</span> <span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>				<span class="o">//</span><span class="n">InfoData</span><span class="p">.</span><span class="n">State</span> <span class="k">variable</span> <span class="k">of</span> <span class="n">the</span> <span class="n">terminal</span>
	<span class="n">sErrorMessage</span> <span class="o">:</span> <span class="kt">STRING</span> <span class="p">(</span><span class="mi">128</span><span class="p">);</span>		<span class="o">//</span><span class="n">Error</span> <span class="n">message</span> <span class="n">corresponding</span> <span class="k">to</span> <span class="n">WcState</span> <span class="k">and</span> <span class="n">InfoData</span><span class="p">.</span><span class="n">State</span>
	<span class="n">ErrorType</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span> 					<span class="o">//</span><span class="n">Error</span> <span class="n">types</span> <span class="p">(</span><span class="n">priorities</span><span class="p">)</span> <span class="n">need</span> <span class="k">to</span> <span class="n">be</span> <span class="n">developed</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="dut-el5042-status">
<h2>DUT: EL5042_Status<a class="headerlink" href="#dut-el5042-status" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/EL5042_Status.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">TYPE</span> <span class="n">EL5042_Status</span> <span class="o">:</span>
<span class="n">STRUCT</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="dut-enum-epicshomecmd">
<h2>DUT: ENUM_EpicsHomeCmd<a class="headerlink" href="#dut-enum-epicshomecmd" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/ENUM_EpicsHomeCmd.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;qualified_only&#39;}
{attribute &#39;strict&#39;}
TYPE ENUM_EpicsHomeCmd :
    // Defines the valid options for homing in FB_MotionStage
(
    LOW_LIMIT := 1, // Low limit switch
    HIGH_LIMIT := 2, // High limit switch
    HOME_VIA_LOW := 3, // Home switch via low switch
    HOME_VIA_HIGH := 4, // Home switch via high switch
    ABSOLUTE_SET := 15, // Set here to be fHomePosition
    NONE := -1 // Do not home, ever
);
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-enum-epicsinout">
<h2>DUT: ENUM_EpicsInOut<a class="headerlink" href="#dut-enum-epicsinout" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/ENUM_EpicsInOut.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;qualified_only&#39;}
// Example EPICS states enum for use in FB_PositionStateManager
// Remove strict attribute for easier handling
TYPE ENUM_EpicsInOut :
(
    UNKNOWN := 0, // UNKNOWN must be in slot 0 or the FB breaks
    OUT := 1, // OUT at slot 1 is a convention
    IN := 2
);
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-enum-epicsmotorcmd">
<h2>DUT: ENUM_EpicsMotorCmd<a class="headerlink" href="#dut-enum-epicsmotorcmd" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/ENUM_EpicsMotorCmd.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;qualified_only&#39;}
{attribute &#39;strict&#39;}
TYPE ENUM_EpicsMotorCmd :
    // Defines valid EPICS commands for nCommand
(
    JOG := 0,
    MOVE_VELOCITY := 1,
    MOVE_RELATIVE := 2,
    MOVE_ABSOLUTE := 3,
    MOVE_MODULO := 4,
    HOME := 10,
    GEAR := 30
);
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-enum-motionrequest">
<h2>DUT: ENUM_MotionRequest<a class="headerlink" href="#dut-enum-motionrequest" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/ENUM_MotionRequest.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;qualified_only&#39;}
{attribute &#39;strict&#39;}
TYPE ENUM_MotionRequest :
    // Defines behavior options for when FB_MotionRequest is run during an active move from another source
(
    WAIT := 0,
    INTERRUPT := 1,
    ABORT := 2
);
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-enum-pnuematicactuatorpositionstate">
<h2>DUT: ENUM_PnuematicActuatorPositionState<a class="headerlink" href="#dut-enum-pnuematicactuatorpositionstate" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/ENUM_PnuematicActuatorPositionState.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;qualified_only&#39;}
{attribute &#39;strict&#39;}
// Defines the positions for a pnuematic actuator
TYPE ENUM_PnuematicActuatorPositionState :
(
   RETRACTED    := 0, // Out limit switch is active
   INSERTED    := 1, // In limit switch is active
   MOVING    := 2, // Neither limit switches is Active
   INVALID :=3 // Invalid state
);
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-enum-stagebrakemode">
<h2>DUT: ENUM_StageBrakeMode<a class="headerlink" href="#dut-enum-stagebrakemode" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/ENUM_StageBrakeMode.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;qualified_only&#39;}
{attribute &#39;strict&#39;}
TYPE ENUM_StageBrakeMode :
    // Defines when to send the brake disengage signal in FB_MotionStage
(
    IF_ENABLED, // Disengage brake when the motor is enabled
    IF_MOVING, // Disengage brake when the motor is moving
    NO_BRAKE // Do not change the brake state in FB_MotionStage
);
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-enum-stageenablemode">
<h2>DUT: ENUM_StageEnableMode<a class="headerlink" href="#dut-enum-stageenablemode" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/ENUM_StageEnableMode.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;qualified_only&#39;}
{attribute &#39;strict&#39;}
TYPE ENUM_StageEnableMode :
    // Define conditions when FB_MotionStage automatically sets bEnable
(
    ALWAYS, // Always set bEnable to TRUE
    NEVER,  // Only change bEnable on errors
    DURING_MOTION  // Enable before motion, disable after motion
);
END_TYPE
</pre></div>
</div>
</div>
<div class="section" id="dut-st-errorsystem">
<h2>DUT: ST_ErrorSystem<a class="headerlink" href="#dut-st-errorsystem" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/ErrorHandling/ST_ErrorSystem.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">TYPE</span> <span class="n">ST_ErrorSystem</span> <span class="o">:</span>
<span class="n">STRUCT</span>
	<span class="o">//</span><span class="k">Array</span> <span class="k">of</span> <span class="n">error</span> <span class="n">data</span><span class="p">.</span> <span class="n">Size</span> <span class="o">=</span> <span class="n">cSizeOfErrorData</span> <span class="k">in</span> <span class="n">the</span> <span class="n">GVL</span>
	<span class="n">aErrorData</span> <span class="o">:</span> <span class="k">ARRAY</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">OF</span> <span class="n">DUT_TerminalError</span><span class="p">;</span>
	<span class="n">lNextErrorID</span> <span class="o">:</span> <span class="n">ULINT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>					<span class="o">//</span><span class="n">ErrorID</span> <span class="k">for</span> <span class="n">the</span> <span class="k">next</span> <span class="n">error</span> <span class="n">entry</span>
	<span class="n">nNoErrors</span> <span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>							<span class="o">//</span><span class="n">Number</span> <span class="k">of</span> <span class="n">errors</span> <span class="k">in</span> <span class="n">the</span> <span class="n">list</span>
	<span class="n">nNoOverflows</span> <span class="o">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>					<span class="o">//</span><span class="n">Number</span> <span class="k">of</span> <span class="n">overflows</span><span class="p">.</span> <span class="n">How</span> <span class="n">many</span> <span class="n">error</span> <span class="n">entries</span> <span class="n">have</span> <span class="n">been</span> <span class="n">lost</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="dut-st-renishawabsenc">
<h2>DUT: ST_RenishawAbsEnc<a class="headerlink" href="#dut-st-renishawabsenc" title="Permalink to this headline">¶</a></h2>
<p>File: Library/DUTs/ST_RenishawAbsEnc.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Renishaw</span> <span class="n">BiSS</span><span class="o">-</span><span class="n">C</span> <span class="n">absolute</span> <span class="n">encoder</span> <span class="n">used</span> <span class="k">with</span> <span class="n">an</span> <span class="n">EL5042</span>
<span class="k">TYPE</span> <span class="n">ST_RenishawAbsEnc</span> <span class="o">:</span>
<span class="n">STRUCT</span>
    <span class="n">Count</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">ULINT</span><span class="p">;</span> <span class="o">//</span> <span class="n">Connect</span> <span class="k">to</span> <span class="n">encoder</span> <span class="s">&quot;Position&quot;</span> <span class="n">input</span>
    <span class="n">Status</span><span class="o">:</span> <span class="n">EL5042_Status</span><span class="p">;</span> <span class="o">//</span> <span class="n">Status</span> <span class="n">struct</span> <span class="n">placeholder</span>
    <span class="n">Ref</span><span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span> <span class="o">//</span> <span class="n">Encoder</span> <span class="n">zero</span> <span class="n">position</span> <span class="p">(</span><span class="n">useful</span> <span class="k">for</span> <span class="n">aligned</span> <span class="n">position</span> <span class="k">with</span> <span class="n">gantries</span><span class="p">)</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="dut-dutel2521-ctrl">
<h2>DUT: dutEL2521_Ctrl<a class="headerlink" href="#dut-dutel2521-ctrl" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Outputs/External_Types/dutEL2521_Ctrl.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">TYPE</span> <span class="n">dutEL2521_Ctrl</span> <span class="o">:</span>
<span class="n">STRUCT</span>
	<span class="o">///</span><span class="n">The</span> <span class="n">control</span> <span class="n">word</span> <span class="p">(</span><span class="n">CW</span><span class="p">)</span> <span class="k">is</span> <span class="n">located</span> <span class="k">in</span> <span class="n">the</span> <span class="n">output</span> <span class="k">process</span> <span class="n">image</span><span class="p">,</span> <span class="k">and</span> <span class="k">is</span> <span class="n">transmitted</span> <span class="n">from</span> <span class="n">the</span> <span class="n">controller</span> <span class="k">to</span> <span class="n">the</span> <span class="n">terminal</span><span class="p">.</span>
	<span class="o">///</span><span class="n">CW</span><span class="p">.</span><span class="mi">0</span> <span class="n">FREQ_SEL</span> <span class="mi">0</span><span class="n">bin</span> <span class="o">/</span> <span class="mi">1</span><span class="n">bin</span>  <span class="n">Rapid</span> <span class="n">change</span> <span class="k">of</span> <span class="n">the</span> <span class="n">base</span> <span class="n">frequency</span> <span class="p">(</span><span class="n">only</span> <span class="k">if</span> <span class="n">the</span> <span class="n">ramp</span> <span class="k">function</span> <span class="k">is</span> <span class="n">inactive</span><span class="p">)</span><span class="o">:</span>
	<span class="o">///</span><span class="mi">0</span><span class="n">bin</span> <span class="o">=</span> <span class="n">Base</span> <span class="n">frequency</span> <span class="mi">1</span> <span class="p">(</span><span class="n">object</span> <span class="mi">8001</span><span class="o">:</span><span class="mi">02</span><span class="p">)</span>
	<span class="o">///</span><span class="mi">1</span><span class="n">bin</span> <span class="o">=</span> <span class="n">Base</span> <span class="n">frequency</span> <span class="mi">2</span> <span class="p">(</span><span class="n">object</span> <span class="mi">8001</span><span class="o">:</span><span class="mi">03</span><span class="p">)</span> 
	<span class="n">FREQ_SEL</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="n">CW</span><span class="p">.</span><span class="mi">1</span> <span class="n">RAMP_DIS</span> <span class="mi">1</span><span class="n">bin</span> <span class="n">Operation</span> <span class="k">of</span> <span class="n">the</span> <span class="n">ramp</span> <span class="k">function</span> <span class="k">is</span> <span class="n">cancelled</span><span class="p">,</span> <span class="k">in</span> <span class="n">spite</span> <span class="k">of</span> <span class="n">object</span> <span class="mi">8000</span><span class="o">:</span><span class="mi">06</span> <span class="n">being</span> <span class="n">active</span><span class="p">;</span> <span class="k">if</span> <span class="n">travel</span> <span class="n">distance</span> <span class="n">control</span> <span class="k">is</span> <span class="n">active</span><span class="p">,</span> <span class="n">it</span> <span class="k">is</span> <span class="n">interrupted</span> <span class="n">by</span> <span class="n">this</span> <span class="kt">bit</span> 
	<span class="n">RAMP_DIS</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="n">CW</span><span class="p">.</span><span class="mi">2</span> <span class="n">GO_COUNTER</span> <span class="mi">1</span><span class="n">bin</span>  <span class="k">If</span> <span class="n">travel</span> <span class="n">distance</span> <span class="n">control</span> <span class="k">is</span> <span class="n">active</span> <span class="p">(</span><span class="n">object</span> <span class="mi">8000</span><span class="o">:</span><span class="mi">0</span><span class="n">A</span><span class="p">),</span> <span class="k">then</span> <span class="n">a</span> <span class="n">pre</span><span class="o">-</span><span class="n">set</span> <span class="n">counter</span> <span class="n">value</span> <span class="k">is</span> <span class="n">approached</span> <span class="k">when</span> <span class="n">the</span> <span class="kt">bit</span> <span class="k">is</span> <span class="n">set</span> 
	<span class="n">GO_COUNTER</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="n">CW</span><span class="p">.</span><span class="mi">5</span> <span class="n">CNT_CLR</span> <span class="mi">1</span><span class="n">bin</span> <span class="n">The</span> <span class="n">contents</span> <span class="k">of</span> <span class="n">the</span> <span class="n">counter</span> <span class="k">is</span> <span class="n">cleared</span> <span class="k">or</span> <span class="n">set</span> <span class="p">(</span><span class="n">object</span> <span class="mi">8000</span><span class="o">:</span><span class="mi">0</span><span class="n">B</span><span class="p">)</span> <span class="n">by</span> <span class="n">this</span> <span class="kt">bit</span><span class="p">.</span> 
	<span class="o">///</span><span class="n">Any</span> <span class="n">overflow</span> <span class="k">or</span> <span class="n">underflow</span> <span class="n">bits</span> <span class="n">that</span> <span class="n">might</span> <span class="n">be</span> <span class="n">set</span> <span class="n">are</span> <span class="n">also</span> <span class="n">cleared</span> <span class="n">by</span> <span class="n">this</span> <span class="kt">bit</span><span class="p">.</span> 
	<span class="o">///</span><span class="n">The</span> <span class="k">process</span> <span class="n">can</span> <span class="n">be</span> <span class="n">edge</span> <span class="n">triggered</span> <span class="k">or</span> <span class="n">level</span> <span class="n">triggered</span> <span class="p">(</span><span class="n">object</span> <span class="mi">8000</span><span class="o">:</span><span class="mi">05</span><span class="p">).</span> 
	<span class="n">CNT_CLR</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="dut-dutel2521-status">
<h2>DUT: dutEL2521_Status<a class="headerlink" href="#dut-dutel2521-status" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Outputs/External_Types/dutEL2521_Status.TcDUT</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">TYPE</span> <span class="n">dutEL2521_Status</span> <span class="o">:</span>
<span class="n">STRUCT</span>
	<span class="o">///</span><span class="n">The</span> <span class="n">status</span> <span class="n">word</span> <span class="p">(</span><span class="n">SW</span><span class="p">)</span> <span class="k">is</span> <span class="n">located</span> <span class="k">in</span> <span class="n">the</span> <span class="n">input</span> <span class="k">process</span> <span class="n">image</span><span class="p">,</span> <span class="k">and</span> <span class="k">is</span> <span class="n">transmitted</span> <span class="n">from</span> <span class="n">the</span> <span class="n">terminal</span> <span class="k">to</span> <span class="n">the</span> <span class="n">controller</span><span class="p">.</span>
	<span class="o">///</span><span class="n">SW</span><span class="p">.</span><span class="mi">0</span> <span class="n">SEL_ACK</span><span class="o">/</span><span class="n">END_COUNTER</span> <span class="mi">1</span><span class="n">bin</span>  <span class="n">Confirms</span> <span class="n">the</span> <span class="n">change</span> <span class="k">of</span> <span class="n">base</span> <span class="n">frequency</span><span class="p">.</span> <span class="n">At</span> <span class="n">activated</span> <span class="n">travel</span> <span class="n">distance</span> <span class="n">control</span><span class="o">:</span> <span class="n">target</span> <span class="n">counter</span> <span class="n">value</span> <span class="n">reached</span> 
	<span class="n">SEL_ACK</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="n">SW</span><span class="p">.</span><span class="mi">1</span> <span class="n">RAMP_ACTIVE</span> <span class="mi">1</span><span class="n">bin</span> <span class="n">Ramp</span> <span class="k">is</span> <span class="n">currently</span> <span class="n">being</span> <span class="n">followed</span> 
	<span class="n">RAMP_ACTIVE</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="n">SW</span><span class="p">.</span><span class="mi">2</span> <span class="n">UNDERFLOW</span> <span class="mi">1</span><span class="n">bin</span> <span class="n">This</span> <span class="kt">bit</span> <span class="k">is</span> <span class="n">set</span> <span class="k">if</span> <span class="n">the</span> <span class="mi">16</span><span class="o">-</span><span class="kt">bit</span> <span class="n">counter</span> <span class="n">underflows</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">65535</span><span class="p">).</span> <span class="n">It</span> <span class="k">is</span> <span class="n">reset</span> <span class="k">when</span> <span class="n">the</span> <span class="n">counter</span> <span class="n">drops</span> <span class="n">below</span> <span class="n">two</span> <span class="n">thirds</span> <span class="k">of</span> <span class="n">its</span> <span class="n">measuring</span> <span class="k">range</span> <span class="p">(</span><span class="mi">43690</span> <span class="o">-&gt;</span> <span class="mi">43689</span><span class="p">)</span> <span class="k">or</span> <span class="n">immediately</span> <span class="n">an</span> <span class="n">overflow</span> <span class="n">occurs</span><span class="p">.</span> 
	<span class="n">UNDERFLOW</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="n">SW</span><span class="p">.</span><span class="mi">3</span> <span class="n">OVERFLOW</span> <span class="mi">1</span><span class="n">bin</span> <span class="n">This</span> <span class="kt">bit</span> <span class="k">is</span> <span class="n">set</span> <span class="k">if</span> <span class="n">the</span> <span class="mi">16</span><span class="o">-</span><span class="kt">bit</span> <span class="n">counter</span> <span class="n">overflows</span> <span class="p">(</span><span class="mi">65535</span> <span class="o">-&gt;</span> <span class="mi">0</span><span class="p">).</span> <span class="n">It</span> <span class="k">is</span> <span class="n">reset</span> <span class="k">when</span> <span class="n">the</span> <span class="n">counter</span> <span class="n">exceeds</span> <span class="n">one</span> <span class="n">third</span> <span class="k">of</span> <span class="n">its</span> <span class="n">measuring</span> <span class="k">range</span> <span class="p">(</span><span class="mi">21845</span> <span class="o">-&gt;</span> <span class="mi">21846</span><span class="p">)</span> <span class="k">or</span> <span class="n">immediately</span> <span class="n">an</span> <span class="n">underflow</span> <span class="n">occurs</span> 
	<span class="n">OVERFLOW</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="n">SW</span><span class="p">.</span><span class="mi">4</span> <span class="n">INPUT_T</span> <span class="mi">1</span><span class="n">bin</span> <span class="n">Status</span> <span class="k">of</span> <span class="n">INPUT_T</span> 
	<span class="n">INPUT_T</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="n">SW</span><span class="p">.</span><span class="mi">5</span> <span class="n">INPUT_Z</span> <span class="mi">1</span><span class="n">bin</span> <span class="n">Status</span> <span class="k">of</span> <span class="n">INPUT_Z</span> 
	<span class="n">INPUT_Z</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="n">SW</span><span class="p">.</span><span class="mi">6</span> <span class="n">ERROR</span> <span class="mi">1</span><span class="n">bin</span> <span class="n">General</span> <span class="n">error</span> <span class="kt">bit</span><span class="p">,</span> <span class="n">included</span> <span class="k">with</span> <span class="n">overflow</span><span class="o">/</span><span class="n">underflow</span> 
	<span class="n">ERROR</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="gvl-gvl">
<h2>GVL: GVL<a class="headerlink" href="#gvl-gvl" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/GVLs/GVL.TcGVL</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>
	<span class="n">nHomingError</span><span class="o">:</span><span class="n">UDINT</span><span class="o">:=</span><span class="mi">16#14D00</span><span class="p">;</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</div>
<div class="section" id="gvl-gvl-errorsystem">
<h2>GVL: GVL_ErrorSystem<a class="headerlink" href="#gvl-gvl-errorsystem" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/ErrorHandling/GVL_ErrorSystem.TcGVL</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;qualified_only&#39;}
VAR_GLOBAL CONSTANT
	cSizeOfErrorData : UINT := 128;
	
END_VAR
</pre></div>
</div>
</div>
<div class="section" id="gvl-global-version">
<h2>GVL: Global_Version<a class="headerlink" href="#gvl-global-version" title="Permalink to this headline">¶</a></h2>
<p>File: Library/Version/Global_Version.TcGVL</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>{attribute &#39;TcGenerated&#39;}
// This function has been automatically generated from the project information.
VAR_GLOBAL CONSTANT
    {attribute &#39;const_non_replaced&#39;}
    {attribute &#39;linkalways&#39;}
    stLibVersion_lcls_twincat_motion : ST_LibVersion := (iMajor := 0, iMinor := 0, iBuild := 0, iRevision := 0, sVersion := &#39;0.0.0&#39;);
END_VAR
</pre></div>
</div>
</div>
<div class="section" id="pou-basictests">
<h2>POU: BasicTests<a class="headerlink" href="#pou-basictests" title="Permalink to this headline">¶</a></h2>
<p>File: Library/UnitTests/BasicTests.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">BasicTests</span>
<span class="n">VAR</span>
    <span class="n">Motor</span><span class="o">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotion</span><span class="o">:</span> <span class="n">FB_MotionStageSim</span><span class="p">;</span>
    <span class="n">fbRequest</span><span class="o">:</span> <span class="n">FB_MotionRequest</span><span class="p">;</span>

    <span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">errState</span><span class="o">:</span> <span class="n">MC_AxisStates</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">fbRequest</span><span class="p">(</span><span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">Motor</span><span class="p">);</span>
<span class="n">fbMotion</span><span class="p">(</span><span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">Motor</span><span class="p">);</span>

<span class="k">CASE</span> <span class="n">Motor</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">MotionState</span> <span class="k">OF</span>
   <span class="n">MC_AXISSTATE_ERRORSTOP</span><span class="p">,</span>
   <span class="n">MC_AXISSTATE_STOPPING</span><span class="p">,</span>
   <span class="n">MC_AXISSTATE_HOMING</span><span class="p">,</span>
   <span class="n">MC_AXISSTATE_DISCRETEMOTION</span><span class="p">,</span>
   <span class="n">MC_AXISSTATE_CONTINOUSMOTION</span><span class="p">,</span>
   <span class="n">MC_AXISSTATE_SYNCHRONIZEDMOTION</span><span class="o">:</span>
        <span class="k">IF</span> <span class="k">NOT</span> <span class="n">Motor</span><span class="p">.</span><span class="n">bBrakeRelease</span> <span class="k">THEN</span>
            <span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">errState</span> <span class="o">:=</span> <span class="n">Motor</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">MotionState</span><span class="p">;</span>
        <span class="n">END_IF</span>
<span class="n">END_CASE</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-checkbounds">
<h2>POU: CheckBounds<a class="headerlink" href="#pou-checkbounds" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/ImplicitChecks/CheckBounds.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>// Implicitly generated code : DO NOT EDIT
FUNCTION CheckBounds : DINT
VAR_INPUT
    index, lower, upper: DINT;
END_VAR
// Implicitly generated code : Only an Implementation suggestion
{noflow}
IF  index &lt; lower THEN
    CheckBounds := lower;
ELSIF  index &gt; upper THEN
    CheckBounds := upper;
ELSE
    CheckBounds := index;
END_IF
{flow}

END_FUNCTION
</pre></div>
</div>
</div>
<div class="section" id="pou-checkdivdint">
<h2>POU: CheckDivDInt<a class="headerlink" href="#pou-checkdivdint" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/ImplicitChecks/CheckDivDInt.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>// Implicitly generated code : DO NOT EDIT
FUNCTION CheckDivDInt : DINT
VAR_INPUT
    divisor:DINT;
END_VAR
// Implicitly generated code : Only an Implementation suggestion
{noflow}
IF divisor = 0 THEN
    CheckDivDInt:=1;
ELSE
    CheckDivDInt:=divisor;
END_IF;
{flow}

END_FUNCTION
</pre></div>
</div>
</div>
<div class="section" id="pou-checkdivlint">
<h2>POU: CheckDivLInt<a class="headerlink" href="#pou-checkdivlint" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/ImplicitChecks/CheckDivLInt.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>// Implicitly generated code : DO NOT EDIT
FUNCTION CheckDivLInt : LINT
VAR_INPUT
    divisor:LINT;
END_VAR
// Implicitly generated code : Only an Implementation suggestion
{noflow}
IF divisor = 0 THEN
    CheckDivLInt:=1;
ELSE
    CheckDivLInt:=divisor;
END_IF;
{flow}

END_FUNCTION
</pre></div>
</div>
</div>
<div class="section" id="pou-checkdivlreal">
<h2>POU: CheckDivLReal<a class="headerlink" href="#pou-checkdivlreal" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/ImplicitChecks/CheckDivLReal.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>// Implicitly generated code : DO NOT EDIT
FUNCTION CheckDivLReal : LREAL
VAR_INPUT
    divisor:LREAL;
END_VAR
// Implicitly generated code : Only an Implementation suggestion
{noflow}
IF divisor = 0 THEN
    CheckDivLReal:=1;
ELSE
    CheckDivLReal:=divisor;
END_IF;
{flow}

END_FUNCTION
</pre></div>
</div>
</div>
<div class="section" id="pou-checkdivreal">
<h2>POU: CheckDivReal<a class="headerlink" href="#pou-checkdivreal" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/ImplicitChecks/CheckDivReal.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>// Implicitly generated code : DO NOT EDIT
FUNCTION CheckDivReal : REAL
VAR_INPUT
    divisor:REAL;
END_VAR
// Implicitly generated code : Only an Implementation suggestion
{noflow}
IF divisor = 0 THEN
    CheckDivReal:=1;
ELSE
    CheckDivReal:=divisor;
END_IF;
{flow}

END_FUNCTION
</pre></div>
</div>
</div>
<div class="section" id="pou-ek1200">
<h2>POU: EK1200<a class="headerlink" href="#pou-ek1200" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/Other/EK1200.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">EK1200</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el1008">
<h2>POU: EL1008<a class="headerlink" href="#pou-el1008" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Inputs/EL1008.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="n">EL1008</span> <span class="o">|</span> <span class="mi">8</span><span class="o">-</span><span class="n">channel</span> <span class="n">digital</span> <span class="n">input</span> <span class="n">terminal</span> <span class="mi">24</span> <span class="n">V</span> <span class="n">DC</span><span class="p">,</span> <span class="mi">3</span> <span class="n">ms</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL1008</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_1</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_2</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_3</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_4</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_5</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_6</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_7</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_8</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">Channel_1_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_2_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_3_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_4_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_5_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_6_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_7_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_8_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL1008_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL1008_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">bError</span><span class="o">=</span><span class="n">FALSE</span> <span class="k">THEN</span>
		<span class="n">bDi_1</span><span class="o">:=</span><span class="n">Channel_1_Input</span><span class="p">;</span>
		<span class="n">bDi_2</span><span class="o">:=</span><span class="n">Channel_2_Input</span><span class="p">;</span>
		<span class="n">bDi_3</span><span class="o">:=</span><span class="n">Channel_3_Input</span><span class="p">;</span>
		<span class="n">bDi_4</span><span class="o">:=</span><span class="n">Channel_4_Input</span><span class="p">;</span>
		<span class="n">bDi_5</span><span class="o">:=</span><span class="n">Channel_5_Input</span><span class="p">;</span>
		<span class="n">bDi_6</span><span class="o">:=</span><span class="n">Channel_6_Input</span><span class="p">;</span>
		<span class="n">bDi_7</span><span class="o">:=</span><span class="n">Channel_7_Input</span><span class="p">;</span>
		<span class="n">bDi_8</span><span class="o">:=</span><span class="n">Channel_8_Input</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">bDi_1</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_2</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_3</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_4</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_5</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_6</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_7</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_8</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el1018">
<h2>POU: EL1018<a class="headerlink" href="#pou-el1018" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Inputs/EL1018.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>///EL1018 | 8-channel digital input terminal 24 V DC, 10 µs
FUNCTION_BLOCK EL1018

VAR_INPUT
	En: BOOL;
	iTerminal_ID : INT;
	ErrorSystem : POINTER TO ST_ErrorSystem;
END_VAR

VAR_OUTPUT
	EnO: BOOL;
	bDi_1: BOOL;
	bDi_2: BOOL;
	bDi_3: BOOL;
	bDi_4: BOOL;
	bDi_5: BOOL;
	bDi_6: BOOL;
	bDi_7: BOOL;
	bDi_8: BOOL;
	bError : BOOL;
END_VAR

VAR
	Channel_1_Input AT %I*: BOOL;
	Channel_2_Input AT %I*: BOOL;
	Channel_3_Input AT %I*: BOOL;
	Channel_4_Input AT %I*: BOOL;
	Channel_5_Input AT %I*: BOOL;
	Channel_6_Input AT %I*: BOOL;
	Channel_7_Input AT %I*: BOOL;
	Channel_8_Input AT %I*: BOOL;
	WcState_WcState AT %I*: BOOL;
	InfoData_State  AT %I*: UINT;
	
	//FB-s
	EL1018_Error : FB_TerminalError;
END_VAR
EnO:=En;

//Error FB instance
EL1018_Error(
	En := TRUE,
	iTerminal_ID := iTerminal_ID,
	bWcState := WcState_WcState,
	uiInfoData_State := InfoData_State,
	pErrorSystem := ErrorSystem,
	bError =&gt; bError,
);

IF En THEN
	IF bError=FALSE THEN
		bDi_1:=Channel_1_Input;
		bDi_2:=Channel_2_Input;
		bDi_3:=Channel_3_Input;
		bDi_4:=Channel_4_Input;
		bDi_5:=Channel_5_Input;
		bDi_6:=Channel_6_Input;
		bDi_7:=Channel_7_Input;
		bDi_8:=Channel_8_Input;
	ELSE
		bDi_1:=FALSE;
		bDi_2:=FALSE;
		bDi_3:=FALSE;
		bDi_4:=FALSE;
		bDi_5:=FALSE;
		bDi_6:=FALSE;
		bDi_7:=FALSE;
		bDi_8:=FALSE;
	END_IF
END_IF

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-el1808">
<h2>POU: EL1808<a class="headerlink" href="#pou-el1808" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Inputs/EL1808.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="n">EL1808</span> <span class="o">|</span> <span class="n">HD</span> <span class="n">EtherCAT</span> <span class="n">Terminals</span><span class="p">,</span> <span class="mi">8</span><span class="o">-</span><span class="n">channel</span> <span class="n">digital</span> <span class="n">input</span> <span class="mi">24</span> <span class="n">V</span> <span class="n">DC</span><span class="p">,</span> <span class="mi">3</span> <span class="n">ms</span><span class="p">,</span> <span class="mi">2</span><span class="o">-</span><span class="n">wire</span> <span class="n">connection</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL1808</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_1</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_2</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_3</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_4</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_5</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_6</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_7</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_8</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">Channel_1_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_2_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_3_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_4_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_5_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_6_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_7_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_8_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL1808_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL1808_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">bError</span><span class="o">=</span><span class="n">FALSE</span> <span class="k">THEN</span>
		<span class="n">bDi_1</span><span class="o">:=</span><span class="n">Channel_1_Input</span><span class="p">;</span>
		<span class="n">bDi_2</span><span class="o">:=</span><span class="n">Channel_2_Input</span><span class="p">;</span>
		<span class="n">bDi_3</span><span class="o">:=</span><span class="n">Channel_3_Input</span><span class="p">;</span>
		<span class="n">bDi_4</span><span class="o">:=</span><span class="n">Channel_4_Input</span><span class="p">;</span>
		<span class="n">bDi_5</span><span class="o">:=</span><span class="n">Channel_5_Input</span><span class="p">;</span>
		<span class="n">bDi_6</span><span class="o">:=</span><span class="n">Channel_6_Input</span><span class="p">;</span>
		<span class="n">bDi_7</span><span class="o">:=</span><span class="n">Channel_7_Input</span><span class="p">;</span>
		<span class="n">bDi_8</span><span class="o">:=</span><span class="n">Channel_8_Input</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">bDi_1</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_2</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_3</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_4</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_5</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_6</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_7</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_8</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el1809">
<h2>POU: EL1809<a class="headerlink" href="#pou-el1809" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Inputs/EL1809.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="n">EL1809</span> <span class="o">|</span> <span class="n">HD</span> <span class="n">EtherCAT</span> <span class="n">Terminals</span><span class="p">,</span> <span class="mi">16</span><span class="o">-</span><span class="n">channel</span> <span class="n">digital</span> <span class="n">input</span> <span class="mi">24</span> <span class="n">V</span> <span class="n">DC</span><span class="p">,</span> <span class="mi">3</span> <span class="n">ms</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL1809</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_1</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_2</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_3</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_4</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_5</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_6</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_7</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_8</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_9</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_10</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_11</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_12</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_13</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_14</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_15</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDi_16</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">Channel_1_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_2_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_3_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_4_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_5_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_6_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_7_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_8_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_9_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_10_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_11_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_12_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_13_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_14_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_15_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_16_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL1809_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL1809_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">bError</span><span class="o">=</span><span class="n">FALSE</span> <span class="k">THEN</span>
		<span class="n">bDi_1</span><span class="o">:=</span><span class="n">Channel_1_Input</span><span class="p">;</span>
		<span class="n">bDi_2</span><span class="o">:=</span><span class="n">Channel_2_Input</span><span class="p">;</span>
		<span class="n">bDi_3</span><span class="o">:=</span><span class="n">Channel_3_Input</span><span class="p">;</span>
		<span class="n">bDi_4</span><span class="o">:=</span><span class="n">Channel_4_Input</span><span class="p">;</span>
		<span class="n">bDi_5</span><span class="o">:=</span><span class="n">Channel_5_Input</span><span class="p">;</span>
		<span class="n">bDi_6</span><span class="o">:=</span><span class="n">Channel_6_Input</span><span class="p">;</span>
		<span class="n">bDi_7</span><span class="o">:=</span><span class="n">Channel_7_Input</span><span class="p">;</span>
		<span class="n">bDi_8</span><span class="o">:=</span><span class="n">Channel_8_Input</span><span class="p">;</span>
		<span class="n">bDi_9</span><span class="o">:=</span><span class="n">Channel_9_Input</span><span class="p">;</span>
		<span class="n">bDi_10</span><span class="o">:=</span><span class="n">Channel_10_Input</span><span class="p">;</span>
		<span class="n">bDi_11</span><span class="o">:=</span><span class="n">Channel_11_Input</span><span class="p">;</span>
		<span class="n">bDi_12</span><span class="o">:=</span><span class="n">Channel_12_Input</span><span class="p">;</span>
		<span class="n">bDi_13</span><span class="o">:=</span><span class="n">Channel_13_Input</span><span class="p">;</span>
		<span class="n">bDi_14</span><span class="o">:=</span><span class="n">Channel_14_Input</span><span class="p">;</span>
		<span class="n">bDi_15</span><span class="o">:=</span><span class="n">Channel_15_Input</span><span class="p">;</span>
		<span class="n">bDi_16</span><span class="o">:=</span><span class="n">Channel_16_Input</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">bDi_1</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_2</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_3</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_4</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_5</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_6</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_7</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_8</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_9</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_10</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_11</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_12</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_13</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_14</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_15</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">bDi_16</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el1819">
<h2>POU: EL1819<a class="headerlink" href="#pou-el1819" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Inputs/EL1819.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>///EL1819 | HD EtherCAT Terminals, 16-channel digital input 24 V DC, 10 µs
FUNCTION_BLOCK EL1819

VAR_INPUT
	En: BOOL;
	iTerminal_ID : INT;
	ErrorSystem : POINTER TO ST_ErrorSystem;
END_VAR

VAR_OUTPUT
	EnO: BOOL;
	bDi_1: BOOL;
	bDi_2: BOOL;
	bDi_3: BOOL;
	bDi_4: BOOL;
	bDi_5: BOOL;
	bDi_6: BOOL;
	bDi_7: BOOL;
	bDi_8: BOOL;
	bDi_9: BOOL;
	bDi_10: BOOL;
	bDi_11: BOOL;
	bDi_12: BOOL;
	bDi_13: BOOL;
	bDi_14: BOOL;
	bDi_15: BOOL;
	bDi_16: BOOL;
	bError: BOOL;
END_VAR

VAR
	Channel_1_Input AT %I*: BOOL;
	Channel_2_Input AT %I*: BOOL;
	Channel_3_Input AT %I*: BOOL;
	Channel_4_Input AT %I*: BOOL;
	Channel_5_Input AT %I*: BOOL;
	Channel_6_Input AT %I*: BOOL;
	Channel_7_Input AT %I*: BOOL;
	Channel_8_Input AT %I*: BOOL;
	Channel_9_Input AT %I*: BOOL;
	Channel_10_Input AT %I*: BOOL;
	Channel_11_Input AT %I*: BOOL;
	Channel_12_Input AT %I*: BOOL;
	Channel_13_Input AT %I*: BOOL;
	Channel_14_Input AT %I*: BOOL;
	Channel_15_Input AT %I*: BOOL;
	Channel_16_Input AT %I*: BOOL;
	WcState_WcState AT %I*: BOOL;
	InfoData_State AT %I*: UINT;
	
	//FB-s
	EL1819_Error : FB_TerminalError;
END_VAR
EnO:=En;

//Error FB instance
EL1819_Error(
	En := TRUE,
	iTerminal_ID := iTerminal_ID,
	bWcState := WcState_WcState,
	uiInfoData_State := InfoData_State,
	pErrorSystem := ErrorSystem,
	bError =&gt; bError,
);

IF En THEN
	IF bError=FALSE THEN
		bDi_1:=Channel_1_Input;
		bDi_2:=Channel_2_Input;
		bDi_3:=Channel_3_Input;
		bDi_4:=Channel_4_Input;
		bDi_5:=Channel_5_Input;
		bDi_6:=Channel_6_Input;
		bDi_7:=Channel_7_Input;
		bDi_8:=Channel_8_Input;
		bDi_9:=Channel_9_Input;
		bDi_10:=Channel_10_Input;
		bDi_11:=Channel_11_Input;
		bDi_12:=Channel_12_Input;
		bDi_13:=Channel_13_Input;
		bDi_14:=Channel_14_Input;
		bDi_15:=Channel_15_Input;
		bDi_16:=Channel_16_Input;
	ELSE
		bDi_1:=FALSE;
		bDi_2:=FALSE;
		bDi_3:=FALSE;
		bDi_4:=FALSE;
		bDi_5:=FALSE;
		bDi_6:=FALSE;
		bDi_7:=FALSE;
		bDi_8:=FALSE;
		bDi_9:=FALSE;
		bDi_10:=FALSE;
		bDi_11:=FALSE;
		bDi_12:=FALSE;
		bDi_13:=FALSE;
		bDi_14:=FALSE;
		bDi_15:=FALSE;
		bDi_16:=FALSE;
	END_IF
END_IF

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-el2014">
<h2>POU: EL2014<a class="headerlink" href="#pou-el2014" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Outputs/EL2014.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">EL2014</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span> 
	<span class="n">bDo_1</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_2</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_3</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_4</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">Channel_1_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_2_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_3_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_4_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL2014_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Channel</span> <span class="n">diagnostic</span> <span class="n">variables</span> <span class="k">and</span> <span class="n">device</span> <span class="n">diag</span> <span class="n">variables</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="n">EL2014_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">bError</span><span class="o">=</span><span class="n">FALSE</span> <span class="k">THEN</span>
		<span class="n">Channel_1_Output</span><span class="o">:=</span><span class="n">bDo_1</span><span class="p">;</span>
		<span class="n">Channel_2_Output</span><span class="o">:=</span><span class="n">bDo_2</span><span class="p">;</span>
		<span class="n">Channel_3_Output</span><span class="o">:=</span><span class="n">bDo_3</span><span class="p">;</span>
		<span class="n">Channel_4_Output</span><span class="o">:=</span><span class="n">bDo_4</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">Channel_1_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_2_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_3_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_4_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el2252">
<h2>POU: EL2252<a class="headerlink" href="#pou-el2252" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Outputs/EL2252.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="n">EL2252</span> <span class="o">|</span> <span class="n">XFC</span><span class="p">,</span> <span class="mi">2</span><span class="o">-</span><span class="n">channel</span> <span class="n">digital</span> <span class="n">output</span> <span class="n">terminal</span> <span class="k">with</span> <span class="kt">time</span> <span class="n">stamp</span><span class="p">,</span> <span class="n">tri</span><span class="o">-</span><span class="n">state</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL2252</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span> 
	<span class="n">bDo_1</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_2</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">Channel_1_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_2_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL2252_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Add</span> <span class="n">the</span> <span class="n">DC</span> <span class="n">sync</span> <span class="n">variables</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EL2252_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">bError</span><span class="o">=</span><span class="n">FALSE</span> <span class="k">THEN</span>
		<span class="n">Channel_1_Output</span><span class="o">:=</span><span class="n">bDo_1</span><span class="p">;</span>
		<span class="n">Channel_2_Output</span><span class="o">:=</span><span class="n">bDo_2</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">Channel_1_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_2_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el2808">
<h2>POU: EL2808<a class="headerlink" href="#pou-el2808" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Outputs/EL2808.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">EL2808</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span> 
	<span class="n">bDo_1</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_2</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_3</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_4</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_5</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_6</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_7</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_8</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">Channel_1_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_2_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_3_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_4_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_5_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_6_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_7_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_8_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL2808_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="n">EL2808_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">bError</span><span class="o">=</span><span class="n">FALSE</span> <span class="k">THEN</span>
		<span class="n">Channel_1_Output</span><span class="o">:=</span><span class="n">bDo_1</span><span class="p">;</span>
		<span class="n">Channel_2_Output</span><span class="o">:=</span><span class="n">bDo_2</span><span class="p">;</span>
		<span class="n">Channel_3_Output</span><span class="o">:=</span><span class="n">bDo_3</span><span class="p">;</span>
		<span class="n">Channel_4_Output</span><span class="o">:=</span><span class="n">bDo_4</span><span class="p">;</span>
		<span class="n">Channel_5_Output</span><span class="o">:=</span><span class="n">bDo_5</span><span class="p">;</span>
		<span class="n">Channel_6_Output</span><span class="o">:=</span><span class="n">bDo_6</span><span class="p">;</span>
		<span class="n">Channel_7_Output</span><span class="o">:=</span><span class="n">bDo_7</span><span class="p">;</span>
		<span class="n">Channel_8_Output</span><span class="o">:=</span><span class="n">bDo_8</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">Channel_1_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_2_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_3_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_4_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_5_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_6_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_7_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_8_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el2819">
<h2>POU: EL2819<a class="headerlink" href="#pou-el2819" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Outputs/EL2819.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">EL2819</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span> 
	<span class="n">bDo_1</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_2</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_3</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_4</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_5</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_6</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_7</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_8</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_9</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_10</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_11</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_12</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_13</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_14</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_15</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDo_16</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">Channel_1_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_2_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_3_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_4_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_5_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_6_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_7_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_8_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_9_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_10_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_11_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_12_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_13_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_14_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_15_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_16_Output</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL2819_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Channel</span> <span class="n">diagnostic</span> <span class="n">variables</span> <span class="k">and</span> <span class="n">device</span> <span class="n">diag</span> <span class="n">variables</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="n">EL2819_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">bError</span><span class="o">=</span><span class="n">FALSE</span> <span class="k">THEN</span>
		<span class="n">Channel_1_Output</span><span class="o">:=</span><span class="n">bDo_1</span><span class="p">;</span>
		<span class="n">Channel_2_Output</span><span class="o">:=</span><span class="n">bDo_2</span><span class="p">;</span>
		<span class="n">Channel_3_Output</span><span class="o">:=</span><span class="n">bDo_3</span><span class="p">;</span>
		<span class="n">Channel_4_Output</span><span class="o">:=</span><span class="n">bDo_4</span><span class="p">;</span>
		<span class="n">Channel_5_Output</span><span class="o">:=</span><span class="n">bDo_5</span><span class="p">;</span>
		<span class="n">Channel_6_Output</span><span class="o">:=</span><span class="n">bDo_6</span><span class="p">;</span>
		<span class="n">Channel_7_Output</span><span class="o">:=</span><span class="n">bDo_7</span><span class="p">;</span>
		<span class="n">Channel_8_Output</span><span class="o">:=</span><span class="n">bDo_8</span><span class="p">;</span>
		<span class="n">Channel_9_Output</span><span class="o">:=</span><span class="n">bDo_9</span><span class="p">;</span>
		<span class="n">Channel_10_Output</span><span class="o">:=</span><span class="n">bDo_10</span><span class="p">;</span>
		<span class="n">Channel_11_Output</span><span class="o">:=</span><span class="n">bDo_11</span><span class="p">;</span>
		<span class="n">Channel_12_Output</span><span class="o">:=</span><span class="n">bDo_12</span><span class="p">;</span>
		<span class="n">Channel_13_Output</span><span class="o">:=</span><span class="n">bDo_13</span><span class="p">;</span>
		<span class="n">Channel_14_Output</span><span class="o">:=</span><span class="n">bDo_14</span><span class="p">;</span>
		<span class="n">Channel_15_Output</span><span class="o">:=</span><span class="n">bDo_15</span><span class="p">;</span>
		<span class="n">Channel_16_Output</span><span class="o">:=</span><span class="n">bDo_16</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">Channel_1_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_2_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_3_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_4_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_5_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_6_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_7_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_8_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_9_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_10_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_11_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_12_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_13_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_14_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_15_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Channel_16_Output</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el3174-0002">
<h2>POU: EL3174_0002<a class="headerlink" href="#pou-el3174-0002" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Analog_Inputs/EL3174_0002.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">EL3174</span><span class="o">-</span><span class="mi">0002</span> <span class="o">|</span> <span class="mi">4</span><span class="o">-</span><span class="n">channel</span> <span class="n">analog</span> <span class="n">input</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="o">/</span><span class="mi">0</span><span class="p">...</span><span class="o">+</span><span class="mi">10</span><span class="n">V</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="o">/</span><span class="mi">0</span><span class="o">/+</span><span class="mi">4</span><span class="p">...</span><span class="mi">20</span><span class="n">mA</span><span class="p">,</span> <span class="mi">16</span> <span class="kt">bit</span><span class="p">,</span> <span class="n">differential</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL3174_0002</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>
	
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iAi_Ch1_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">iAi_Ch2_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">iAi_Ch3_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">iAi_Ch4_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="o">//</span><span class="n">Channels</span>
	<span class="n">AI_Std_Ch_1_Status</span>	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">WORD</span><span class="p">;</span>
	<span class="n">AI_Std_Ch_1_Value</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">AI_Std_Ch_2_Status</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">WORD</span><span class="p">;</span>
	<span class="n">AI_Std_Ch_2_Value</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">AI_Std_Ch_3_Status</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">WORD</span><span class="p">;</span>
	<span class="n">AI_Std_Ch_3_Value</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">AI_Std_Ch_4_Status</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">WORD</span><span class="p">;</span>
	<span class="n">AI_Std_Ch_4_Value</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">Terminal</span> <span class="n">status</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL3174_0002_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Status</span> <span class="n">words</span> <span class="k">of</span> <span class="n">the</span> <span class="n">channels</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EnO</span> <span class="o">:=</span> <span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL3174_0002_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">bError</span> <span class="o">=</span> <span class="n">FALSE</span> <span class="k">THEN</span>
		<span class="n">iAi_Ch1_Value</span> <span class="o">:=</span> <span class="n">AI_Std_Ch_1_Value</span><span class="p">;</span>
		<span class="n">iAi_Ch2_Value</span> <span class="o">:=</span> <span class="n">AI_Std_Ch_2_Value</span><span class="p">;</span>
		<span class="n">iAi_Ch3_Value</span> <span class="o">:=</span> <span class="n">AI_Std_Ch_3_Value</span><span class="p">;</span>
		<span class="n">iAi_Ch4_Value</span> <span class="o">:=</span> <span class="n">AI_Std_Ch_4_Value</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">iAi_Ch1_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">iAi_Ch2_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">iAi_Ch3_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">iAi_Ch4_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el3214">
<h2>POU: EL3214<a class="headerlink" href="#pou-el3214" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Analog_Inputs/EL3214.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">EL3214</span> <span class="o">|</span> <span class="mi">4</span><span class="o">-</span><span class="n">channel</span> <span class="n">analog</span> <span class="n">input</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">PT100</span> <span class="p">(</span><span class="n">RTD</span><span class="p">)</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL3214</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iAi_Ch1_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">iAi_Ch2_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">iAi_Ch3_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">iAi_Ch4_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="o">//</span><span class="n">Channels</span>
	<span class="n">AI_RTD_Ch_1_Status</span>	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">WORD</span><span class="p">;</span>
	<span class="n">AI_RTD_Ch_1_Value</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">AI_RTD_Ch_2_Status</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">WORD</span><span class="p">;</span>
	<span class="n">AI_RTD_Ch_2_Value</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">AI_RTD_Ch_3_Status</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">WORD</span><span class="p">;</span>
	<span class="n">AI_RTD_Ch_3_Value</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">AI_RTD_Ch_4_Status</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">WORD</span><span class="p">;</span>
	<span class="n">AI_RTD_Ch_4_Value</span> 	<span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">Terminal</span> <span class="n">status</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL3214_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Status</span> <span class="n">words</span> <span class="k">of</span> <span class="n">the</span> <span class="n">channels</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EnO</span> <span class="o">:=</span> <span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL3214_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">bError</span> <span class="o">=</span> <span class="n">FALSE</span> <span class="k">THEN</span>
		<span class="n">iAi_Ch1_Value</span> <span class="o">:=</span> <span class="n">AI_RTD_Ch_1_Value</span><span class="p">;</span>
		<span class="n">iAi_Ch2_Value</span> <span class="o">:=</span> <span class="n">AI_RTD_Ch_2_Value</span><span class="p">;</span>
		<span class="n">iAi_Ch3_Value</span> <span class="o">:=</span> <span class="n">AI_RTD_Ch_3_Value</span><span class="p">;</span>
		<span class="n">iAi_Ch4_Value</span> <span class="o">:=</span> <span class="n">AI_RTD_Ch_4_Value</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">iAi_Ch1_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">iAi_Ch2_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">iAi_Ch3_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">iAi_Ch4_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el3255">
<h2>POU: EL3255<a class="headerlink" href="#pou-el3255" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Analog_Inputs/EL3255.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">EL3255</span> <span class="o">|</span> <span class="mi">5</span><span class="o">-</span><span class="n">channel</span> <span class="n">potentiometer</span> <span class="n">measurement</span> <span class="k">with</span> <span class="n">sensor</span> <span class="n">supply</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL3255</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">Ch1_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">Ch2_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">Ch3_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">Ch4_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">Ch5_Value</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">bError</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">AI_Std_Ch1_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">AI_Std_Ch2_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">AI_Std_Ch3_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">AI_Std_Ch4_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">AI_Std_Ch5_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL3255_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Channel</span> <span class="n">Status</span> <span class="n">words</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL3255_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">EN</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bError</span> <span class="k">THEN</span>
		<span class="n">Ch1_Value</span> <span class="o">:=</span> <span class="n">AI_Std_Ch1_Value</span><span class="p">;</span>
		<span class="n">Ch2_Value</span> <span class="o">:=</span> <span class="n">AI_Std_Ch2_Value</span><span class="p">;</span>
		<span class="n">Ch3_Value</span> <span class="o">:=</span> <span class="n">AI_Std_Ch3_Value</span><span class="p">;</span>
		<span class="n">Ch4_Value</span> <span class="o">:=</span> <span class="n">AI_Std_Ch4_Value</span><span class="p">;</span>
		<span class="n">Ch5_Value</span> <span class="o">:=</span> <span class="n">AI_Std_Ch5_Value</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">Ch1_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Ch2_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Ch3_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Ch4_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Ch5_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el5002">
<h2>POU: EL5002<a class="headerlink" href="#pou-el5002" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Measuring_Terminals/EL5002.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">EL5002</span> <span class="o">|</span> <span class="mi">2</span><span class="o">-</span><span class="n">chennel</span> <span class="n">SSI</span> <span class="n">absolute</span> <span class="n">encoder</span> <span class="n">terminal</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL5002</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Ch1_Counter_Value</span> <span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">Ch2_Counter_Value</span> <span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">udi_Ch1_Cnt_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">udi_Ch2_Cnt_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL5002_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Channel</span> <span class="n">Status</span> <span class="n">words</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL5002_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">EN</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bError</span> <span class="k">THEN</span>
		<span class="n">Ch1_Counter_Value</span> <span class="o">:=</span> <span class="n">udi_Ch1_Cnt_Value</span><span class="p">;</span>
		<span class="n">Ch2_Counter_Value</span> <span class="o">:=</span> <span class="n">udi_Ch2_Cnt_Value</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">Ch1_Counter_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Ch2_Counter_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el5021">
<h2>POU: EL5021<a class="headerlink" href="#pou-el5021" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Measuring_Terminals/EL5021.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">EL5021</span> <span class="o">|</span> <span class="mi">1</span><span class="o">-</span><span class="n">channel</span> <span class="n">Sin</span><span class="o">/</span><span class="n">Cos</span> <span class="n">encoder</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL5021</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Counter_Value</span> <span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">Latch_Value</span> <span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">udiCounter_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">udiLatch_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL5021_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Channel</span> <span class="n">Status</span> <span class="n">words</span><span class="p">,</span> <span class="n">control</span> <span class="n">words</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL5021_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">EN</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bError</span> <span class="k">THEN</span>
		<span class="n">Counter_Value</span> <span class="o">:=</span> <span class="n">udiCounter_Value</span><span class="p">;</span>
		<span class="n">Latch_Value</span> <span class="o">:=</span> <span class="n">udiLatch_Value</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">Counter_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Latch_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el5042">
<h2>POU: EL5042<a class="headerlink" href="#pou-el5042" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Measuring_Terminals/EL5042.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">EL5042</span> <span class="o">|</span> <span class="mi">2</span><span class="o">-</span><span class="n">channel</span> <span class="n">BiSS</span><span class="o">-</span><span class="n">C</span> <span class="n">absolute</span> <span class="n">encoder</span> <span class="n">terminal</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL5042</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Ch1_Position</span> <span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">Ch2_Position</span> <span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">FB_Inputs_ch1_Position</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">FB_Inputs_ch2_Position</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL5042_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Channel</span> <span class="n">Status</span> <span class="n">words</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL5042_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">EN</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bError</span> <span class="k">THEN</span>
		<span class="n">Ch1_Position</span> <span class="o">:=</span> <span class="n">FB_Inputs_ch1_Position</span><span class="p">;</span>
		<span class="n">Ch2_Position</span> <span class="o">:=</span> <span class="n">FB_Inputs_ch2_Position</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">Ch1_Position</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Ch2_Position</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el5101">
<h2>POU: EL5101<a class="headerlink" href="#pou-el5101" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Measuring_Terminals/EL5101.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">EL5101</span> <span class="o">|</span> <span class="mi">1</span><span class="o">-</span><span class="n">channel</span> <span class="n">incremental</span> <span class="n">encoder</span> <span class="n">terminal</span><span class="p">,</span> <span class="mi">5</span><span class="n">V</span><span class="p">,</span> <span class="n">RS422</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL5101</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Counter_Value</span> <span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">Latch_Value</span> <span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">uiCounter_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">uiLatch_Value</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL5101_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Channel</span> <span class="n">Status</span> <span class="n">word</span><span class="p">,</span> <span class="n">control</span> <span class="n">words</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL5101_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">IF</span> <span class="n">EN</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bError</span> <span class="k">THEN</span>
		<span class="n">Counter_Value</span> <span class="o">:=</span> <span class="n">uiCounter_Value</span><span class="p">;</span>
		<span class="n">Latch_Value</span> <span class="o">:=</span> <span class="n">uiLatch_Value</span><span class="p">;</span>
	<span class="k">ELSE</span>
		<span class="n">Counter_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Latch_Value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el7211-v1-00">
<h2>POU: EL7211_v1_00<a class="headerlink" href="#pou-el7211-v1-00" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Motion/EL7211_v1_00.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="n">EL7211</span> <span class="o">|</span> <span class="n">Servo</span> <span class="n">motor</span> <span class="n">termional</span> <span class="mi">5</span> <span class="n">A</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL7211_v1_00</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>

	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">AND</span> <span class="p">(</span><span class="n">WcState_WcState</span> <span class="k">OR</span> <span class="n">InfoData_State</span><span class="o">&lt;&gt;</span><span class="mi">16#8</span><span class="p">)</span> <span class="k">THEN</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="k">ELSE</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el9410">
<h2>POU: EL9410<a class="headerlink" href="#pou-el9410" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/System/EL9410.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">EL9410</span> <span class="o">|</span> <span class="n">E</span><span class="o">-</span><span class="k">Bus</span> <span class="n">power</span> <span class="n">supplier</span> <span class="k">and</span> <span class="n">refresher</span><span class="p">,</span> <span class="n">diagnostics</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL9410</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">bStatus_Us_UV</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bStatus_Up_UV</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL9410_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Status</span> <span class="n">bits</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL9410_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el9505">
<h2>POU: EL9505<a class="headerlink" href="#pou-el9505" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/System/EL9505.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">EL9505</span> <span class="o">|</span> <span class="n">Power</span> <span class="n">supply</span> <span class="n">terminal</span> <span class="mi">5</span><span class="n">V</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL9505</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">bStatus_Uo_Power_OK</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bStatus_Uo_Overload</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	<span class="n">EL9505_Error</span> <span class="o">:</span> <span class="n">FB_TerminalError</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="n">TODO</span><span class="o">:</span>
<span class="o">*</span> <span class="n">Status</span> <span class="n">bits</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Error</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">EL9505_Error</span><span class="p">(</span>
	<span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
	<span class="n">iTerminal_ID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">,</span>
	<span class="n">bWcState</span> <span class="o">:=</span> <span class="n">WcState_WcState</span><span class="p">,</span>
	<span class="n">uiInfoData_State</span> <span class="o">:=</span> <span class="n">InfoData_State</span><span class="p">,</span>
	<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">,</span>
	<span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
<span class="p">);</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-el9576-v1-00">
<h2>POU: EL9576_v1_00<a class="headerlink" href="#pou-el9576-v1-00" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Motion/EL9576_v1_00.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="n">EL9576</span> <span class="o">|</span> <span class="n">Brake</span> <span class="n">terminal</span> <span class="p">(</span><span class="n">vap</span> <span class="k">and</span> <span class="n">resistor</span><span class="p">)</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">EL9576_v1_00</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">OverTemperature</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">I2TError</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">I2TWarning</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">OverVoltage</span>  <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">UnderVoltage</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">ChopperOn</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">DCLinkVoltage</span> <span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">DutyCycle</span>  <span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">ResistorCurrent</span> <span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">BCTOverTemperature</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">BCTI2TError</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">BCTI2TWarning</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">BCTOverVoltage</span>  <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">BCTUnderVoltage</span>  <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">BCTChopperOn</span>  <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">BCTDCLinkVoltage</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">BCTDutyCycle</span>  <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">USINT</span><span class="p">;</span>
	<span class="n">BCTResistorCurrent</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
	
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">AND</span> <span class="p">(</span><span class="n">WcState_WcState</span> <span class="k">OR</span> <span class="n">InfoData_State</span><span class="o">&lt;&gt;</span><span class="mi">16#8</span> <span class="k">OR</span> <span class="n">BCTI2TError</span> <span class="k">OR</span> <span class="n">BCTI2TWarning</span> <span class="k">OR</span> <span class="n">BCTOverTemperature</span> <span class="k">OR</span> <span class="n">BCTOverVoltage</span> <span class="k">OR</span> <span class="n">BCTUnderVoltage</span><span class="p">)</span> <span class="k">THEN</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="k">ELSE</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">OverTemperature</span><span class="o">:=</span><span class="n">BCTOverTemperature</span><span class="p">;</span>
<span class="n">I2TError</span><span class="o">:=</span><span class="n">BCTI2TError</span><span class="p">;</span>
<span class="n">I2TWarning</span><span class="o">:=</span><span class="n">BCTI2TWarning</span><span class="p">;</span>
<span class="n">OverVoltage</span><span class="o">:=</span><span class="n">BCTOverVoltage</span><span class="p">;</span>
<span class="n">UnderVoltage</span><span class="o">:=</span><span class="n">bctUnderVoltage</span><span class="p">;</span>
<span class="n">ChopperOn</span><span class="o">:=</span><span class="n">bctChopperOn</span><span class="p">;</span>
<span class="n">DCLinkVoltage</span><span class="o">:=</span><span class="n">UDINT_TO_LREAL</span><span class="p">(</span><span class="n">bctDCLinkVoltage</span><span class="p">);</span>
<span class="n">DutyCycle</span><span class="o">:=</span><span class="n">USINT_TO_LREAL</span><span class="p">(</span><span class="n">BCTDutyCycle</span><span class="p">);</span>
<span class="n">ResistorCurrent</span><span class="o">:=</span><span class="n">UDINT_TO_LREAL</span><span class="p">(</span><span class="n">BCTResistorCurrent</span><span class="p">);</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-calculatefrequency-3702-v0-01">
<h2>POU: FB_CalculateFrequency_3702_v0_01<a class="headerlink" href="#pou-fb-calculatefrequency-3702-v0-01" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Analog_Inputs/FB_CalculateFrequency_3702_v0_01.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_CalculateFrequency_3702_v0_01</span>
<span class="n">VAR</span> <span class="k">CONSTANT</span>
	<span class="o">///</span><span class="mi">200</span> <span class="n">samples</span><span class="o">/</span><span class="n">period</span>
	<span class="n">cBufferSize</span><span class="o">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bCalculate</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">aBufferValue</span><span class="o">:</span> <span class="k">ARRAY</span><span class="p">[</span><span class="mi">0</span><span class="p">..(</span><span class="n">cBuffersize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">OF</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">aBufferDcTime</span><span class="o">:</span> <span class="k">ARRAY</span><span class="p">[</span><span class="mi">0</span><span class="p">..(</span><span class="n">cBuffersize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">OF</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="o">///</span><span class="k">If</span> <span class="n">curve</span> <span class="n">has</span> <span class="n">a</span> <span class="n">DC</span> <span class="n">offset</span>
	<span class="n">nDCOffset</span><span class="o">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">fActFrequency</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">nIndex</span><span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">nFirstZeroCrossing</span><span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">nLastZeroCrossing</span><span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">rTimeFirst</span><span class="o">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">rTimeLast</span><span class="o">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">rTimeRes</span><span class="o">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">nCrossings</span><span class="o">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_TEMP</span>
	<span class="n">rRange</span><span class="o">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">rTimeSpan</span><span class="o">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>
<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">nCrossings</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">En</span> <span class="k">AND</span> <span class="n">bCalculate</span> <span class="k">THEN</span>
	<span class="o">//</span><span class="n">Serach</span> <span class="k">for</span> <span class="n">crossings</span> <span class="k">of</span> <span class="n">nDCOffset</span>
	<span class="k">FOR</span> <span class="n">nIndex</span><span class="o">:=</span><span class="mi">1</span> <span class="k">TO</span> <span class="n">cBuffersize</span><span class="o">-</span><span class="mi">1</span> <span class="n">DO</span>
		<span class="k">IF</span><span class="p">((</span><span class="n">aBufferValue</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">&gt;</span><span class="n">nDCOffset</span> <span class="k">AND</span> <span class="n">aBufferValue</span><span class="p">[</span><span class="n">nIndex</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">nDCOffset</span><span class="p">)</span> <span class="k">OR</span> <span class="p">(</span><span class="n">aBufferValue</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">&lt;</span><span class="n">nDCOffset</span> <span class="k">AND</span> <span class="n">aBufferValue</span><span class="p">[</span><span class="n">nIndex</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">nDCOffset</span><span class="p">))</span>	<span class="k">THEN</span>
			<span class="k">IF</span><span class="p">(</span><span class="n">nCrossings</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
				<span class="n">nFirstZeroCrossing</span><span class="o">:=</span><span class="n">nIndex</span><span class="p">;</span>
			<span class="n">END_IF</span>
			<span class="n">nLastZeroCrossing</span><span class="o">:=</span><span class="n">nIndex</span><span class="p">;</span>
			<span class="n">nCrossings</span><span class="o">:=</span><span class="n">nCrossings</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">END_IF</span>
	<span class="n">END_FOR</span>	
	
	<span class="k">IF</span> <span class="n">nFirstZeroCrossing</span> <span class="o">&lt;</span> <span class="n">nLastZeroCrossing</span>  <span class="k">AND</span>  <span class="n">nCrossings</span><span class="o">&gt;</span><span class="mi">2</span> <span class="k">THEN</span>
		<span class="o">//</span><span class="n">interpolate</span> <span class="n">zero</span> <span class="n">crossings</span> <span class="k">for</span> <span class="n">higher</span> <span class="n">accuracy</span>
		<span class="n">rTimeRes</span><span class="o">:=</span><span class="n">UDINT_TO_REAL</span><span class="p">(</span><span class="n">aBufferDcTime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">aBufferDcTime</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="o">//</span><span class="k">Buffer</span> <span class="n">must</span> <span class="n">contain</span> <span class="n">more</span> <span class="n">than</span> <span class="mi">2</span> <span class="n">values</span>
		<span class="n">rRange</span><span class="o">:=</span><span class="n">INT_TO_REAL</span><span class="p">(</span><span class="k">ABS</span><span class="p">(</span><span class="n">aBufferValue</span><span class="p">[</span><span class="n">nFirstZeroCrossing</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">aBufferValue</span><span class="p">[</span><span class="n">nFirstZeroCrossing</span><span class="p">]));</span>
		<span class="n">rTimeFirst</span><span class="o">:=</span><span class="n">UDINT_TO_REAL</span><span class="p">(</span> <span class="n">aBufferDcTime</span><span class="p">[</span><span class="n">nFirstZeroCrossing</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="k">ABS</span><span class="p">(</span><span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">aBufferValue</span><span class="p">[</span><span class="n">nFirstZeroCrossing</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">rRange</span><span class="o">*</span><span class="n">rTimeRes</span><span class="p">);</span>
		<span class="n">rRange</span><span class="o">:=</span><span class="n">INT_TO_REAL</span><span class="p">(</span><span class="k">ABS</span><span class="p">(</span><span class="n">aBufferValue</span><span class="p">[</span><span class="n">nLastZeroCrossing</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">aBufferValue</span><span class="p">[</span><span class="n">nLastZeroCrossing</span><span class="p">]));</span>
		<span class="n">rTimeLast</span><span class="o">:=</span><span class="n">UDINT_TO_REAL</span><span class="p">(</span> <span class="n">aBufferDcTime</span><span class="p">[</span><span class="n">nLastZeroCrossing</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="k">ABS</span><span class="p">(</span><span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">aBufferValue</span><span class="p">[</span><span class="n">nLastZeroCrossing</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">rRange</span><span class="o">*</span><span class="n">rTimeRes</span><span class="p">);</span>

		<span class="o">//</span><span class="kt">Time</span> <span class="n">span</span> <span class="n">first</span> <span class="k">to</span> <span class="n">last</span> <span class="p">(</span><span class="n">considering</span> <span class="n">that</span> <span class="n">max</span> <span class="n">one</span> <span class="kt">time</span> <span class="n">counter</span> <span class="n">overflow</span> <span class="n">have</span> <span class="n">occured</span> <span class="k">in</span> <span class="n">the</span> <span class="n">total</span> <span class="kt">time</span> <span class="k">range</span> <span class="k">of</span> <span class="n">the</span> <span class="kt">time</span> <span class="k">buffer</span><span class="p">)</span>	
		<span class="k">IF</span> <span class="n">rTimeFirst</span><span class="o">&lt;</span><span class="n">rTimeLast</span> <span class="k">THEN</span>		
			<span class="n">rTimeSpan</span><span class="o">:=</span><span class="n">rTimeLast</span><span class="o">-</span><span class="n">rTimeFirst</span><span class="p">;</span>
		<span class="k">ELSE</span> <span class="o">//</span><span class="n">overflow</span> <span class="k">of</span> <span class="n">counter</span> <span class="n">once</span> <span class="p">(</span><span class="n">only</span> <span class="mi">32</span><span class="kt">bit</span> <span class="n">timestamp</span> <span class="o">=</span><span class="mi">4</span><span class="p">.</span><span class="mi">29</span><span class="n">seconds</span><span class="p">)</span>
			<span class="n">rTimeSpan</span><span class="o">:=</span><span class="mi">4294967296</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span><span class="n">rTimeFirst</span><span class="o">+</span><span class="n">rTimeLast</span><span class="p">;</span>
		<span class="n">END_IF</span>
		
		<span class="n">fActFrequency</span><span class="o">:=</span><span class="mi">1000000000</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">rTimeSpan</span><span class="o">*</span><span class="p">(</span><span class="n">nCrossings</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="o">//</span><span class="n">two</span> <span class="n">crossings</span> <span class="n">per</span> <span class="n">period</span> <span class="o">=&gt;</span> <span class="n">Average</span> <span class="n">frequency</span> <span class="n">over</span> <span class="k">buffer</span><span class="p">.</span>
	<span class="k">ELSE</span>
		<span class="n">fActFrequency</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-drivevirtual">
<h2>POU: FB_DriveVirtual<a class="headerlink" href="#pou-fb-drivevirtual" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/FB_DriveVirtual.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>///#########################################################
///Function block to run a virtual drive with Nc
///	Library:		
///	Tc2_MC2.lib
///
///	Global Variables:
///	
///	Data types:
///	
///	External functions:
///
///###########################################################
FUNCTION_BLOCK FB_DriveVirtual
VAR
	sVersion: STRING:=&#39;1.0.3&#39;;	
END_VAR
VAR_INPUT
	En: BOOL;
	bEnable: BOOL;
	bReset: BOOL;
	bExecute: BOOL;
	/////	nCommandLocal...
	/////	0 = Jog
	/////	1 = MoveVelocity
	/////	2 = MoveRelative
	/////	3 = MoveAbsolut
	/////	4 = MoveModulo
	/////	10 = Homing
	/////	20 = SuperInp &gt;&gt;&gt;ToBe
	/////	30 = Gear
	nCommand: UINT;
	nCmdData: UINT;
	fVelocity: LREAL;
	fPosition: LREAL;
	fAcceleration: LREAL;
	fDeceleration: LREAL;
	bJogFwd: BOOL;
	bJogBwd: BOOL;
	bLimitFwd: BOOL;
	bLimitBwd: BOOL;	
	fOverride: LREAL := 100;
	bHomeSensor: BOOL;
	fHomePosition:LREAL;
	nHomeRevOffset: UINT;
	MasterAxis: AXIS_REF;
	bPowerSelf: BOOL;
END_VAR
VAR_OUTPUT
	EnO: BOOL;
	bEnabled: BOOL;
	bBusy: BOOL;
	bDone: BOOL;
	bError: BOOL;
	bHomed: BOOL;
	nErrorId: UDINT;
	nMotionAxisID:UDINT:=0;  //Axis id in Motion (NC)
	Status: ST_AxisStatus;
	fActVelocity: LREAL;
	fActPosition: LREAL;
	fActDiff: LREAL;
    sErrorMessage:STRING;
END_VAR
VAR_IN_OUT
	Axis: AXIS_REF;
END_VAR
VAR	
	nCommandLocal: UINT;
	nCmdDataLocal: UINT;
	bFirstScan: BOOL := TRUE;
	fbReset: MC_Reset;
	fbPower: MC_Power;
	fbHalt: MC_Halt;
	fbJog: MC_Jog;
	fbMoveVelocity: MC_MoveVelocity;
	fbMoveRelative: MC_MoveRelative;
	fbMoveAbsolute: MC_MoveAbsolute;
	fbMoveModulo: MC_MoveModulo;	
	fbHomeVirtual:FB_HomeVirtual;
	fbGearInDyn: MC_GearInDyn;
	fbGearOut: MC_GearOut;
	fbExecuteRiseEdge: R_TRIG;
	stAxisStatus: DUT_AxisStatus_v0_01;	
END_VAR
EnO:=En;

// Transfer nCommand and nCmdData to local copies at rising edge of bExecute (avoid issues if nCommand or nCmdData are changed during a command) 
fbExecuteRiseEdge(CLK:=bExecute);
IF fbExecuteRiseEdge.Q THEN
  nCmdDataLocal:=nCmdData;
  nCommandLocal:=nCommand;
END_IF

bHomed:=fbHomeVirtual.bHomed; //Add in DUT_AxisStatus later
bDone:=FALSE;

(*Reset*)
fbReset(
	Execute:=bReset AND Axis.Status.Error,
	Axis:=Axis,
	Done=&gt; ,
	Busy=&gt; ,
	Error=&gt; ,
	ErrorID=&gt; );

(*Power*)
IF bPowerSelf THEN
fbPower(
	Axis:=Axis,
	Enable:=bEnable,	
	Enable_Positive:=bEnable AND bLimitFwd,	
	Enable_Negative:=bEnable AND bLimitBwd,	
	Override:=fOverride,
	BufferMode:= ,
	Status=&gt; ,
	Busy=&gt; ,
	Active=&gt; ,
	Error=&gt; ,
	ErrorID=&gt; );
END_IF

(*Halt*)
fbHalt(
	Execute:=NOT bExecute  AND (((fbMoveVelocity.Busy OR fbPower.Busy) AND (nCommandLocal=1)) OR (fbMoveRelative.Busy AND (nCommandLocal=2)) OR (fbMoveAbsolute.Busy AND (nCommandLocal=3)) OR (fbMoveModulo.Busy AND (nCommandLocal=4)) OR (fbHomeVirtual.bBusy AND (nCommandLocal=10))),
	Deceleration:=fDeceleration,
	Jerk:=0,
	BufferMode:= ,
	Options:= ,
	Axis:=Axis ,
	Done=&gt; ,
	Busy=&gt; ,
	Active=&gt; ,
	CommandAborted=&gt; ,
	Error=&gt; ,
	ErrorID=&gt; );

(*Jog (Command = 0)*)
fbJog(
	JogForward:=bJogFwd AND (nCommandLocal=0) ,
	JogBackwards:=bJogBwd AND (nCommandLocal=0) ,
	Mode:=UINT_TO_INT(nCmdDataLocal),
	Position:= ,
	Velocity:=fVelocity,
	Acceleration:=fAcceleration,
	Deceleration:=fDeceleration,
	Jerk:=0,
	Axis:=Axis,
	Done=&gt; ,
	Busy=&gt; ,
	Active=&gt; ,
	CommandAborted=&gt; ,
	Error=&gt; ,
	ErrorID=&gt; );

(*MoveVelocity (Command = 1)*)
fbMoveVelocity(
	Execute:=bExecute AND (nCommandLocal=1),
	Velocity:=ABS(fVelocity),
	Acceleration:=fAcceleration,
	Deceleration:=fDeceleration,
	Jerk:=0,
	Direction:=SEL(fVelocity&lt;0, MC_Positive_Direction, MC_Negative_Direction),
	BufferMode:= ,
	Options:= ,
	Axis:=Axis,
	InVelocity=&gt; ,
	Busy=&gt; ,
	Active=&gt; ,
	CommandAborted=&gt; ,
	Error=&gt; ,
	ErrorID=&gt; );

(*MoveRelative (Command = 2)*)
fbMoveRelative(
	Execute:=bExecute AND (nCommandLocal=2), 
	Distance:=fPosition, 
	Velocity:=ABS(fVelocity), 
	Acceleration:=fAcceleration,
	Deceleration:=fDeceleration,
	Jerk:=0,
	BufferMode:= , 
	Options:= , 
	Axis:=Axis, 
	Done=&gt; , 
	Busy=&gt; , 
	Active=&gt; , 
	CommandAborted=&gt; , 
	Error=&gt; , 
	ErrorID=&gt; );
	
IF nCommandLocal=2 THEN
	bDone:=fbMoveRelative.Done;
END_IF
	
(*MoveAbsolute (Command = 3)*)
fbMoveAbsolute(
	Execute:=bExecute AND (nCommandLocal=3),
	Position:=fPosition,
	Velocity:=ABS(fVelocity),
	Acceleration:=fAcceleration,
	Deceleration:=fDeceleration,
	Jerk:=0,
	BufferMode:= ,
	Options:= ,
	Axis:=Axis,
	Done=&gt; ,
	Busy=&gt; ,
	Active=&gt; ,
	CommandAborted=&gt; ,
	Error=&gt; ,
	ErrorID=&gt; );

IF nCommandLocal=3 THEN
	bDone:=fbMoveAbsolute.Done;
END_IF

(*MoveModulo (Command = 4)*)
fbMoveModulo(
	Execute:=bExecute AND (nCommandLocal=4), 
	Position:=fPosition, 
	Velocity:=ABS(fVelocity), 
	Acceleration:=fAcceleration, 
	Deceleration:=fDeceleration, 
	Jerk:=0, 
	Direction:=UINT_TO_INT(nCmdDataLocal), 
	BufferMode:= , 
	Options:= , 
	Axis:=Axis, 
	Done=&gt; , 
	Busy=&gt; , 
	Active=&gt; , 
	CommandAborted=&gt; , 
	Error=&gt; , 
	ErrorID=&gt; );

IF nCommandLocal=4 THEN
	bDone:=fbMoveModulo.Done;
END_IF
	
(*Home (Command = 10)*)
fbHomeVirtual(	
	bExecute:= nCommandLocal=10 AND bExecute,
	fHomePosition:=fHomePosition,
	bHomeSensor:=bHomeSensor,
	bLimitBwd:=bLimitBwd,
	bLimitFwd:=bLimitFwd,
	nCmdData:=nCmdDataLocal,
	bReset:=bReset,
	nHomeRevOffset:=nHomeRevOffset,
	Axis:=Axis
	);
	
IF nCommandLocal=10 THEN
	bDone:=fbHomeVirtual.bDone;
END_IF
	
(*Gear (Command = 30)*)
fbGearInDyn(
	Enable:=bExecute  AND (nCommandLocal=30),
	GearRatio:=SEL(nCmdDataLocal&gt;0, 1,fVelocity),
	Acceleration:=fAcceleration,
	Deceleration:=fDeceleration,
	Jerk:=0.0,
	BufferMode:= , 
	Options:= , 
	Master:=MasterAxis,
	Slave:=Axis,
	InGear=&gt; , 
	Busy=&gt; , 
	Active=&gt; , 
	CommandAborted=&gt; , 
	Error=&gt; , 
	ErrorID=&gt; );
	
fbGearOut(
	Execute:=NOT bExecute AND Axis.Status.NotMoving AND (nCommandLocal=30),
	Slave:=Axis,
	Error=&gt;,
	Done=&gt;,
	ErrorID=&gt;);


IF nCommandLocal=30 THEN
	bDone:=Axis.Status.Coupled;
END_IF

(*Busy*)
bBusy:=Axis.Status.HasJob OR Axis.Status.HomingBusy OR fbHomeVirtual.bBusy;

(*Enabled*)
bEnabled:=fbPower.Status;

(*Error from functions and Nc*)
IF fbPower.Error AND fbPower.Active THEN
	bError:=fbPower.Enable;
	nErrorId:=fbPower.ErrorID;
ELSIF fbHalt.Error AND fbHalt.Active THEN
	bError:=fbHalt.Execute;
	nErrorId:=fbHalt.ErrorID;
ELSIF fbJog.Error AND nCommandLocal=0 (*fbJog.Active*) THEN
	bError:=fbJog.JogForward OR fbJog.JogBackwards;
	nErrorId:=fbJog.ErrorID;
ELSIF fbMoveVelocity.Error AND nCommandLocal=1(*fbMoveVelocity.Active*) THEN
	bError:=fbMoveVelocity.Execute;
	nErrorId:=fbMoveVelocity.ErrorID;
ELSIF fbMoveRelative.Error AND nCommandLocal=2 (*fbMoveRelative.Active*) THEN
	bError:=fbMoveRelative.Execute;
	nErrorId:=fbMoveRelative.ErrorID;
ELSIF fbMoveAbsolute.Error AND nCommandLocal=3 (*fbMoveAbsolute.Active*) THEN
	bError:=fbMoveAbsolute.Execute;
	nErrorId:=fbMoveAbsolute.ErrorID;
ELSIF fbMoveModulo.Error AND nCommandLocal=4 (*fbMoveModulo.Active*) THEN
	bError:=fbMoveModulo.Execute;
	nErrorId:=fbMoveModulo.ErrorID;
ELSIF fbHomeVirtual.bError AND nCommandLocal=10 (*fbHome.Active*) THEN
	bError:=fbHomeVirtual.bError;
	nErrorId:=fbHomeVirtual.nErrorID;
ELSIF fbGearInDyn.Error AND nCommandLocal=30 (*fbGearInDyn.Active*) THEN
	bError:=fbGearInDyn.Enable;
	nErrorId:=fbGearInDyn.ErrorID;
ELSIF fbGearOut.Error AND nCommandLocal=30 AND Axis.Status.Coupled THEN
	bError:=fbGearOut.Execute;
	nErrorId:=fbGearOut.ErrorID;
ELSIF Axis.Status.Error  THEN
	bError:=TRUE;
	nErrorId:=Axis.Status.ErrorID;
ELSIF fbHomeVirtual.bError THEN
	bError:=TRUE;
	nErrorId:=fbHomeVirtual.nErrorId;
ELSE
	bError:=FALSE;
	nErrorId:=0;
END_IF;

(*Converese nErrorID to string*)
sErrorMessage:=WORD_TO_HEXSTR(in:=TO_WORD(nErrorID) , iPrecision:= 4, bLoCase:=0 );

(*Status from Nc*)
Status:=Axis.Status;

(*Axis id in motion &quot;motor&quot;*)
nMotionAxisID:=axis.NcToPlc.AxisId;

(*Actual Velocity*)
fActVelocity:=Axis.NcToPlc.ActVelo;

(*Actual Position*)
IF Axis.Status.OpMode.Modulo THEN
	fActPosition:=Axis.NcToPlc.ModuloActPos;
ELSE
	fActPosition:=Axis.NcToPlc.ActPos;
END_IF

(*Actual Position*)
fActDiff:=Axis.NcToPlc.PosDiff;


//Status struct for EPICS communication
stAxisStatus.bEnable:=bEnable;
stAxisStatus.bEnabled:=bEnabled;
stAxisStatus.bError:=bError;
stAxisStatus.bExecute:=bExecute;
stAxisStatus.bHomeSensor:=bHomeSensor;
stAxisStatus.bJogBwd:=bJogBwd;
stAxisStatus.bJogFwd:=bJogFwd;
stAxisStatus.bLimitBwd:=bLimitBwd;
stAxisStatus.bLimitFwd:=bLimitFwd;
stAxisStatus.bReset:=bReset;
stAxisStatus.fAcceleration:=fAcceleration;
stAxisStatus.fActDiff:=fActDiff;
stAxisStatus.fActPosition:=fActPosition;
stAxisStatus.fActVelocity:=fActVelocity;
stAxisStatus.fDeceleration:=fDeceleration;
stAxisStatus.fOverride:=fOverride;
stAxisStatus.fPosition:=fPosition;
stAxisStatus.fVelocity:=fVelocity;
stAxisStatus.nCmdData:=nCmdData;  //Or nCmdDataLocal
stAxisStatus.nCommand:=nCommand;  //Or nCommandLocal
stAxisStatus.nErrorId:=nErrorId;
stAxisStatus.bBusy:=bBusy;
stAxisStatus.bHomed:=bHomed;

IF bFirstScan THEN
	bFirstScan:=FALSE;
END_IF

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-el1252asm-v1-00">
<h2>POU: FB_EL1252ASM_v1_00<a class="headerlink" href="#pou-fb-el1252asm-v1-00" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Hardware/EtherCAT_Terminals/Digital_Inputs/FB_EL1252ASM_v1_00.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_EL1252ASM_v1_00</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Di_1</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Di_2</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Di_1_LatchTimePos</span><span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">Di_2_LatchTimePos</span><span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">Di_1_LatchTimeNeg</span><span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">Di_2_LatchTimeNeg</span><span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="o">///</span><span class="n">Below</span> <span class="n">bits</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">but</span> <span class="k">then</span> <span class="n">they</span> <span class="n">must</span> <span class="n">be</span> <span class="n">enabled</span> <span class="k">in</span> <span class="n">the</span> <span class="n">COE</span> <span class="k">of</span> <span class="n">the</span> <span class="n">card</span><span class="p">.</span> <span class="n">Nicklas</span> <span class="n">suggested</span> <span class="k">to</span> <span class="k">not</span> <span class="k">use</span> <span class="nn">these</span> <span class="p">(</span><span class="n">since</span> <span class="n">something</span> <span class="n">wss</span> <span class="n">written</span> <span class="n">that</span> <span class="n">you</span> <span class="k">then</span> <span class="n">only</span> <span class="n">were</span> <span class="n">allowed</span> <span class="k">to</span> <span class="n">read</span> <span class="n">the</span> <span class="n">latch</span> <span class="kt">time</span> <span class="n">onece</span> <span class="p">(</span><span class="n">some</span> <span class="n">kkind</span> <span class="k">of</span> <span class="n">auto</span> <span class="n">reset</span><span class="o">??</span><span class="p">))</span>	
	<span class="o">///</span><span class="n">Di_1_LatchNeg</span><span class="o">:</span><span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span>	<span class="n">Di_1_LatchPos</span><span class="o">:</span><span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span>	<span class="n">Di_2_LatchNeg</span><span class="o">:</span><span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span>	<span class="n">Di_2_LatchPos</span><span class="o">:</span><span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Error</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">Channel_1_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">Channel_2_Input</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="n">Latch_Status1</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">USINT</span><span class="p">;</span>
	<span class="o">///</span>	<span class="n">Latch_Status2</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">USINT</span><span class="p">;</span>
	<span class="n">Latch_LatchPos1</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">Latch_LatchNeg1</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">Latch_LatchPos2</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">Latch_LatchNeg2</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">ULINT</span><span class="p">;</span>
	<span class="n">WcState_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*:</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">AND</span> <span class="p">(</span><span class="n">WcState_WcState</span> <span class="k">OR</span> <span class="n">InfoData_State</span><span class="o">&lt;&gt;</span><span class="mi">16#8</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">//</span><span class="n">InfoData_State</span><span class="o">==</span><span class="mi">0</span> <span class="o">=&gt;</span> <span class="k">in</span> <span class="n">OP</span> <span class="n">mode</span>
	<span class="n">Error</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="k">ELSE</span>
	<span class="n">Error</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="k">IF</span> <span class="n">En</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">Error</span><span class="o">=</span><span class="n">FALSE</span> <span class="k">THEN</span>
		<span class="n">Di_1</span><span class="o">:=</span><span class="n">Channel_1_Input</span><span class="p">;</span>
		<span class="n">Di_2</span><span class="o">:=</span><span class="n">Channel_2_Input</span><span class="p">;</span>
	<span class="p">(</span><span class="o">*</span>	<span class="n">Di_1_LatchPos</span><span class="o">:=</span><span class="n">Latch_Status1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
		<span class="n">Di_1_LatchNeg</span><span class="o">:=</span><span class="n">Latch_Status1</span><span class="p">.</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">Di_2_LatchPos</span><span class="o">:=</span><span class="n">Latch_Status2</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
		<span class="n">Di_2_LatchNeg</span><span class="o">:=</span><span class="n">Latch_Status2</span><span class="p">.</span><span class="mi">1</span><span class="p">;</span><span class="o">*</span><span class="p">)</span>
		<span class="n">Di_1_LatchTimePos</span><span class="o">:=</span><span class="n">Latch_LatchPos1</span><span class="p">;</span>
		<span class="n">Di_2_LatchTimePos</span><span class="o">:=</span><span class="n">Latch_LatchPos2</span><span class="p">;</span>		
		<span class="n">Di_1_LatchTimeNeg</span><span class="o">:=</span><span class="n">Latch_LatchNeg1</span><span class="p">;</span>		
		<span class="n">Di_2_LatchTimeNeg</span><span class="o">:=</span><span class="n">Latch_LatchNeg2</span><span class="p">;</span>
		
	<span class="k">ELSE</span>
		<span class="n">Di_1</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">Di_2</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-epicsinout">
<h2>POU: FB_EpicsInOut<a class="headerlink" href="#pou-fb-epicsinout" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/States/FB_EpicsInOut.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>FUNCTION_BLOCK FB_EpicsInOut
// Example usage of FB_PositionStateManager for a simple IN/OUT axis. See NOTE: comments.
// Also usable as a drop-in for these cases (no need to roll your own in/out)
VAR_IN_OUT
    // Motor to apply states to
    stMotionStage: DUT_MotionStage;
    // Information about the OUT position
    stOut: DUT_PositionState; // NOTE: Do not pragma these, let it happen in the manager.
    // Information about the IN parameter
    stIn: DUT_PositionState;
END_VAR
VAR_INPUT
    // If TRUE, the motor will be moved when enumSet is changed
    bEnable: BOOL;
    // When changed, sets the destination and starts a move
    {attribute &#39;pytmc&#39; := &#39;
        pv: SET
        io: io
    &#39;}
    enumSet: ENUM_EpicsInOut; // NOTE: Please copy this pragma exactly on your enumSet
END_VAR
VAR_OUTPUT
    // If TRUE, we are in an error state
    bError: BOOL; // NOTE: do not pragma these, already has pragma in manager
    // Error code
    nErrorId: UDINT;
    // Message associated with bError = TRUE
    sErrorMessage: STRING;
    // If TRUE, we are currently moving between states
    bBusy: BOOL;
    // If TRUE, we asked for a move between states, it completed successfully, and there is no ongoing move
    bDone: BOOL;
    // The current state readback
    {attribute &#39;pytmc&#39; := &#39;
        pv: GET
        io: i
    &#39;}
    enumGet: ENUM_EpicsInOut; // NOTE: Please copy this pragma exactly on your enumGet
END_VAR
VAR
    bInit: BOOL;
    arrStates: ARRAY[1..15] OF DUT_PositionState;

    {attribute &#39;pytmc&#39; := &#39;
        pv:
        io: io
    &#39;}
    fbStateManager: FB_PositionStateManager; // NOTE: Please copy this pragma exactly to pick up the standard PVs
    fbLockOut: FB_PositionStateLock;
    fbLockIn: FB_PositionStateLock;
END_VAR
// Fist cycle setup
IF NOT bInit THEN
    stOut.sName := &#39;OUT&#39;;
    stIn.sName := &#39;IN&#39;;
    bInit := TRUE;
END_IF

// If either of these have bLocked = TRUE, do not allow user to change them
fbLockOut(stPositionState:=stOut);
fbLockIn(stPositionState:=stIn);

// Stuff first two values of the 15 element array for the manager
arrStates[1] := stOut;
arrStates[2] := stIn;

// Call the function block every cycle
fbStateManager(
    stMotionStage := stMotionStage,
    arrStates := arrStates,
    setState := enumSet,
    bEnable := bEnable,
    bError =&gt; bError,
    nErrorId =&gt; nErrorId,
    sErrorMessage =&gt; sErrorMessage,
    bBusy =&gt; bBusy,
    bDone =&gt; bDone,
    getState =&gt; enumGet); // Cannot do this assignment if enumGet has attribute strict

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-errorlist">
<h2>POU: FB_ErrorList<a class="headerlink" href="#pou-fb-errorlist" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/ErrorHandling/FB_ErrorList.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_ErrorList</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>											<span class="o">//</span><span class="n">Enable</span> <span class="n">input</span>
	<span class="n">bReset</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>										<span class="o">//</span><span class="n">Delete</span> <span class="k">all</span> <span class="n">Error</span> <span class="n">entry</span>
	<span class="n">lErrorID</span> <span class="o">:</span> <span class="n">ULINT</span><span class="p">;</span>									<span class="o">//</span><span class="n">ErrorID</span> <span class="k">to</span> <span class="n">be</span> <span class="n">acknoledged</span>
	<span class="n">bACK</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>										<span class="o">//</span><span class="n">Acknoledge</span> <span class="n">the</span> <span class="n">given</span> <span class="n">error</span> <span class="k">and</span> <span class="n">delete</span> <span class="n">it</span> <span class="n">from</span> <span class="n">the</span> <span class="n">list</span>
<span class="n">END_VAR</span>
	
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>											<span class="o">//</span><span class="n">Enable</span> <span class="n">output</span>
	<span class="n">nNoError</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>										<span class="o">//</span><span class="n">Number</span> <span class="k">of</span> <span class="n">Errors</span>
	<span class="n">nNoOverflow</span> <span class="o">:</span> <span class="n">INT</span><span class="p">;</span>									<span class="o">//</span><span class="n">Number</span> <span class="k">of</span> <span class="n">Overflows</span>
	<span class="n">pErrorSystem</span> <span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>			<span class="o">//</span><span class="n">Pointer</span> <span class="k">to</span> <span class="n">ErrorSystem</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">nFreePos</span> <span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>									<span class="o">//</span><span class="n">Number</span> <span class="k">of</span> <span class="n">free</span> <span class="n">position</span> <span class="k">in</span> <span class="n">the</span> <span class="n">list</span>
	<span class="n">nListCnt1</span> <span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>									<span class="o">//</span><span class="nn">work</span> <span class="k">variable</span>
	<span class="n">ErrorSystem</span> <span class="o">:</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>						<span class="o">//</span><span class="n">Data</span> <span class="n">structure</span> <span class="k">of</span> <span class="n">the</span> <span class="n">Error</span> <span class="n">list</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="o">*</span> <span class="o">================================================================================</span>
<span class="o">*</span>                                   <span class="n">DESCRIPTION</span>
<span class="o">*</span> <span class="o">================================================================================</span>
<span class="o">*</span> <span class="n">This</span> <span class="k">Function</span> <span class="k">Block</span> <span class="n">implements</span> <span class="n">the</span> <span class="n">core</span> <span class="n">structure</span> <span class="k">of</span> <span class="n">the</span> <span class="n">Error</span><span class="o">/</span><span class="n">Warning</span> <span class="n">Handling</span>
<span class="o">*</span> <span class="n">system</span><span class="p">.</span> <span class="n">It</span> <span class="n">realizes</span> <span class="n">the</span> <span class="n">datastructure</span> <span class="n">containing</span> <span class="n">every</span> <span class="n">Error</span> <span class="n">Entry</span><span class="p">,</span> <span class="n">collect</span>
<span class="o">*</span> <span class="n">statistics</span> <span class="n">about</span> <span class="n">the</span> <span class="n">usage</span> <span class="k">and</span> <span class="n">manage</span> <span class="n">the</span> <span class="n">Error</span> <span class="n">Entries</span><span class="p">.</span>
<span class="o">*</span> <span class="n">Note</span><span class="o">:</span> <span class="n">The</span> <span class="n">system</span> <span class="k">is</span> <span class="n">under</span> <span class="n">development</span><span class="p">,</span> <span class="n">most</span> <span class="k">of</span> <span class="n">the</span> <span class="n">functionalities</span> <span class="n">are</span> <span class="k">not</span>
<span class="o">*</span> <span class="n">implemented</span> <span class="k">or</span> <span class="n">existing</span> <span class="n">functionalities</span> <span class="n">may</span> <span class="n">change</span> <span class="k">with</span> <span class="kt">time</span><span class="p">.</span>
<span class="o">*</span> <span class="o">================================================================================</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">EnO</span> <span class="o">:=</span> <span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Ponter</span> <span class="k">to</span> <span class="n">ErrorSystem</span>
<span class="n">pErrorSystem</span> <span class="o">:=</span> <span class="n">ADR</span><span class="p">(</span><span class="n">ErrorSystem</span><span class="p">);</span>

<span class="o">//</span><span class="n">Number</span> <span class="k">of</span> <span class="n">overflows</span>
<span class="n">nNoOverflow</span> <span class="o">:=</span> <span class="n">ErrorSystem</span><span class="p">.</span><span class="n">nNoOverflows</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">bReset</span> <span class="k">THEN</span>
	<span class="n">MEMSET</span> <span class="p">(</span> <span class="n">ADR</span><span class="p">(</span><span class="n">ErrorSystem</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="o">*</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">DUT_TerminalError</span><span class="p">));</span>
	<span class="n">ErrorSystem</span><span class="p">.</span><span class="n">lNextErrorID</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Number</span> <span class="k">of</span> <span class="n">errors</span> <span class="k">in</span> <span class="n">the</span> <span class="n">system</span>
<span class="n">nNoError</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">FOR</span> <span class="n">nListCnt1</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">TO</span> <span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">DO</span>
	<span class="k">IF</span> <span class="n">ErrorSystem</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nListCnt1</span><span class="p">].</span><span class="n">Error_ID</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span>  <span class="k">THEN</span>
		<span class="n">nNoError</span> <span class="o">:=</span> <span class="n">nNoError</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> 
	<span class="n">END_IF</span>
<span class="n">END_FOR</span>
<span class="n">ErrorSystem</span><span class="p">.</span><span class="n">nNoErrors</span> <span class="o">:=</span> <span class="n">nNoError</span><span class="p">;</span>

<span class="o">//</span><span class="n">Number</span> <span class="k">of</span> <span class="n">free</span> <span class="n">position</span> <span class="k">in</span> <span class="n">the</span> <span class="n">list</span>
<span class="n">nFreePos</span> <span class="o">:=</span> <span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="o">-</span> <span class="n">nNoError</span><span class="p">;</span>

<span class="o">//</span><span class="n">Acknoledge</span> <span class="n">specified</span> <span class="n">Error</span> <span class="n">entry</span>
<span class="k">IF</span> <span class="n">bACK</span> <span class="k">THEN</span>
	<span class="k">FOR</span> <span class="n">nListCnt1</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">TO</span> <span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">DO</span>
		<span class="k">IF</span> <span class="n">ErrorSystem</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nListCnt1</span><span class="p">].</span><span class="n">Error_ID</span> <span class="o">=</span> <span class="n">lErrorID</span> <span class="k">THEN</span>
			<span class="n">ErrorSystem</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nListCnt1</span><span class="p">].</span><span class="n">ErrorState</span> <span class="o">:=</span> <span class="n">DUT_ErrorState</span><span class="p">.</span><span class="n">Acknowledged</span><span class="p">;</span>
		<span class="n">END_IF</span>
	<span class="n">END_FOR</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Deleting</span> <span class="n">acknoledged</span> <span class="n">errors</span>
<span class="k">FOR</span> <span class="n">nListCnt1</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">TO</span> <span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">DO</span>
	<span class="k">IF</span> <span class="n">ErrorSystem</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nListCnt1</span><span class="p">].</span><span class="n">ErrorState</span> <span class="o">=</span> <span class="n">DUT_ErrorState</span><span class="p">.</span><span class="n">Acknowledged</span> <span class="k">THEN</span>
		<span class="n">MEMMOVE</span> <span class="p">(</span><span class="n">ADR</span><span class="p">(</span><span class="n">ErrorSystem</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nListCnt1</span><span class="p">]),</span> <span class="n">ADR</span><span class="p">(</span><span class="n">ErrorSystem</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nListCnt1</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">nListCnt1</span><span class="p">)</span> <span class="o">*</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">DUT_TerminalError</span><span class="p">));</span>
		<span class="n">MEMSET</span><span class="p">(</span><span class="n">ADR</span><span class="p">(</span><span class="n">ErrorSystem</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">DUT_TerminalError</span><span class="p">));</span>
	<span class="n">END_IF</span>
<span class="n">END_FOR</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-gantryautocoupling">
<h2>POU: FB_GantryAutoCoupling<a class="headerlink" href="#pou-fb-gantryautocoupling" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/Gantry/FB_GantryAutoCoupling.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_GantryAutoCoupling</span>
<span class="n">VAR_INPUT</span>
    <span class="n">nGantryTol</span> <span class="o">:</span> <span class="n">LINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">bGantryAlreadyCoupled</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Master</span> <span class="o">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">MasterEnc</span> <span class="o">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span>
    <span class="n">Slave</span> <span class="o">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">SlaveEnc</span> <span class="o">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span>
    <span class="n">bExecuteCouple</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecuteDecouple</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">gantry_diff_limit</span> <span class="o">:</span> <span class="n">FB_GantryDiffVirtualLimitSwitch</span><span class="p">;</span>
    <span class="n">couple</span> <span class="o">:</span> <span class="n">MC_GEARIN</span><span class="p">;</span>
    <span class="n">decouple</span> <span class="o">:</span> <span class="n">MC_GEAROUT</span><span class="p">;</span>
    <span class="n">bInitComplete</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fbSetEnables</span> <span class="o">:</span> <span class="n">FB_SetEnables</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Designate</span> <span class="n">Master</span> <span class="k">and</span> <span class="n">SLave</span> <span class="n">Axes</span>
<span class="n">Master</span><span class="p">.</span><span class="n">bGantryAxis</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">Slave</span><span class="p">.</span><span class="n">bGantryAxis</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

<span class="n">Master</span><span class="p">.</span><span class="n">nGantryTol</span> <span class="o">:=</span> <span class="n">nGantryTol</span><span class="p">;</span>
<span class="n">Slave</span><span class="p">.</span><span class="n">nGantryTol</span> <span class="o">:=</span> <span class="n">Master</span><span class="p">.</span><span class="n">nGantryTol</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Activate</span> <span class="n">Gantry</span> <span class="n">Virtual</span> <span class="n">Limit</span> <span class="n">Switch</span>
<span class="n">gantry_diff_limit</span><span class="p">(</span><span class="n">Penc</span><span class="o">:=</span><span class="n">MasterEnc</span><span class="p">,</span> <span class="n">SEnc</span><span class="o">:=</span><span class="n">SlaveEnc</span><span class="p">,</span> <span class="n">GantDiffTol</span><span class="o">:=</span><span class="n">Master</span><span class="p">.</span><span class="n">nGantryTol</span><span class="p">,</span>
                  <span class="n">PLimFwd</span><span class="o">=&gt;</span><span class="n">Master</span><span class="p">.</span><span class="n">bGantryForwardEnable</span><span class="p">,</span> <span class="n">PLimBwd</span><span class="o">=&gt;</span><span class="n">Master</span><span class="p">.</span><span class="n">bGantryBackwardEnable</span><span class="p">,</span>
                  <span class="n">SLimFwd</span><span class="o">=&gt;</span><span class="n">Slave</span><span class="p">.</span><span class="n">bGantryForwardEnable</span><span class="p">,</span> <span class="n">SLimBwd</span><span class="o">=&gt;</span><span class="n">Slave</span><span class="p">.</span><span class="n">bGantryBackwardEnable</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Coupling</span> <span class="n">Status</span> <span class="kt">Bit</span>
<span class="n">bGantryAlreadyCoupled</span> <span class="o">:=</span> <span class="n">Master</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">NcToPlc</span><span class="p">.</span><span class="n">CoupleState</span><span class="o">=</span><span class="mi">1</span> <span class="k">AND</span> <span class="n">Slave</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">NcToPlc</span><span class="p">.</span><span class="n">CoupleState</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>

<span class="n">fbSetEnables</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Master</span><span class="p">);</span>
<span class="n">fbSetEnables</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Slave</span><span class="p">);</span>

<span class="k">IF</span> <span class="n">bGantryAlreadyCoupled</span> <span class="k">THEN</span>
    <span class="n">Master</span><span class="p">.</span><span class="n">bGantryForwardEnable</span> <span class="o">:=</span> <span class="n">Master</span><span class="p">.</span><span class="n">bGantryForwardEnable</span> <span class="k">AND</span> <span class="n">Slave</span><span class="p">.</span><span class="n">bAllForwardEnable</span><span class="p">;</span>
    <span class="n">Slave</span><span class="p">.</span><span class="n">bGantryForwardEnable</span> <span class="o">:=</span> <span class="n">Master</span><span class="p">.</span><span class="n">bAllForwardEnable</span> <span class="k">AND</span> <span class="n">Slave</span><span class="p">.</span><span class="n">bGantryForwardEnable</span><span class="p">;</span>

    <span class="n">Master</span><span class="p">.</span><span class="n">bGantryBackwardEnable</span> <span class="o">:=</span> <span class="n">Master</span><span class="p">.</span><span class="n">bGantryBackwardEnable</span> <span class="k">AND</span> <span class="n">Slave</span><span class="p">.</span><span class="n">bAllBackwardEnable</span><span class="p">;</span>
    <span class="n">Slave</span><span class="p">.</span><span class="n">bGantryBackwardEnable</span> <span class="o">:=</span> <span class="n">Master</span><span class="p">.</span><span class="n">bAllBackwardEnable</span> <span class="k">AND</span> <span class="n">Slave</span><span class="p">.</span><span class="n">bGantryBackwardEnable</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span> <span class="n">Coupling</span> <span class="n">states</span>
<span class="o">//</span> <span class="n">Auto</span><span class="o">-</span><span class="n">coupling</span> <span class="n">at</span> <span class="n">init</span> <span class="k">and</span> <span class="n">auto</span><span class="o">-</span><span class="n">reset</span> <span class="k">of</span> <span class="n">coupling</span> <span class="kt">boolean</span>
<span class="n">bExecuteCouple</span> <span class="n">S</span><span class="o">=</span> <span class="k">NOT</span> <span class="n">bInitComplete</span><span class="p">;</span>

<span class="n">bExecuteCouple</span> <span class="n">R</span><span class="o">=</span> <span class="n">couple</span><span class="p">.</span><span class="n">Busy</span> <span class="k">OR</span> <span class="n">bGantryAlreadyCoupled</span><span class="p">;</span>
<span class="n">couple</span><span class="p">(</span><span class="n">Master</span><span class="o">:=</span><span class="n">Master</span><span class="p">.</span><span class="n">Axis</span><span class="p">,</span> <span class="n">Slave</span><span class="o">:=</span><span class="n">Slave</span><span class="p">.</span><span class="n">Axis</span><span class="p">,</span> <span class="n">Execute</span><span class="o">:=</span><span class="n">bExecuteCouple</span><span class="p">);</span>

<span class="n">bInitComplete</span> <span class="n">S</span><span class="o">=</span> <span class="n">bGantryAlreadyCoupled</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Decoupling</span> <span class="k">with</span> <span class="n">auto</span><span class="o">-</span><span class="n">reset</span> <span class="k">of</span> <span class="n">coupling</span> <span class="kt">boolean</span>
<span class="n">bExecuteDecouple</span> <span class="n">R</span><span class="o">=</span> <span class="n">decouple</span><span class="p">.</span><span class="n">Busy</span> <span class="k">OR</span> <span class="k">NOT</span> <span class="n">bGantryAlreadyCoupled</span><span class="p">;</span>
<span class="n">decouple</span><span class="p">(</span><span class="n">Slave</span><span class="o">:=</span><span class="n">Slave</span><span class="p">.</span><span class="n">Axis</span><span class="p">,</span> <span class="n">Execute</span><span class="o">:=</span><span class="n">bExecuteDecouple</span><span class="p">);</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-gantrydiffvirtuallimitswitch">
<h2>POU: FB_GantryDiffVirtualLimitSwitch<a class="headerlink" href="#pou-fb-gantrydiffvirtuallimitswitch" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/Gantry/FB_GantryDiffVirtualLimitSwitch.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_GantryDiffVirtualLimitSwitch</span>
<span class="n">VAR_INPUT</span>
    <span class="n">PEnc</span><span class="o">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span> <span class="o">//</span> <span class="n">Primary</span> <span class="n">axis</span> <span class="n">encoder</span> <span class="p">(</span><span class="n">usually</span> <span class="n">the</span> <span class="n">upstream</span> <span class="n">one</span><span class="p">)</span>
    <span class="n">SEnc</span><span class="o">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span> <span class="o">//</span> <span class="n">Secondary</span> <span class="n">axis</span> <span class="n">encoder</span> <span class="p">(</span><span class="n">couples</span> <span class="k">to</span> <span class="n">the</span> <span class="n">primary</span><span class="p">)</span>

    <span class="n">GantDiffTol</span><span class="o">:</span> <span class="n">LINT</span><span class="p">;</span>        <span class="o">//</span> <span class="n">Gantry</span> <span class="n">differenace</span> <span class="n">tolerance</span> <span class="k">in</span> <span class="n">encoder</span> <span class="n">counts</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">PLimFwd</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Primary</span> <span class="n">axis</span> <span class="n">forward</span> <span class="n">direction</span> <span class="n">enable</span>
    <span class="n">PLimBwd</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Primary</span> <span class="n">axis</span> <span class="n">reverse</span> <span class="n">direction</span> <span class="n">enable</span>
    <span class="n">SLimFwd</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Secondary</span> <span class="n">axis</span> <span class="n">forward</span> <span class="n">direction</span> <span class="n">enable</span>
    <span class="n">SLimBwd</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Secondary</span> <span class="n">axis</span> <span class="n">reverse</span> <span class="n">direction</span> <span class="n">enable</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">GantryDiff</span><span class="o">:</span> <span class="n">LINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span> <span class="n">Gantry</span> <span class="n">Difference</span> <span class="n">Virtual</span> <span class="n">Limit</span> <span class="n">Switch</span>
<span class="n">A</span><span class="p">.</span> <span class="n">Wallace</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">15</span>

<span class="n">Determines</span> <span class="n">which</span> <span class="n">direction</span> <span class="k">is</span> <span class="n">disabled</span> <span class="n">due</span> <span class="k">to</span> <span class="n">it</span> <span class="n">increasing</span> <span class="n">the</span> <span class="n">gantry</span> <span class="n">difference</span><span class="p">.</span>
<span class="n">Refer</span> <span class="k">to</span> <span class="n">the</span> <span class="n">ESD</span> <span class="k">for</span> <span class="n">actual</span> <span class="n">conventions</span><span class="p">.</span>

<span class="n">A</span> <span class="kt">positive</span> <span class="n">gantry</span> <span class="n">error</span> <span class="n">refers</span> <span class="k">to</span> <span class="n">a</span> <span class="n">CCW</span> <span class="n">clocked</span> <span class="n">assembly</span><span class="o">:</span>
<span class="n">eg</span><span class="p">.</span> <span class="k">for</span> <span class="n">X</span>
<span class="n">X1</span> <span class="n">upstream</span><span class="p">,</span> <span class="n">X2</span> <span class="n">downstream</span><span class="p">.</span> <span class="n">Primary</span> <span class="n">axis</span> <span class="k">is</span> <span class="n">always</span> <span class="n">upstream</span><span class="p">.</span>
<span class="n">Gantry</span> <span class="n">difference</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">when</span>
<span class="n">X2</span><span class="o">&gt;</span><span class="n">X1</span>
<span class="n">Therefore</span>
<span class="n">X2</span> <span class="kt">positive</span> <span class="n">direction</span> <span class="n">disabled</span>
<span class="n">X1</span> <span class="n">negative</span> <span class="n">direction</span> <span class="n">disabled</span>

<span class="n">Call</span> <span class="n">before</span> <span class="n">FB_MotionStage</span> <span class="n">fb</span> <span class="n">calls</span> <span class="k">for</span> <span class="n">the</span> <span class="n">gantry</span> <span class="n">axes</span><span class="p">.</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">GantryDiff</span> <span class="o">:=</span> <span class="p">(</span> <span class="n">ULINT_TO_LINT</span><span class="p">(</span><span class="n">PEnc</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span> <span class="o">-</span> <span class="n">ULINT_TO_LINT</span><span class="p">(</span><span class="n">PEnc</span><span class="p">.</span><span class="n">Ref</span><span class="p">)</span> <span class="p">)</span> <span class="o">-</span> <span class="p">(</span> <span class="n">ULINT_TO_LINT</span><span class="p">(</span><span class="n">SEnc</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span> <span class="o">-</span> <span class="n">ULINT_TO_LINT</span><span class="p">(</span><span class="n">SEnc</span><span class="p">.</span><span class="n">Ref</span><span class="p">)</span> <span class="p">);</span>

<span class="k">IF</span> <span class="k">ABS</span><span class="p">(</span><span class="n">GantryDiff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">GantDiffTol</span> <span class="k">THEN</span>
    <span class="k">IF</span> <span class="n">GantryDiff</span> <span class="o">&lt;</span> <span class="mi">0</span>  <span class="k">THEN</span>
        <span class="n">PLimBwd</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">SLimFwd</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">ELSE</span>
        <span class="n">PLimBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">SLimFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="k">IF</span> <span class="n">GantryDiff</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">THEN</span>
        <span class="n">PLimFwd</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">SLimBwd</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">ELSE</span>
        <span class="n">PLimFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">SLimBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="k">ELSE</span>
    <span class="o">//</span><span class="k">If</span> <span class="n">there</span> <span class="k">is</span> <span class="n">no</span> <span class="n">fault</span><span class="p">,</span> <span class="k">all</span> <span class="n">directions</span> <span class="n">are</span> <span class="n">enabled</span>
    <span class="n">PLimFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">PLimBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">SLimFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">SLimBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-homedirect">
<h2>POU: FB_HomeDirect<a class="headerlink" href="#pou-fb-homedirect" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/Homing/FB_HomeDirect.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeDirect</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bReset</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">fHomePosition</span><span class="o">:</span><span class="n">LREAL</span><span class="p">;</span>	
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
	<span class="n">Axis</span><span class="o">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">bBusy</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bHomed</span><span class="o">:</span><span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">fbHome</span><span class="o">:</span> <span class="n">MC_Home</span><span class="p">;</span>	
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">bReset</span> <span class="k">THEN</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span> 

<span class="n">fbHome</span><span class="p">(</span>
	<span class="n">Execute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
	<span class="n">Position</span><span class="o">:=</span><span class="n">fHomePosition</span><span class="p">,</span>
	<span class="n">HomingMode</span><span class="o">:=</span><span class="n">MC_Direct</span><span class="p">,</span>
	<span class="n">bCalibrationCam</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
	<span class="p">);</span>
	
<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbHome</span><span class="p">.</span><span class="n">Busy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbHome</span><span class="p">.</span><span class="n">Done</span><span class="p">;</span>
<span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">Homed</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbHome</span><span class="p">.</span><span class="n">Error</span><span class="p">;</span> 

<span class="k">IF</span> <span class="n">fbHome</span><span class="p">.</span><span class="n">Error</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHome</span><span class="p">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-homefinish">
<h2>POU: FB_HomeFinish<a class="headerlink" href="#pou-fb-homefinish" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/Homing/FB_HomeFinish.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeFinish</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bReset</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
    <span class="n">nCmdData</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">bSofLimEnableLow</span><span class="o">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
	<span class="n">bSofLimEnableHigh</span><span class="o">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>			
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
	<span class="n">Axis</span><span class="o">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">bBusy</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>		
	<span class="n">fbHomewriteSoftLimEnable</span><span class="o">:</span><span class="n">FB_HomeWriteSoftLimEnable</span><span class="p">;</span>	
	<span class="n">fbExecuteRiseEdge</span><span class="o">:</span> <span class="n">R_TRIG</span><span class="p">;</span>	
	<span class="n">bExecuteWriteNC</span><span class="o">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">nState</span><span class="o">:</span><span class="n">INT</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">bReset</span> <span class="k">THEN</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span> 

<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bExecute</span> <span class="k">THEN</span>
  <span class="n">bExecuteWriteNC</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">fbHomewriteSoftLimEnable</span><span class="p">.</span><span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">bSofLimEnableLow</span><span class="p">;</span>
  <span class="n">fbHomewriteSoftLimEnable</span><span class="p">.</span><span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">bSofLimEnableHigh</span><span class="p">;</span>   
  <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbExecuteRiseEdge</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>
<span class="k">IF</span> <span class="n">fbExecuteRiseEdge</span><span class="p">.</span><span class="n">Q</span> <span class="k">THEN</span>
  <span class="n">bExecuteWriteNC</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>  
  <span class="n">fbHomewriteSoftLimEnable</span><span class="p">.</span><span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">bSofLimEnableLow</span><span class="p">;</span>
  <span class="n">fbHomewriteSoftLimEnable</span><span class="p">.</span><span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">bSofLimEnableHigh</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Write</span> <span class="k">to</span> <span class="n">NC</span> <span class="p">(</span><span class="n">disable</span> <span class="n">soft</span> <span class="n">limits</span><span class="p">)</span>
<span class="n">fbHomewriteSoftLimEnable</span><span class="p">(</span>
	<span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteWriteNC</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
	<span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>	
<span class="p">);</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbHomewriteSoftLimEnable</span><span class="p">.</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbHomewriteSoftLimEnable</span><span class="p">.</span><span class="n">bDone</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbHomewriteSoftLimEnable</span><span class="p">.</span><span class="n">bError</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">fbHomewriteSoftLimEnable</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomewriteSoftLimEnable</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-homeprepare">
<h2>POU: FB_HomePrepare<a class="headerlink" href="#pou-fb-homeprepare" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/Homing/FB_HomePrepare.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomePrepare</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bReset</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
    <span class="n">nCmdData</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>		
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
	<span class="n">Axis</span><span class="o">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">bBusy</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">bSofLimEnableLowOriginal</span><span class="o">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
	<span class="n">bSofLimEnableHighOriginal</span><span class="o">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>	
	<span class="n">fVelocityToCam</span><span class="o">:</span> <span class="n">LREAL</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">fVelocityFromCam</span><span class="o">:</span> <span class="n">LREAL</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>		
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">fbHomeReadSoftLimEnable</span><span class="o">:</span><span class="n">FB_HomeReadSoftLimEnable</span><span class="p">;</span>	
	<span class="n">fbHomeDisableSoftLimEnable</span><span class="o">:</span><span class="n">FB_HomeWriteSoftLimEnable</span><span class="p">;</span>
	<span class="n">fbHomeReadNCVelocities</span><span class="o">:</span> <span class="n">FB_HomeReadNcVelocities</span><span class="p">;</span>
	<span class="n">fbHomeResetCalibrationFlag</span><span class="o">:</span><span class="n">MC_Home</span><span class="p">;</span>   <span class="o">//</span><span class="n">Only</span> <span class="n">used</span> <span class="k">for</span> <span class="n">reset</span> <span class="k">of</span> <span class="n">calibration</span> <span class="n">flag</span>
	<span class="n">fbExecuteRiseEdge</span><span class="o">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
	<span class="n">bExecuteReadNC</span><span class="o">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">bExecuteWriteNC</span><span class="o">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">nState</span><span class="o">:</span><span class="n">INT</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">bReset</span> <span class="k">THEN</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span> 

<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bExecute</span> <span class="k">THEN</span>
  <span class="n">bExecuteReadNC</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">bExecuteWriteNC</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>   
  <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbExecuteRiseEdge</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>
<span class="k">IF</span> <span class="n">fbExecuteRiseEdge</span><span class="p">.</span><span class="n">Q</span> <span class="k">THEN</span>
  <span class="n">bExecuteReadNC</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>  
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Read</span> <span class="n">from</span> <span class="n">NC</span>
<span class="n">fbHomeReadNCVelocities</span><span class="p">(</span>
  <span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
  <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteReadNC</span><span class="p">,</span> <span class="o">//</span> <span class="n">Actualy</span> <span class="k">not</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">sequence</span> <span class="mi">15</span> <span class="p">(</span><span class="n">set</span> <span class="n">position</span> <span class="n">only</span><span class="p">,</span> <span class="n">no</span> <span class="n">movement</span><span class="p">))</span>
  <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
  <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
<span class="p">);</span>

<span class="n">fbHomeReadSoftLimEnable</span><span class="p">(</span>
	<span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteReadNC</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
	<span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>	
<span class="p">);</span>

<span class="o">//</span> <span class="n">Reset</span> <span class="n">calibration</span> <span class="n">flag</span>
<span class="n">fbHomeResetCalibrationFlag</span><span class="p">(</span>
  <span class="n">Execute</span><span class="o">:=</span><span class="n">bExecuteReadNC</span><span class="p">,</span>
  <span class="n">HomingMode</span><span class="o">:=</span><span class="n">MC_ResetCalibration</span><span class="p">,</span>
  <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
<span class="p">);</span>

<span class="n">bSofLimEnableLowOriginal</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="p">.</span><span class="n">bSofLimEnableLow</span><span class="p">;</span>
<span class="n">bSofLimEnableHighOriginal</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="p">.</span><span class="n">bSofLimEnableHigh</span><span class="p">;</span>	

<span class="n">fVelocityToCam</span><span class="o">:=</span><span class="n">fbHomeReadNCVelocities</span><span class="p">.</span><span class="n">fVelocityToCam</span><span class="p">;</span>
<span class="n">fVelocityFromCam</span><span class="o">:=</span><span class="n">fbHomeReadNCVelocities</span><span class="p">.</span><span class="n">fVelocityFromCam</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">bExecuteReadNC</span> <span class="k">AND</span> <span class="n">bExecute</span> <span class="k">AND</span> <span class="n">fbHomeReadSoftLimEnable</span><span class="p">.</span><span class="n">bDone</span> <span class="k">THEN</span>
	<span class="n">fbHomeDisableSoftLimEnable</span><span class="p">.</span><span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">fbHomeDisableSoftLimEnable</span><span class="p">.</span><span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">bExecuteWriteNC</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span><span class="n">Always</span> <span class="n">write</span> <span class="p">(</span><span class="n">only</span> <span class="n">needed</span> <span class="k">if</span> <span class="n">enabled</span> <span class="n">actually</span><span class="p">)</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Write</span> <span class="k">to</span> <span class="n">NC</span> <span class="p">(</span><span class="n">disable</span> <span class="n">soft</span> <span class="n">limits</span><span class="p">)</span>
<span class="n">fbHomeDisableSoftLimEnable</span><span class="p">(</span>
	<span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteWriteNC</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
	<span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>	
<span class="p">);</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="p">.</span><span class="n">bBusy</span> <span class="k">OR</span> <span class="n">fbHomeDisableSoftLimEnable</span><span class="p">.</span><span class="n">bBusy</span> <span class="k">OR</span> <span class="n">fbHomeReadNCVelocities</span><span class="p">.</span><span class="n">bBusy</span> <span class="k">OR</span> <span class="n">fbHomeResetCalibrationFlag</span><span class="p">.</span><span class="n">Busy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">fbHomeDisableSoftLimEnable</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">fbHomeReadNCVelocities</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">fbHomeResetCalibrationFlag</span><span class="p">.</span><span class="n">Done</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="p">.</span><span class="n">bError</span> <span class="k">OR</span> <span class="n">fbHomeDisableSoftLimEnable</span><span class="p">.</span><span class="n">bError</span> <span class="k">OR</span> <span class="n">fbHomeReadNCVelocities</span><span class="p">.</span><span class="n">bError</span> <span class="k">OR</span> <span class="n">fbHomeResetCalibrationFlag</span><span class="p">.</span><span class="n">Error</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">fbHomeReadSoftLimEnable</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="k">ELSIF</span> <span class="n">fbHomeDisableSoftLimEnable</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomeDisableSoftLimEnable</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="k">ELSIF</span> <span class="n">fbHomeResetCalibrationFlag</span><span class="p">.</span><span class="n">Error</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomeResetCalibrationFlag</span><span class="p">.</span><span class="n">ErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-homereadncvelocities">
<h2>POU: FB_HomeReadNcVelocities<a class="headerlink" href="#pou-fb-homereadncvelocities" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/Homing/FB_HomeReadNcVelocities.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeReadNcVelocities</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bReset</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>			
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
	<span class="n">Axis</span><span class="o">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">bBusy</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>	
	<span class="n">fVelocityToCam</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">fVelocityFromCam</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">fbReadVelocityToCam</span><span class="o">:</span><span class="n">FB_ReadFloatParameter</span><span class="p">;</span>
	<span class="n">fbReadVelocityFromCam</span><span class="o">:</span><span class="n">FB_ReadFloatParameter</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">bReset</span> <span class="k">THEN</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span> 
	
<span class="n">fbReadVelocityToCam</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16#4000</span><span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16#6</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>
	
<span class="n">fbReadVelocityFromCam</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16#4000</span><span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16#7</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>
	
<span class="n">fVelocityToCam</span><span class="o">:=</span><span class="n">fbReadVelocityToCam</span><span class="p">.</span><span class="n">nData</span><span class="p">;</span>
<span class="n">fVelocityFromCam</span><span class="o">:=</span><span class="n">fbReadVelocityFromCam</span><span class="p">.</span><span class="n">nData</span><span class="p">;</span>	

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbReadVelocityFromCam</span><span class="p">.</span><span class="n">bBusy</span> <span class="k">OR</span> <span class="n">fbReadVelocityToCam</span><span class="p">.</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbReadVelocityFromCam</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">fbReadVelocityToCam</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbReadVelocityToCam</span><span class="p">.</span><span class="n">bError</span> <span class="k">OR</span> <span class="n">fbReadVelocityFromCam</span><span class="p">.</span><span class="n">bError</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">fbReadVelocityToCam</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbReadVelocityToCam</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="k">ELSIF</span> <span class="n">fbReadVelocityFromCam</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbReadVelocityFromCam</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-homereadsoftlimenable">
<h2>POU: FB_HomeReadSoftLimEnable<a class="headerlink" href="#pou-fb-homereadsoftlimenable" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/Homing/FB_HomeReadSoftLimEnable.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeReadSoftLimEnable</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bReset</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>			
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
	<span class="n">Axis</span><span class="o">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">bBusy</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>	
	<span class="n">bSofLimEnableLow</span><span class="o">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
	<span class="n">bSofLimEnableHigh</span><span class="o">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">fbReadSoftLimEnableLow</span><span class="o">:</span><span class="n">FB_ReadParameterInNc_v1_00</span><span class="p">;</span>
	<span class="n">fbReadSoftLimEnableHigh</span><span class="o">:</span><span class="n">FB_ReadParameterInNc_v1_00</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">bReset</span> <span class="k">THEN</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span> 
	
<span class="n">fbReadSoftLimEnableLow</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16#5000</span><span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16#B</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">fbReadSoftLimEnableHigh</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16#5000</span><span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16#C</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>
	
<span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">DWORD_TO_BOOL</span><span class="p">(</span><span class="n">fbReadSoftLimEnableLow</span><span class="p">.</span><span class="n">nData</span><span class="p">);</span>
<span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">DWORD_TO_BOOL</span><span class="p">(</span><span class="n">fbReadSoftLimEnableHigh</span><span class="p">.</span><span class="n">nData</span><span class="p">);</span>	

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbReadSoftLimEnableLow</span><span class="p">.</span><span class="n">bBusy</span> <span class="k">OR</span> <span class="n">fbReadSoftLimEnableHigh</span><span class="p">.</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbReadSoftLimEnableLow</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">fbReadSoftLimEnableHigh</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbReadSoftLimEnableLow</span><span class="p">.</span><span class="n">bError</span> <span class="k">OR</span> <span class="n">fbReadSoftLimEnableHigh</span><span class="p">.</span><span class="n">bError</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">fbReadSoftLimEnableLow</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbReadSoftLimEnableLow</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="k">ELSIF</span> <span class="n">fbReadSoftLimEnableHigh</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbReadSoftLimEnableHigh</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-hometoswitch">
<h2>POU: FB_HomeToSwitch<a class="headerlink" href="#pou-fb-hometoswitch" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/Homing/FB_HomeToSwitch.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeToSwitch</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bReset</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
    <span class="n">bCamSensor</span><span class="o">:</span><span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">nSearchDirTwoardsCam</span><span class="o">:</span> <span class="n">MC_Direction</span><span class="p">;</span>
	<span class="n">nSearchDirOffCam</span><span class="o">:</span> <span class="n">MC_Direction</span><span class="p">;</span>
	<span class="n">fHomePosition</span><span class="o">:</span><span class="n">LREAL</span><span class="p">;</span>	
	<span class="n">fVelocityToCamNC</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span><span class="n">Velcoity</span> <span class="k">when</span> <span class="n">searching</span> <span class="k">for</span> <span class="n">cam</span>
	<span class="n">fVelocityFromCamNC</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Velocity</span> <span class="k">after</span> <span class="n">found</span> <span class="n">cam</span> <span class="p">(</span><span class="n">searching</span> <span class="k">for</span> <span class="k">next</span> <span class="k">signal</span> <span class="n">transition</span><span class="p">)</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
	<span class="n">Axis</span><span class="o">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">bBusy</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bHomed</span><span class="o">:</span><span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">fbHome</span><span class="o">:</span> <span class="n">MC_Home</span><span class="p">;</span>	
	<span class="n">fbWriteHomeDirCamToNC</span><span class="o">:</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="p">;</span>
	<span class="n">fbWriteHomeDirSyncToNC</span><span class="o">:</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="p">;</span>
	<span class="n">fbWriteHomeModeToNC</span><span class="o">:</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="p">;</span>
	<span class="n">fbWriteHomeVelocitiesToNC</span><span class="o">:</span> <span class="n">FB_HomeWriteNcVelocities</span><span class="p">;</span>
	<span class="n">bConfigNCDone</span><span class="o">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">fbRTrigg</span><span class="o">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">bReset</span> <span class="k">THEN</span>
	<span class="n">bConfigNCDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span> 
	
<span class="o">//</span><span class="n">Start</span> <span class="n">preparation</span> <span class="k">of</span> <span class="n">NC</span> <span class="k">if</span> <span class="n">rising</span> <span class="n">edge</span> <span class="k">on</span> <span class="n">bExecute</span>
<span class="n">fbRTrigg</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>
<span class="k">IF</span> <span class="n">fbRTrigg</span><span class="p">.</span><span class="n">Q</span> <span class="k">THEN</span>
	<span class="n">bConfigNCDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

 
<span class="n">fbWriteHomeDirCamToNC</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">bConfigNCDone</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span><span class="mi">16#5000</span><span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span><span class="mi">16#101</span><span class="p">,</span>	<span class="o">//</span><span class="n">Direction</span> <span class="k">for</span> <span class="n">Calibration</span> <span class="n">Cam</span> <span class="n">Search</span>	
	<span class="n">nData</span><span class="o">:=</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="n">nSearchDirTwoardsCam</span><span class="o">=</span><span class="n">MC_Negative_Direction</span><span class="p">),</span><span class="o">//</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="k">NOT</span> <span class="n">bSearchDirTwoardsCam</span><span class="p">),</span>
	<span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
<span class="p">);</span>

<span class="n">fbWriteHomeDirSyncToNC</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span> <span class="n">bExecute</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">bConfigNCDone</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span><span class="mi">16#5000</span> <span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span><span class="mi">16#102</span> <span class="p">,</span> <span class="o">//</span><span class="n">Direction</span> <span class="k">for</span> <span class="n">Sync</span> <span class="n">Impuls</span> <span class="n">Search</span>
	<span class="n">nData</span><span class="o">:=</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="n">nSearchDirOffCam</span><span class="o">=</span><span class="n">MC_Negative_Direction</span><span class="p">),</span><span class="o">//</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="k">NOT</span> <span class="n">bSearchDirOffCam</span><span class="p">),</span>
	<span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span> 
<span class="p">);</span>

<span class="n">fbWriteHomeModeToNC</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">bConfigNCDone</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span><span class="mi">16#5000</span><span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span><span class="mi">16#107</span><span class="p">,</span>  <span class="o">//</span><span class="n">Reference</span> <span class="n">Mode</span>
	<span class="n">nData</span><span class="o">:=</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span><span class="n">axis</span><span class="p">);</span>
	
<span class="n">fbWriteHomeVelocitiesToNC</span><span class="p">(</span>
  <span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
  <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">bConfigNCDone</span><span class="p">,</span>
  <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
  <span class="n">fVelocityFromCam</span><span class="o">:=</span><span class="n">fVelocityFromCamNC</span><span class="p">,</span>
  <span class="n">fVelocityToCam</span><span class="o">:=</span><span class="n">fVelocityToCamNC</span><span class="p">,</span>
  <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">);</span>

<span class="n">fbHome</span><span class="p">.</span><span class="n">bCalibrationCam</span><span class="o">:=</span><span class="n">bCamSensor</span><span class="p">;</span>

<span class="n">fbHome</span><span class="p">(</span>
	<span class="n">Execute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="k">AND</span> <span class="n">bConfigNCDone</span><span class="p">(</span><span class="o">*</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">bError</span><span class="o">*</span><span class="p">),</span>
	<span class="n">Position</span><span class="o">:=</span><span class="n">fHomePosition</span><span class="p">,</span>
	<span class="n">HomingMode</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
	<span class="p">);</span>
<span class="n">bBusy</span><span class="o">:=</span><span class="p">(</span><span class="n">fbHome</span><span class="p">.</span><span class="n">Busy</span> <span class="k">OR</span> <span class="p">(</span><span class="k">NOT</span> <span class="n">bConfigNCDone</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">));</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbHome</span><span class="p">.</span><span class="n">Done</span> <span class="k">AND</span> <span class="n">bConfigNCDone</span><span class="p">;</span>
<span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">Homed</span><span class="p">;</span>

<span class="k">IF</span> <span class="p">(</span><span class="k">NOT</span> <span class="n">bConfigNCDone</span><span class="p">)</span> <span class="k">AND</span> <span class="n">fbWriteHomeDirCamToNC</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">fbWriteHomeDirSyncToNC</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">fbWriteHomeModeToNC</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">fbWriteHomeVelocitiesToNC</span><span class="p">.</span><span class="n">bDone</span> <span class="k">THEN</span>
  <span class="n">bConfigNCDone</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="k">For</span> <span class="n">some</span> <span class="n">reason</span> <span class="n">MC_HOME</span> <span class="n">gives</span> <span class="n">an</span> <span class="n">Error</span> <span class="k">for</span> <span class="n">one</span> <span class="n">cycle</span> <span class="k">of</span> <span class="n">NC</span><span class="o">-</span><span class="n">Task</span> <span class="mi">1</span> <span class="n">SVB</span> <span class="p">(</span><span class="mi">10</span><span class="n">ms</span> <span class="n">default</span><span class="p">..)</span> <span class="n">so</span> <span class="n">filter</span> <span class="k">with</span> <span class="n">bExecute</span>
<span class="n">bError</span><span class="o">:=</span><span class="p">(</span><span class="n">fbHome</span><span class="p">.</span><span class="n">Error</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">)</span> <span class="k">OR</span> <span class="n">fbWriteHomeDirCamToNC</span><span class="p">.</span><span class="n">bError</span> <span class="k">OR</span> <span class="n">fbWriteHomeDirSyncToNC</span><span class="p">.</span><span class="n">bError</span> <span class="k">OR</span> <span class="n">fbWriteHomeModeToNC</span><span class="p">.</span><span class="n">bError</span> <span class="k">OR</span> <span class="n">fbWriteHomeVelocitiesToNC</span><span class="p">.</span><span class="n">bError</span><span class="p">;</span>

<span class="k">IF</span> <span class="p">(</span><span class="n">fbHome</span><span class="p">.</span><span class="n">Error</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">)</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHome</span><span class="p">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="k">ELSIF</span> <span class="n">fbWriteHomeDirCamToNC</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteHomeDirCamToNC</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="k">ELSIF</span> <span class="n">fbWriteHomeDirSyncToNC</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteHomeDirSyncToNC</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="k">ELSIF</span> <span class="n">fbWriteHomeModeToNC</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteHomeModeToNC</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="k">ELSIF</span> <span class="n">fbWriteHomeVelocitiesToNC</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteHomeVelocitiesToNC</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>  
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-homevirtual">
<h2>POU: FB_HomeVirtual<a class="headerlink" href="#pou-fb-homevirtual" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/Homing/FB_HomeVirtual.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>FUNCTION_BLOCK FB_HomeVirtual
VAR_INPUT
	En: BOOL;
	bReset: BOOL;
	bExecute: BOOL;
	nCmdData: UINT;
	bLimitFwd: BOOL;
	bLimitBwd: BOOL;	
	bHomeSensor: BOOL;	
	fHomePosition:LREAL;
	nHomeRevOffset: UINT;
END_VAR
VAR_IN_OUT
	Axis: AXIS_REF;
END_VAR
VAR_OUTPUT
	EnO: BOOL;	
	bBusy: BOOL;
	bDone: BOOL;
	bHomed:BOOL;
	bError: BOOL;
	nErrorId: UDINT;
END_VAR
VAR
	fbHomeToSwitch: FB_HomeToSwitch;
    fbHomeDirect: FB_HomeDirect; //Only used for direct homing (set of position)
    fbMoveVelocity:MC_MoveVelocity;
    fbHomePrepare:FB_HomePrepare;
	fbHomeFinish:FB_HomeFinish;    	    		
	fbExecuteRiseEdge: R_TRIG;
    nHomingState:INT:=0;
	bExecuteHomeToSwitch:BOOL:=FALSE;
	bExecuteMoveVelocity:BOOL:=FALSE;
	bExecutePrepare: BOOL:=FALSE;
	bExecuteFinish: BOOL:=FALSE;
	bExecuteHomeDirect: BOOL;
	nCmdDataLocal: UINT;  //Ensure that nCmdData is not changed during sequence
	bSequenceReady:BOOL:=TRUE;
	bRestoreNCDataNeeded: BOOL:=FALSE;
END_VAR
EnO:=En;

IF bReset THEN	
	bError:=FALSE;
	nErrorId:=0;
END_IF

// Reset when bExecute is low
IF NOT bExecute THEN
  nHomingState:=0;
  bSequenceReady:=TRUE;
  bExecuteHomeToSwitch:=FALSE;
  bExecuteHomeDirect:=FALSE;
  bExecuteMoveVelocity:=FALSE;
  bExecutePrepare:=FALSE;
  bExecuteFinish:=FALSE;
END_IF

//Reset at rinsing edge of bExecute
fbExecuteRiseEdge(CLK:=bExecute);
IF fbExecuteRiseEdge.Q THEN
  nCmdDataLocal:=nCmdData; //Ensure that nCmdData is not changed during sequence (nCmdData will only be read at a rising edge of bExecute)
  bSequenceReady:=FALSE;
  bExecutePrepare:=TRUE;  
  bRestoreNCDataNeeded:=FALSE;
  //Check if valid nCmdDataLocal
  CASE nCmdDataLocal OF  	
    1:
    2:
    3:
    4:
    15:
    ELSE //nCmdData not valid	
      bError:=TRUE;
      nErrorId:=16#4FFF;   
  END_CASE
END_IF

//############# Prepare for homing (Read from NC and reset homed flag)
fbHomePrepare(
  En:=En,
  bExecute:=bExecutePrepare AND NOT bError, // Not needed for sequence 15 (set position only, no movement))
  bReset:=bReset,
  Axis:=Axis,
);

//############# Homing Sequences:
CASE nCmdDataLocal OF  
	
   1: // Home to low limit switch
	   CASE nHomingState OF
		  0:
		    bHomed:=Axis.Status.Homed;
            // Wait for read of velocities from NC and reset of calibration flag
	        IF fbHomePrepare.bDone AND bExecute AND NOT bSequenceReady THEN
			  bRestoreNCDataNeeded:=TRUE;
			  IF bLimitBwd THEN
                nHomingState:=1;
              ELSE
				nHomingState:=2;  //Standing on limit switch go direct to state 2 
              END_IF                                          		  
	        END_IF
		  1: // wait for reach low limit then trigger fbHomeToSwitch
		    bHomed:=FALSE;
			bSequenceReady:=FALSE;
			fbMoveVelocity.Velocity:=ABS(fbHomePrepare.fVelocityToCam);
            fbMoveVelocity.Direction:=MC_Negative_Direction;
	        bExecuteMoveVelocity:=bExecute;  // Execute MC_MoveVelocity
		    IF NOT bLimitBwd AND NOT fbMoveVelocity.Busy AND Axis.Status.NotMoving THEN //MC_MoveVelocity.Busy goes down when ramp down initiates (not ends).
			  nHomingState:=2;
		    END_IF
		  2: // Wait for fbHomeToSwitch
		    bHomed:=FALSE;
		    bSequenceReady:=FALSE;
            bExecuteMoveVelocity:=FALSE;			
            bExecuteHomeToSwitch:=TRUE;	
            fbHomeToSwitch.nSearchDirTwoardsCam:=MC_Positive_Direction;
            fbHomeToSwitch.nSearchDirOffCam:=MC_Positive_Direction;	             
	        fbHomeToSwitch.fVelocityToCamNC:=fbHomePrepare.fVelocityToCam; // High speed
  	        fbHomeToSwitch.fVelocityFromCamNC:=fbHomePrepare.fVelocityFromCam;  // Low speed              		
		    fbHomeToSwitch.bCamSensor:=NOT bLimitBwd;            	 		    
	        IF fbHomeToSwitch.bDone THEN	          
			  nHomingState:=3;
			  bExecuteFinish:=TRUE;
			  fbHomeFinish.bSofLimEnableHigh:=fbHomePrepare.bSofLimEnableHighOriginal;
			  fbHomeFinish.bSofLimEnableLow:=fbHomePrepare.bSofLimEnableLowOriginal;
	        END_IF;	
          3: // restore softlimit enable
            bHomed:=FALSE;
		    bSequenceReady:=FALSE;            		            	
	        IF fbHomeFinish.bDone THEN
			  bRestoreNCDataNeeded:=FALSE;
	          bSequenceReady:=TRUE;
			  nHomingState:=0;
			  bHomed:=Axis.Status.Homed;
	        END_IF;	 
	   END_CASE;
	   
   2: // Home to high limit switch
	   CASE nHomingState OF
		  0:
		    bHomed:=Axis.Status.Homed;
            // Wait for read of velocities from NC and reset of calibration flag
	        IF fbHomePrepare.bDone AND bExecute AND NOT bSequenceReady THEN
			  bRestoreNCDataNeeded:=TRUE;
			  IF bLimitFwd THEN
                nHomingState:=1;
              ELSE
				nHomingState:=2;  //Standing on limit switch go direct to state 2 
              END_IF                                          		  
	        END_IF
		  1: // wait for reach low limit then trigger fbHomeToSwitch
		    bHomed:=FALSE;
			bSequenceReady:=FALSE;
			fbMoveVelocity.Velocity:=ABS(fbHomePrepare.fVelocityToCam);
            fbMoveVelocity.Direction:=MC_Positive_Direction;
	        bExecuteMoveVelocity:=bExecute;  // Execute MC_MoveVelocity
		    IF NOT bLimitFwd AND NOT fbMoveVelocity.Busy AND Axis.Status.NotMoving THEN //MC_MoveVelocity.Busy goes down when ramp down initiates (not ends).
			  nHomingState:=2;
		    END_IF
		  2: // Wait for fbHomeToSwitch
		    bHomed:=FALSE;
		    bSequenceReady:=FALSE;
            bExecuteMoveVelocity:=FALSE;			
            bExecuteHomeToSwitch:=TRUE;	
            fbHomeToSwitch.nSearchDirTwoardsCam:=MC_Negative_Direction;
            fbHomeToSwitch.nSearchDirOffCam:=MC_Negative_Direction;	             
	        fbHomeToSwitch.fVelocityToCamNC:=fbHomePrepare.fVelocityToCam; // High speed
  	        fbHomeToSwitch.fVelocityFromCamNC:=fbHomePrepare.fVelocityFromCam;  // Low speed              		
		    fbHomeToSwitch.bCamSensor:=NOT bLimitFwd;            	 		    
	        IF fbHomeToSwitch.bDone THEN	          
			  nHomingState:=3;
			  bExecuteFinish:=TRUE;
			  fbHomeFinish.bSofLimEnableHigh:=fbHomePrepare.bSofLimEnableHighOriginal;
			  fbHomeFinish.bSofLimEnableLow:=fbHomePrepare.bSofLimEnableLowOriginal;
	        END_IF;	
          3: // restore softlimit enable
            bHomed:=FALSE;
		    bSequenceReady:=FALSE;            		            	
	        IF fbHomeFinish.bDone THEN
			  bRestoreNCDataNeeded:=FALSE;
	          bSequenceReady:=TRUE;
			  nHomingState:=0;
			  bHomed:=Axis.Status.Homed;
	        END_IF;	 
	   END_CASE;
	   
   3: // Home on bHomeSensor via bLimitBwd
   	   CASE nHomingState OF
		  0:
		    bHomed:=Axis.Status.Homed;
            // Wait for read of velocities from NC and reset of calibration flag
	        IF fbHomePrepare.bDone AND bExecute AND NOT bSequenceReady THEN
			  bRestoreNCDataNeeded:=TRUE;
			  IF bLimitBwd THEN
                nHomingState:=1;
              ELSE
				nHomingState:=2;  //Standing on limit switch go direct to state 2 
              END_IF                                          		  
	        END_IF
		  1: // wait for reach low limit then trigger fbHomeToSwitch
		    bHomed:=FALSE;
			bSequenceReady:=FALSE;
			fbMoveVelocity.Velocity:=ABS(fbHomePrepare.fVelocityToCam);
            fbMoveVelocity.Direction:=MC_Negative_Direction;
	        bExecuteMoveVelocity:=bExecute;  // Execute MC_MoveVelocity
		    IF NOT bLimitBwd AND NOT fbMoveVelocity.Busy AND Axis.Status.NotMoving THEN //MC_MoveVelocity.Busy goes down when ramp down initiates (not ends).
			  nHomingState:=2;
		    END_IF
		  2: // Wait for fbHomeToSwitch
		    bHomed:=FALSE;
		    bSequenceReady:=FALSE;
            bExecuteMoveVelocity:=FALSE;			
            bExecuteHomeToSwitch:=TRUE;	
            fbHomeToSwitch.nSearchDirTwoardsCam:=MC_Positive_Direction;
            fbHomeToSwitch.nSearchDirOffCam:=MC_Positive_Direction;	             
	        fbHomeToSwitch.fVelocityToCamNC:=fbHomePrepare.fVelocityToCam; // High speed
  	        fbHomeToSwitch.fVelocityFromCamNC:=fbHomePrepare.fVelocityFromCam;  // Low speed              		
		    fbHomeToSwitch.bCamSensor:=bHomeSensor;            	 		    
	        IF fbHomeToSwitch.bDone THEN	          
			  nHomingState:=3;
			  bExecuteFinish:=TRUE;
			  fbHomeFinish.bSofLimEnableHigh:=fbHomePrepare.bSofLimEnableHighOriginal;
			  fbHomeFinish.bSofLimEnableLow:=fbHomePrepare.bSofLimEnableLowOriginal;
	        END_IF;	
          3: // restore softlimit enable
            bHomed:=FALSE;
		    bSequenceReady:=FALSE;            		            	
	        IF fbHomeFinish.bDone THEN
		      bRestoreNCDataNeeded:=FALSE;
	          bSequenceReady:=TRUE;
			  nHomingState:=0;
			  bHomed:=Axis.Status.Homed;
	        END_IF;	 
	   END_CASE;
	4:  // Home on bHomeSensor via bLimitFwd	   
	   CASE nHomingState OF
		  0:
		    bHomed:=Axis.Status.Homed;
            // Wait for read of velocities from NC and reset of calibration flag
	        IF fbHomePrepare.bDone AND bExecute AND NOT bSequenceReady THEN
			  bRestoreNCDataNeeded:=TRUE;
			  IF bLimitFwd THEN
                nHomingState:=1;
              ELSE
				nHomingState:=2;  //Standing on limit switch go direct to state 2 
              END_IF                                          		  
	        END_IF
		  1: // wait for reach low limit then trigger fbHomeToSwitch
		    bHomed:=FALSE;
			bSequenceReady:=FALSE;
			fbMoveVelocity.Velocity:=ABS(fbHomePrepare.fVelocityToCam);
            fbMoveVelocity.Direction:=MC_Positive_Direction;
	        bExecuteMoveVelocity:=bExecute;  // Execute MC_MoveVelocity
		    IF NOT bLimitFwd AND NOT fbMoveVelocity.Busy AND Axis.Status.NotMoving THEN //MC_MoveVelocity.Busy goes down when ramp down initiates (not ends).
			  nHomingState:=2;
		    END_IF
		  2: // Wait for fbHomeToSwitch
		    bHomed:=FALSE;
		    bSequenceReady:=FALSE;
            bExecuteMoveVelocity:=FALSE;			
            bExecuteHomeToSwitch:=TRUE;	
            fbHomeToSwitch.nSearchDirTwoardsCam:=MC_Negative_Direction;
            fbHomeToSwitch.nSearchDirOffCam:=MC_Negative_Direction;	             
	        fbHomeToSwitch.fVelocityToCamNC:=fbHomePrepare.fVelocityToCam; // High speed
  	        fbHomeToSwitch.fVelocityFromCamNC:=fbHomePrepare.fVelocityFromCam;  // Low speed              		
		    fbHomeToSwitch.bCamSensor:=bHomeSensor;            	 		    
	        IF fbHomeToSwitch.bDone THEN	          
			  nHomingState:=3;
			  bExecuteFinish:=TRUE;
			  fbHomeFinish.bSofLimEnableHigh:=fbHomePrepare.bSofLimEnableHighOriginal;
			  fbHomeFinish.bSofLimEnableLow:=fbHomePrepare.bSofLimEnableLowOriginal;
	        END_IF;	
          3: // Restore softlimit enable
            bHomed:=FALSE;
		    bSequenceReady:=FALSE;            		            	
	        IF fbHomeFinish.bDone THEN
			  bRestoreNCDataNeeded:=FALSE;
	          bSequenceReady:=TRUE;
			  nHomingState:=0;
			  bHomed:=Axis.Status.Homed;
	        END_IF;	 
	   END_CASE;
		  	    
   15: //Set current position (simplest homing sequence)
     bExecuteHomeDirect:=bExecute;
	 bHomed:=Axis.Status.Homed;
     IF fbHomeDirect.bDone THEN  //Homing ready				
	   bExecuteHomeDirect:=FALSE;				
       bSequenceReady:=TRUE;	
     END_IF	 
	 
ELSE
  fbHomeToSwitch.bCamSensor:=FALSE;
  bHomed:=Axis.Status.Homed;
END_CASE;

// Main homing block
fbHomeToSwitch(
	bExecute:=bExecuteHomeToSwitch AND bExecute AND NOT bError AND NOT bExecuteHomeDirect AND NOT bExecuteMoveVelocity,
 	bReset:=bReset,
	fHomePosition:=fHomePosition,
	Axis:=Axis
);

// Approach limit switch (error if MC_Home is used)
fbMoveVelocity(
    Execute:= bExecuteMoveVelocity AND bExecute AND NOT bError AND NOT bExecuteHomeToSwitch AND NOT bExecuteHomeDirect,
    Axis:=Axis
);

// No sequence, just set position value (nCmdDataLocal=15). Can not run if fbHomeToSwitch is executed
fbHomeDirect(
	bExecute:=bExecuteHomeDirect AND bExecute AND NOT bError  AND NOT bExecuteHomeToSwitch AND NOT bExecuteMoveVelocity,
 	bReset:=bReset,
	fHomePosition:=fHomePosition,
	Axis:=Axis
);

 
//############# Finish homing

IF NOT bexecute AND bRestoreNCDataNeeded THEN  //If homing is aborted restore is needed
	bExecuteFinish:=TRUE;
	IF fbHomeFinish.bDone THEN
	  bExecuteFinish:=FALSE;
      bRestoreNCDataNeeded:=FALSE;	
	END_IF
END_IF

fbHomeFinish(
  En:=En,
  bExecute:=bExecuteFinish,
  bReset:=bReset,
  Axis:=Axis,
);

// Error handling
IF NOT bError THEN
  IF fbHomeToSwitch.bError THEN 
	bError:=fbHomeToSwitch.bError;
	nErrorId:=fbHomeToSwitch.nErrorId;
  ELSIF fbHomeDirect.bError THEN
	bError:=fbHomeDirect.bError;
	nErrorId:=fbHomeDirect.nErrorId;
  ELSIF fbMoveVelocity.Error THEN
	bError:=fbMoveVelocity.Error;
	nErrorId:=fbMoveVelocity.ErrorId;    		    		
  END_IF;	
END_IF

// Done and busy bit
bDone:=bSequenceReady AND bExecute;
bBusy:=NOT bSequenceReady;	 

RETURN;

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-homewritencvelocities">
<h2>POU: FB_HomeWriteNcVelocities<a class="headerlink" href="#pou-fb-homewritencvelocities" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/Homing/FB_HomeWriteNcVelocities.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeWriteNcVelocities</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bReset</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>		
	<span class="n">fVelocityToCam</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">fVelocityFromCam</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>	
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
	<span class="n">Axis</span><span class="o">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">bBusy</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>	
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">fbExecuteRiseEdge</span><span class="o">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
	<span class="n">fbWriteVelocityToCam</span><span class="o">:</span><span class="n">FB_WriteFloatParameter</span><span class="p">;</span>
	<span class="n">fbWriteVelocityFromCam</span><span class="o">:</span><span class="n">FB_WriteFloatParameter</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">bReset</span> <span class="k">THEN</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span> 

<span class="n">fbExecuteRiseEdge</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>

<span class="n">fbWriteVelocityToCam</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16#4000</span><span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16#6</span><span class="p">,</span>
	<span class="n">nData</span><span class="o">:=</span><span class="n">fVelocityToCam</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>
	
<span class="n">fbWriteVelocityFromCam</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16#4000</span><span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16#7</span><span class="p">,</span>
	<span class="n">nData</span><span class="o">:=</span><span class="n">fVelocityFromCam</span><span class="p">,</span>
	<span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbWriteVelocityFromCam</span><span class="p">.</span><span class="n">bBusy</span> <span class="k">OR</span> <span class="n">fbWriteVelocityToCam</span><span class="p">.</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbWriteVelocityFromCam</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">fbWriteVelocityToCam</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbWriteVelocityToCam</span><span class="p">.</span><span class="n">bError</span> <span class="k">OR</span> <span class="n">fbWriteVelocityFromCam</span><span class="p">.</span><span class="n">bError</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">fbWriteVelocityToCam</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteVelocityToCam</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="k">ELSIF</span> <span class="n">fbWriteVelocityFromCam</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteVelocityFromCam</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-homewritesoftlimenable">
<h2>POU: FB_HomeWriteSoftLimEnable<a class="headerlink" href="#pou-fb-homewritesoftlimenable" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/Homing/FB_HomeWriteSoftLimEnable.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeWriteSoftLimEnable</span>
<span class="n">VAR_INPUT</span>
	<span class="n">En</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bReset</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>		
	<span class="n">bSofLimEnableLow</span><span class="o">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
	<span class="n">bSofLimEnableHigh</span><span class="o">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
	<span class="n">Axis</span><span class="o">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>	
	<span class="n">bBusy</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>	
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">fbExecuteRiseEdge</span><span class="o">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
	<span class="n">fbWriteSoftLimEnableLow</span><span class="o">:</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="p">;</span>
	<span class="n">fbWriteSoftLimEnableHigh</span><span class="o">:</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">bReset</span> <span class="k">THEN</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span> 

<span class="n">fbExecuteRiseEdge</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>

<span class="n">fbWriteSoftLimEnableLow</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16#5000</span><span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16#B</span><span class="p">,</span>
	<span class="n">nData</span><span class="o">:=</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="n">bSofLimEnableLow</span><span class="p">),</span>
	<span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>
	
<span class="n">fbWriteSoftLimEnableHigh</span><span class="p">(</span>
	<span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
	<span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16#5000</span><span class="p">,</span>
	<span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16#C</span><span class="p">,</span>
	<span class="n">nData</span><span class="o">:=</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="n">bSofLimEnableHigh</span><span class="p">),</span>
	<span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbWriteSoftLimEnableLow</span><span class="p">.</span><span class="n">bBusy</span> <span class="k">OR</span> <span class="n">fbWriteSoftLimEnableHigh</span><span class="p">.</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbWriteSoftLimEnableLow</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">fbWriteSoftLimEnableHigh</span><span class="p">.</span><span class="n">bDone</span> <span class="k">AND</span> <span class="n">bExecute</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbWriteSoftLimEnableHigh</span><span class="p">.</span><span class="n">bError</span> <span class="k">OR</span> <span class="n">fbWriteSoftLimEnableLow</span><span class="p">.</span><span class="n">bError</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">fbWriteSoftLimEnableHigh</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteSoftLimEnableHigh</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="k">ELSIF</span> <span class="n">fbWriteSoftLimEnableLow</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteSoftLimEnableLow</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-microstepcounttest">
<h2>POU: FB_MicroStepCountTest<a class="headerlink" href="#pou-fb-microstepcounttest" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/MotorTesting/FB_MicroStepCountTest.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_MicroStepCountTest</span>
<span class="n">VAR_INPUT</span>
    <span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fStepSize</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">nSteps</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">fMicroStep</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fVelocity</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">tSettleTime</span><span class="o">:</span> <span class="kt">TIME</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="o">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">nStepsCounted</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">nTheorySteps</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">fPercent</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fEstMicroSize</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbMoveRel</span><span class="o">:</span> <span class="n">MC_MoveRelative</span><span class="p">;</span>
    <span class="n">fbSettleTimer</span><span class="o">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">bDoMove</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nStepCounter</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>

    <span class="n">arrPosBuffer</span><span class="o">:</span> <span class="k">ARRAY</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">99</span><span class="p">]</span> <span class="k">OF</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fAvgPos</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">nArrIndex</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">nLoopIndex</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>

    <span class="n">fStartPos</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPrevPos</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fStepChange</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">fStepSum</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Motion</span> <span class="n">FB</span>
<span class="n">fbMoveRel</span><span class="p">(</span><span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Execute</span><span class="o">:=</span><span class="n">bDoMove</span><span class="p">,</span>
    <span class="n">Distance</span><span class="o">:=</span><span class="n">fStepSize</span><span class="p">,</span>
    <span class="n">Velocity</span><span class="o">:=</span><span class="n">fVelocity</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Settle</span> <span class="kt">time</span>
<span class="n">fbSettleTimer</span><span class="p">(</span><span class="k">IN</span><span class="o">:=</span><span class="n">fbMoveRel</span><span class="p">.</span><span class="n">Done</span><span class="p">,</span>
    <span class="n">PT</span><span class="o">:=</span><span class="n">tSettleTime</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Re</span><span class="o">-</span><span class="n">enable</span> <span class="n">the</span> <span class="n">move</span> <span class="k">for</span> <span class="k">next</span> <span class="n">cycle</span>
<span class="n">bDoMove</span> <span class="o">:=</span> <span class="n">bExecute</span> <span class="k">AND</span> <span class="n">nStepCounter</span> <span class="o">&lt;</span> <span class="n">nSteps</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Calculate</span> <span class="n">rolling</span> <span class="n">average</span>
<span class="n">arrPosBuffer</span><span class="p">[</span><span class="n">nArrIndex</span><span class="p">]</span> <span class="o">:=</span> <span class="n">Axis</span><span class="p">.</span><span class="n">NcToPlc</span><span class="p">.</span><span class="n">ActPos</span><span class="p">;</span>
<span class="n">fAvgPos</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">FOR</span> <span class="n">nLoopIndex</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">TO</span> <span class="mi">99</span> <span class="n">DO</span>
    <span class="n">fAvgPos</span> <span class="o">:=</span> <span class="n">fAvgPos</span> <span class="o">+</span> <span class="n">arrPosBuffer</span><span class="p">[</span><span class="n">nLoopIndex</span><span class="p">];</span>
<span class="n">END_FOR</span><span class="p">;</span>
<span class="n">fAvgPos</span> <span class="o">:=</span> <span class="n">fAvgPos</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">nArrIndex</span> <span class="o">:=</span> <span class="p">(</span><span class="n">nArrIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">MOD</span> <span class="mi">100</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Initialize</span> <span class="n">starting</span> <span class="n">variables</span>
<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bExecute</span> <span class="k">THEN</span>
    <span class="n">fStartPos</span> <span class="o">:=</span> <span class="n">fAvgPos</span><span class="p">;</span>
    <span class="n">fPrevPos</span> <span class="o">:=</span> <span class="n">fAvgPos</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Check</span> <span class="n">results</span>
<span class="k">IF</span> <span class="n">fbSettleTimer</span><span class="p">.</span><span class="n">Q</span> <span class="k">THEN</span>
    <span class="n">fStepChange</span> <span class="o">:=</span> <span class="n">fAvgPos</span> <span class="o">-</span> <span class="n">fPrevPos</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Invert</span> <span class="n">fStepChange</span> <span class="k">if</span> <span class="n">we</span> <span class="n">were</span> <span class="n">doing</span> <span class="n">negative</span> <span class="n">steps</span>
    <span class="k">IF</span> <span class="n">fStepSize</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">THEN</span>
        <span class="n">fStepChange</span> <span class="o">:=</span> <span class="n">fStepChange</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="k">IF</span> <span class="n">fStepChange</span> <span class="o">&gt;</span> <span class="n">fMicroStep</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="k">THEN</span>
        <span class="n">nStepsCounted</span> <span class="o">:=</span> <span class="n">nStepsCounted</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">fStepSum</span> <span class="o">:=</span> <span class="n">fStepSum</span> <span class="o">+</span> <span class="n">fStepChange</span><span class="p">;</span>
        <span class="n">fEstMicroSize</span> <span class="o">:=</span> <span class="n">fStepSum</span> <span class="o">/</span> <span class="n">nStepsCounted</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="n">nTheorySteps</span> <span class="o">:=</span> <span class="n">DINT_TO_UINT</span><span class="p">(</span><span class="n">TRUNC</span><span class="p">(</span><span class="k">ABS</span><span class="p">((</span><span class="n">fStartPos</span> <span class="o">-</span> <span class="n">fAvgPos</span><span class="p">)</span> <span class="o">/</span> <span class="n">fMicroStep</span><span class="p">)));</span>
    <span class="k">IF</span> <span class="n">nTheorySteps</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">THEN</span>
        <span class="n">fPercent</span> <span class="o">:=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">nStepsCounted</span> <span class="o">/</span> <span class="n">nTheorySteps</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="n">fPrevPos</span> <span class="o">:=</span> <span class="n">fAvgPos</span><span class="p">;</span>
    <span class="n">nStepCounter</span> <span class="o">:=</span> <span class="n">nStepCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Reset</span> <span class="n">the</span> <span class="n">move</span> <span class="k">block</span>
    <span class="n">bDoMove</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-motionpneumaticactuator">
<h2>POU: FB_MotionPneumaticActuator<a class="headerlink" href="#pou-fb-motionpneumaticactuator" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/FB_MotionPneumaticActuator.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>(*This function blcok implements a pnuematic actuator. That can be signle or double acting by setting the ibSingleCntrl accordingly*)
(* with double acting ibCntrlHold signal should be false, while with single acting the signal should be true*)
FUNCTION_BLOCK FB_MotionPneumaticActuator
VAR_INPUT
    (*EPS Interlock Bits*)
    ibInsertOK: BOOL; (*Actuator can be Inserted*)
    ibRetractOK: BOOL; (*ACtuator can be retracted*)
    ibPMPS_OK:BOOL; (*to be linked the Arbiter bit*)
    ibSingleCntrl:BOOL;(* TRUE if Actuator requires one Output signal to be activated, FALSE if its double acting i.e two outputs are required*)
    ibCntrlHold:BOOL; (* Control Signal must retain its value, must be TRUE in the case of single acting*)
    ibOverrideInterlock:BOOL; (*if true interlocks are ignored*)
    // Reset fault
    {attribute &#39;pytmc&#39; := &#39;
    pv: FF_Reset
    &#39;}
    i_xReset: BOOL;
END_VAR
VAR_OUTPUT
    {attribute &#39;pytmc&#39; := &#39;
    pv:
    &#39;}
    stPneumaticActuator    :    DUT_MotionPneumaticActuator;
    {attribute &#39;pytmc&#39; := &#39;
     pv: MPS_OK
     field: ZNAM FALSE
     field: ONAM TRUE
     field: DESC TRUE if MPS signal is OK
    &#39;}
    xMPS_OK:BOOL;
END_VAR
VAR_IN_OUT
    io_fbFFHWO    :    FB_HardwareFFOutput;
END_VAR
VAR
    // PMPS
    fbFF    :    FB_FastFault :=(
        i_DevName := &#39;MPA&#39;,
        i_Desc := &#39;Fault occurs when the device is moving&#39;,
        i_TypeCode := 10#1010);

    (*Init*)
    xFirstPass    :    BOOL;
    fbFSInit        :    R_TRIG;

    (* Timeouts*)
    tTimeOutDuration: TIME:= T#10S;
    tInserttimeout: TON;
    tRetracttimeout:TON;
    (*Limit switch latch timer*)
    tLimitSwitchLatchDuration: TIME:=T#1S;
    tInsertLimitSwitch:TON;
    tRetractLimitSwitch:TON;

    (*Logging*)
    fbLogger : FB_LogMessage := (eSubsystem:=E_SubSystem.MOTION);
    ePrevState : ENUM_PnuematicActuatorPositionState;
    tAction : R_TRIG; // Primary action of this device (Insert_DO, Retract_DO, etc.)
    tOverrideActivated : R_TRIG;

    (*IO*)
    i_xInsertedLS    AT%I*: BOOL;
    i_xRetractedLS    AT%I*: BOOL;
    q_xInsert_DO    AT%Q*: BOOL;
    q_xRetract_DO    AT%Q*: BOOL;

END_VAR
(*Initialize*)
fbFSInit( CLK := TRUE, Q =&gt; xFirstPass);
IF xFirstPass THEN
    stPneumaticActuator.eState := ENUM_PnuematicActuatorPositionState.INVALID;
    stPneumaticActuator.bRetract_SW := FALSE;
    stPneumaticActuator.bInsert_SW := FALSE;
END_IF

(*Soft IO Mapping to EPICS PVs*)
ACT_IO();

(* Manage States*)
IF stPneumaticActuator.i_bInLimitSwitch AND  stPneumaticActuator.i_bOutLimitSwitch THEN
    stPneumaticActuator.eState:=ENUM_PnuematicActuatorPositionState.INVALID;
ELSIF NOT stPneumaticActuator.i_bInLimitSwitch AND stPneumaticActuator.i_bOutLimitSwitch THEN
    stPneumaticActuator.eState:=ENUM_PnuematicActuatorPositionState.RETRACTED;
ELSIF stPneumaticActuator.i_bInLimitSwitch AND NOT stPneumaticActuator.i_bOutLimitSwitch THEN
    stPneumaticActuator.eState:=ENUM_PnuematicActuatorPositionState.INSERTED;
ELSIF NOT stPneumaticActuator.i_bInLimitSwitch AND NOT stPneumaticActuator.i_bOutLimitSwitch THEN
    stPneumaticActuator.eState:=ENUM_PnuematicActuatorPositionState.MOVING;
ELSE
    stPneumaticActuator.eState:=ENUM_PnuematicActuatorPositionState.INVALID ;
END_IF

(*Set the Done/Busy signal*)
stPneumaticActuator.bDone := (stPneumaticActuator.bRetract_SW AND stPneumaticActuator.eState=ENUM_PnuematicActuatorPositionState.RETRACTED)
                            OR (stPneumaticActuator.bInsert_SW AND stPneumaticActuator.eState=ENUM_PnuematicActuatorPositionState.INSERTED);
stPneumaticActuator.bBusy := (stPneumaticActuator.bRetract_SW AND stPneumaticActuator.eState&lt;&gt;ENUM_PnuematicActuatorPositionState.RETRACTED)
                            OR (stPneumaticActuator.bInsert_SW AND stPneumaticActuator.eState&lt;&gt;ENUM_PnuematicActuatorPositionState.INSERTED);
(*MPS FAULT*)
(* MPS Faults when the actuator is in motion*)
xMPS_OK := (stPneumaticActuator.eState=ENUM_PnuematicActuatorPositionState.RETRACTED) OR (stPneumaticActuator.eState=ENUM_PnuematicActuatorPositionState.INSERTED);
(*PMPS PERMISSION*)
// yet to be implemented

(* Can&#39;t have bRetract_SW and  bInsert_SW both be true*)
If (stPneumaticActuator.bRetract_SW) AND (stPneumaticActuator.bInsert_SW) THEN
    stPneumaticActuator.bRetract_SW := FALSE;
    stPneumaticActuator.bInsert_SW := FALSE;
END_IF
//Redundant??
(*Check if both digital outputs active at the same time, and clear all*)
IF stPneumaticActuator.q_bInsert THEN
    stPneumaticActuator.q_bRetract := FALSE;
    stPneumaticActuator.bRetract_SW:= FALSE;
END_IF;
IF stPneumaticActuator.q_bRetract THEN
    stPneumaticActuator.q_bInsert := FALSE;
    stPneumaticActuator.bInsert_SW:= FALSE;
END_IF;

(*Actuate the device*)
stPneumaticActuator.q_bRetract := stPneumaticActuator.bRetractOK AND stPneumaticActuator.bRetract_SW AND NOT stPneumaticActuator.bInsert_SW ;
stPneumaticActuator.q_bInsert := stPneumaticActuator.bInsertOK AND stPneumaticActuator.bInsert_SW AND NOT stPneumaticActuator.bRetract_SW ;

(*Reset the Control signal when command has been executed and give time to ensure the actuator is fully seated in either direction*)
IF (NOT ibSingleCntrl AND NOT ibCntrlHold) THEN
   IF (stPneumaticActuator.bRetract_SW AND stPneumaticActuator.i_bOutLimitSwitch AND tRetractLimitSwitch.Q ) THEN stPneumaticActuator.q_bRetract := FALSE; END_IF
   IF (stPneumaticActuator.bInsert_SW AND stPneumaticActuator.i_bInLimitSwitch AND tInsertLimitSwitch.Q) THEN stPneumaticActuator.q_bInsert := FALSE; END_IF
END_IF

(*Timers*)
tInserttimeout(IN:= stPneumaticActuator.q_bInsert, PT := tTimeOutDuration );
tRetracttimeout(IN:= stPneumaticActuator.q_bRetract, PT := tTimeOutDuration);
tInsertLimitSwitch(IN:= stPneumaticActuator.i_bInLimitSwitch, PT := tLimitSwitchLatchDuration);
tRetractLimitSwitch(IN:= stPneumaticActuator.i_bOutLimitSwitch, PT := tLimitSwitchLatchDuration);


///Check moving postion timout
IF NOT stPneumaticActuator.i_bInLimitSwitch AND tInserttimeout.Q THEN
    stPneumaticActuator.bError := TRUE;
    stPneumaticActuator.sErrorMessage:= &#39;Actuator insert timeout&#39;;
ELSIF NOT stPneumaticActuator.i_bOutLimitSwitch AND tRetracttimeout.Q THEN
    stPneumaticActuator.bError := TRUE;
    stPneumaticActuator.sErrorMessage:= &#39;Actuator retract timeout&#39;;
END_IF
// Reset error
stPneumaticActuator.bError R= stPneumaticActuator.bReset;

(*FAST FAULT*)
fbFF(i_xOK := xMPS_OK,
    i_xReset := i_xReset,
    io_fbFFHWO := io_fbFFHWO);

(*Soft IO Mapping to Epics pvs*)
ACT_IO();

END_FUNCTION_BLOCK
ACTION ACT_IO:
(*Inputs*)
stPneumaticActuator.i_bInLimitSwitch :=  i_xInsertedLS;
stPneumaticActuator.i_bOutLimitSwitch := i_xRetractedLS;

(*outputs*)
q_xInsert_DO:=stPneumaticActuator.q_bInsert;
q_xRetract_DO:=stPneumaticActuator.q_bRetract;

(*EPICS*)
stPneumaticActuator.bRetractOK := ibRetractOK;
stPneumaticActuator.bInsertOK := ibInsertOK;
END_ACTION
ACTION ACT_Logger:
// Log Valve timeouts
IF (tInserttimeout.Q OR tRetracttimeout.Q) THEN fbLogger(sMsg:=stPneumaticActuator.sErrorMessage, eSevr:=TcEventSeverity.Warning); END_IF

// Log Actuator commands
// Log valve open
tAction(CLK:= (stPneumaticActuator.q_bRetract OR stPneumaticActuator.q_bInsert));
IF tAction.Q THEN
   IF(stPneumaticActuator.q_bRetract) THEN fbLogger(sMsg:=&#39;Actuator commanded retract&#39;, eSevr:=TcEventSeverity.Info); END_IF
   IF(stPneumaticActuator.q_bInsert) THEN fbLogger(sMsg:=&#39;Actuator commanded insert&#39;, eSevr:=TcEventSeverity.Info); END_IF
END_IF


// State Logging
IF ePrevState &lt;&gt; stPneumaticActuator.eState THEN
      CASE stPneumaticActuator.eState OF
        ENUM_PnuematicActuatorPositionState.INVALID:
            fbLogger(sMsg:=&#39;Actuator invalid position.&#39;, eSevr:=TcEventSeverity.Critical);
          ENUM_PnuematicActuatorPositionState.MOVING:
            fbLogger(sMsg:=&#39;Actuator moving&#39;, eSevr:=TcEventSeverity.Warning);
        ENUM_PnuematicActuatorPositionState.RETRACTED:
            fbLogger(sMsg:=&#39;Actuator Retracted.&#39;, eSevr:=TcEventSeverity.Info);
        ENUM_PnuematicActuatorPositionState.INSERTED:
            fbLogger(sMsg:=&#39;Actuator Inserted.&#39;, eSevr:=TcEventSeverity.Info);
      END_CASE
      ePrevState := stPneumaticActuator.eState;
  END_IF
END_ACTION
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-motionrequest">
<h2>POU: FB_MotionRequest<a class="headerlink" href="#pou-fb-motionrequest" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/FB_MotionRequest.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>FUNCTION_BLOCK FB_MotionRequest
(*
    Request a move from an axis controlled via EPICS using FB_MotionStage
    This exists to manage situations where different bits of code may need to move the same motor.
    With just the DUT_MotionStage/FB_MotionStage setup it is possible for two function blocks to
    fight with and interfere with each other and with the EPICS commands.
*)
VAR_IN_OUT
    // Motor to move
    stMotionStage: DUT_MotionStage;
END_VAR
VAR_INPUT
    // Start move on rising edge, stop move on falling edge
    bExecute: BOOL;
    // Reset errors on rising edge
    bReset: BOOL;
    // Define behavior for when the motor is already moving
    enumMotionRequest: ENUM_MotionRequest := ENUM_MotionRequest.WAIT;
    // Goal position
    fPos: LREAL;
    // Move velocity
    fVel: LREAL;
    // Optional acceleration
    fAcc: LREAL;
    // Optional deceleration
    fDec: LREAL;
END_VAR
VAR_OUTPUT
    // True if in error state
    bError: BOOL;
    // Error code
    nErrorId: UDINT;
    // What the error code means
    sErrorMessage: STRING;
    // If TRUE, we are moving the motor
    bBusy: BOOL;
    // If TRUE, we are not moving the motor and our most recent move was successful
    bDone: BOOL;
END_VAR
VAR
    rtExec: R_TRIG;
    ftExec: F_TRIG;
    rtReset: R_TRIG;
    ftBusy: F_TRIG;
    nState: UINT := 0;
    bMyMove: BOOL;
    bCausedError: BOOL;
END_VAR
// Define local constants for our state machine states
VAR CONSTANT
    INIT: UINT := 0;
    WAIT_EXEC: UINT := 1;
    PICK_REQUEST: UINT := 2;
    WAIT_OTHER_MOVE: UINT := 3;
    STOP_OTHER_MOVE: UINT := 4;
    START_MOVE: UINT := 5;
    WAIT_MY_MOVE: UINT := 6;
    STOP_MY_MOVE: UINT := 7;
    DONE_MOVING: UINT := 8;
    ERROR: UINT := 9;
END_VAR
rtExec(CLK:=bExecute);
ftExec(CLK:=bExecute);
rtReset(CLK:=bReset);

// Go back to INIT state on reset
IF rtReset.Q THEN
    nState := INIT;
    IF bError AND stMotionStage.bError AND bCausedError THEN
        stMotionStage.bReset := TRUE;
    END_IF
END_IF
IF rtExec.Q OR ftExec.Q THEN
    bDone := FALSE;
END_IF

CASE nState OF
    // Start by setting everything to a known value
    INIT:
        nState := WAIT_EXEC;
        bError := FALSE;
        sErrorMessage := &#39;&#39;;
        bDone := FALSE;
        bCausedError := FALSE;
    // Normal &quot;waiting for move command&quot; state
    WAIT_EXEC:
        bMyMove := FALSE;
        // Looking for a rising edge on bExecute
        IF rtExec.Q THEN
            bDone := FALSE;
            nState := PICK_REQUEST;
        END_IF
    // Decide how to handle the request
    PICK_REQUEST:
        IF stMotionStage.bBusy THEN
            CASE enumMotionRequest OF
                ENUM_MotionRequest.WAIT:
                    nState := WAIT_OTHER_MOVE;
                ENUM_MotionRequest.INTERRUPT:
                    nState := STOP_OTHER_MOVE;
                ENUM_MotionRequest.ABORT:
                    nState := ERROR;
                    bError := TRUE;
                    nErrorId := 16#7900;
            END_CASE
        ELSE
            nState := START_MOVE;
        END_IF
    // Watch the other move, then see if it&#39;s our turn
    WAIT_OTHER_MOVE:
        IF NOT stMotionStage.bBusy THEN
            // Try to pick request again next cycle once the move is over
            nState := PICK_REQUEST;
        END_IF
    // Interrupt the other move, then go to start ours
    STOP_OTHER_MOVE:
        stMotionStage.bExecute := FALSE;
        IF NOT stMotionStage.bBusy THEN
            nState := START_MOVE;
        END_IF
    // Set the correct values on DUT_MotionStage to start a new absolute move
    START_MOVE:
        bMyMove := TRUE;
        stMotionStage.bExecute := TRUE;
        stMotionStage.nCommand := ENUM_EpicsMotorCmd.MOVE_ABSOLUTE;
        stMotionStage.fPosition := fPos;
        stMotionStage.fVelocity := fVel;
        stMotionStage.fAcceleration := fAcc;
        stMotionStage.fDeceleration := fDec;
        nState := WAIT_MY_MOVE;
    // Watch our ongoing move, look for the move to end or requests to stop the move from this FB
    WAIT_MY_MOVE:
        ftBusy(CLK:=stMotionStage.bBusy);
        IF ftBusy.Q THEN
            nState := DONE_MOVING;
        END_IF
        // Implement stop on falling trigger
        IF ftExec.Q THEN
            nState := STOP_MY_MOVE;
        END_IF
    // Request a stop and wait for it to happen
    STOP_MY_MOVE:
        stMotionStage.bExecute := FALSE;
        IF NOT stMotionStage.bBusy THEN
            nState := DONE_MOVING;
        END_IF
    // Pick out the bDone state and return to waiting
    DONE_MOVING:
        bDone := stMotionStage.bDone;
        nState := WAIT_EXEC;
    // Lock us into the error state until the FB is reset
    ERROR:
        bMyMove := FALSE;
END_CASE

// Transition to the ERROR state if applicable
IF bMyMove AND stMotionStage.bError THEN
    nState := ERROR;
    bError := TRUE;
    nErrorId := stMotionStage.nErrorId;
    bCausedError := TRUE;
END_IF
sErrorMessage := F_MotionErrorCodeLookup(nErrorId := nErrorId);

CASE nState OF
INIT, WAIT_EXEC, ERROR:
    bBusy := FALSE;
ELSE
    bBusy := TRUE;
END_CASE

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-motionstage">
<h2>POU: FB_MotionStage<a class="headerlink" href="#pou-fb-motionstage" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/FB_MotionStage.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_MotionStage</span>
<span class="p">(</span><span class="o">*</span>
    <span class="n">Default</span> <span class="n">implementation</span> <span class="k">for</span> <span class="n">PLC</span> <span class="n">behavior</span> <span class="k">when</span> <span class="n">motor</span> <span class="n">IOC</span> <span class="n">asks</span> <span class="k">for</span> <span class="n">a</span> <span class="n">move</span>
    <span class="n">This</span> <span class="n">can</span> <span class="n">be</span> <span class="n">extended</span> <span class="k">or</span> <span class="n">replaced</span> <span class="k">in</span> <span class="n">your</span> <span class="n">PLC</span> <span class="n">project</span> <span class="k">if</span> <span class="n">you</span> <span class="n">want</span>
    <span class="n">non</span><span class="o">-</span><span class="n">default</span> <span class="n">behavior</span> <span class="k">to</span> <span class="n">arise</span> <span class="n">from</span> <span class="n">the</span> <span class="n">motor</span> <span class="k">record</span> <span class="n">processing</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stMotionStage</span><span class="o">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbDriveVirtual</span><span class="o">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bFwdHit</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBwdHit</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">ftExec</span><span class="o">:</span> <span class="n">F_TRIG</span><span class="p">;</span>
    <span class="n">rtExec</span><span class="o">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rtUserExec</span><span class="o">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rtTarget</span><span class="o">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">fbSetEnables</span><span class="o">:</span> <span class="n">FB_SetEnables</span><span class="p">;</span>
    <span class="n">bPosGoal</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bNegGoal</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Start</span> <span class="k">with</span> <span class="n">an</span> <span class="n">accurate</span> <span class="n">status</span>
<span class="n">stMotionStage</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">ReadStatus</span><span class="p">();</span>

<span class="n">rtUserExec</span><span class="p">(</span><span class="n">CLK</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bExecute</span><span class="p">);</span>
<span class="n">bPosGoal</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">stAxisStatus</span><span class="p">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">fPosition</span><span class="p">;</span>
<span class="n">bNegGoal</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">stAxisStatus</span><span class="p">.</span><span class="n">fActPosition</span> <span class="o">&gt;</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">fPosition</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Handle</span> <span class="n">auto</span><span class="o">-</span><span class="n">enable</span> <span class="n">timing</span>
<span class="k">CASE</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nEnableMode</span> <span class="k">OF</span>
    <span class="n">ENUM_StageEnableMode</span><span class="p">.</span><span class="n">ALWAYS</span><span class="o">:</span>
        <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bExecute</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bExecute</span><span class="p">;</span>
    <span class="n">ENUM_StageEnableMode</span><span class="p">.</span><span class="n">NEVER</span><span class="o">:</span>
        <span class="n">bExecute</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bExecute</span><span class="p">;</span>
    <span class="n">ENUM_StageEnableMode</span><span class="p">.</span><span class="n">DURING_MOTION</span><span class="o">:</span>
        <span class="k">IF</span> <span class="n">rtUserExec</span><span class="p">.</span><span class="n">Q</span> <span class="k">THEN</span>
            <span class="k">IF</span> <span class="n">bPosGoal</span> <span class="k">THEN</span>
                <span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bAllForwardEnable</span> <span class="k">THEN</span>
                    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
                <span class="k">ELSIF</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
                    <span class="o">//</span> <span class="k">Not</span> <span class="n">an</span> <span class="n">error</span><span class="p">,</span> <span class="n">just</span> <span class="n">a</span> <span class="n">warning</span>
                    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="na">&#39;Cannot</span> <span class="n">move</span> <span class="n">past</span> <span class="kt">positive</span> <span class="n">limit</span><span class="p">.&#39;;</span>
                <span class="n">END_IF</span>
            <span class="k">ELSIF</span> <span class="n">bNegGoal</span> <span class="k">THEN</span>
                <span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bAllBackwardEnable</span> <span class="k">THEN</span>
                    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
                <span class="k">ELSIF</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
                    <span class="o">//</span> <span class="k">Not</span> <span class="n">an</span> <span class="n">error</span><span class="p">,</span> <span class="n">just</span> <span class="n">a</span> <span class="n">warning</span>
                    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="na">&#39;Cannot</span> <span class="n">move</span> <span class="n">past</span> <span class="n">negative</span> <span class="n">limit</span><span class="p">.&#39;;</span>
                <span class="n">END_IF</span>
            <span class="n">END_IF</span>
        <span class="n">END_IF</span>
        <span class="n">bExecute</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bExecute</span> <span class="k">AND</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnableDone</span><span class="p">;</span>
        <span class="k">IF</span> <span class="n">bExecute</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
            <span class="o">//</span> <span class="n">Reset</span> <span class="n">local</span> <span class="n">warnings</span> <span class="k">if</span> <span class="n">things</span> <span class="n">are</span> <span class="n">going</span> <span class="n">well</span>
            <span class="n">stMotionStage</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="p">&#39;&#39;;</span>
        <span class="n">END_IF</span>
<span class="n">END_CASE</span>

<span class="o">//</span> <span class="n">Automatically</span> <span class="n">fill</span> <span class="n">the</span> <span class="n">correct</span> <span class="n">nCmdData</span> <span class="k">for</span> <span class="n">homing</span>
<span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nCommand</span> <span class="o">=</span> <span class="n">ENUM_EpicsMotorCmd</span><span class="p">.</span><span class="n">HOME</span> <span class="k">THEN</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nCmdData</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nHomingMode</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Update</span> <span class="k">all</span> <span class="n">enable</span> <span class="n">booleans</span>
<span class="n">fbSetEnables</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">);</span>

<span class="o">//</span> <span class="n">No</span> <span class="n">moves</span> <span class="n">allowed</span> <span class="k">in</span> <span class="n">error</span> <span class="n">states</span>
<span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
    <span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Handle</span> <span class="n">standard</span> <span class="n">commands</span> <span class="n">using</span> <span class="n">ESS</span><span class="na">&#39;s</span> <span class="n">FB</span>
<span class="n">fbDriveVirtual</span><span class="p">(</span><span class="n">En</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
    <span class="n">bEnable</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">bReset</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">bReset</span><span class="p">,</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
    <span class="n">nCommand</span><span class="o">:=</span><span class="n">INT_TO_UINT</span><span class="p">(</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">nCommand</span><span class="p">),</span>
    <span class="n">nCmdData</span><span class="o">:=</span><span class="n">INT_TO_UINT</span><span class="p">(</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">nCmdData</span><span class="p">),</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">fVelocity</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">fPosition</span><span class="p">,</span>
    <span class="n">fAcceleration</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">fAcceleration</span><span class="p">,</span>
    <span class="n">fDeceleration</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">fDeceleration</span><span class="p">,</span>
    <span class="n">bLimitFwd</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">bAllForwardEnable</span><span class="p">,</span>
    <span class="n">bLimitBwd</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">bAllBackwardEnable</span><span class="p">,</span>
    <span class="n">bHomeSensor</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">bHome</span><span class="p">,</span>
    <span class="n">fHomePosition</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">fHomePosition</span><span class="p">,</span>
    <span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">bPowerSelf</span><span class="p">,</span>
    <span class="n">nMotionAxisID</span><span class="o">=&gt;</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">nMotionAxisID</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">Axis</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Update</span> <span class="n">status</span> <span class="n">again</span> <span class="k">after</span> <span class="n">the</span> <span class="n">move</span> <span class="n">starts</span> <span class="k">or</span> <span class="n">stops</span>
<span class="n">stMotionStage</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">ReadStatus</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Check</span> <span class="k">for</span> <span class="n">a</span> <span class="k">new</span> <span class="n">error</span>
<span class="k">IF</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">fbDriveVirtual</span><span class="p">.</span><span class="n">bError</span><span class="p">;</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nErrorId</span> <span class="o">:=</span> <span class="n">fbDriveVirtual</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">error</span> <span class="n">message</span> <span class="k">if</span> <span class="n">we</span> <span class="n">have</span> <span class="n">one</span>
<span class="n">stMotionStage</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="n">F_MotionErrorCodeLookup</span><span class="p">(</span><span class="n">nErrorId</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nErrorId</span><span class="p">);</span>

<span class="o">//</span> <span class="k">When</span> <span class="n">we</span> <span class="n">start</span><span class="p">,</span> <span class="n">set</span> <span class="n">the</span> <span class="n">busy</span><span class="o">/</span><span class="n">done</span> <span class="n">appropriately</span>
<span class="n">rtExec</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>
<span class="k">IF</span> <span class="n">rtExec</span><span class="p">.</span><span class="n">Q</span> <span class="k">THEN</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bBusy</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bDone</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Force</span> <span class="n">everything</span> <span class="n">off</span> <span class="k">in</span> <span class="k">case</span> <span class="k">of</span> <span class="n">error</span>
<span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bError</span> <span class="k">THEN</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bDone</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">limits</span> <span class="k">and</span> <span class="n">cancel</span> <span class="n">execution</span> <span class="k">if</span> <span class="n">appropriate</span><span class="p">.</span> <span class="n">Without</span> <span class="n">this</span> <span class="k">block</span> <span class="n">we</span> <span class="n">have</span> <span class="n">infinite</span> <span class="n">error</span> <span class="n">spam</span>
<span class="n">bFwdHit</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">PositiveDirection</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bAllForwardEnable</span><span class="p">;</span>
<span class="n">bBwdHit</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">NegativeDirection</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bAllBackwardEnable</span><span class="p">;</span>
<span class="k">IF</span> <span class="n">bFwdHit</span> <span class="k">OR</span> <span class="n">bBwdHit</span> <span class="k">THEN</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Check</span> <span class="n">done</span> <span class="n">moving</span> <span class="n">via</span> <span class="n">fbDriveVirtual</span> <span class="k">and</span> <span class="n">from</span> <span class="n">Target</span> <span class="n">Position</span> <span class="n">Monitoring</span><span class="p">.</span> <span class="n">Must</span> <span class="n">satisfy</span> <span class="n">both</span> <span class="n">conditions</span><span class="p">.</span>
<span class="n">ftExec</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">bExecute</span><span class="p">);</span>
<span class="n">rtTarget</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">InTargetPosition</span> <span class="k">AND</span> <span class="n">fbDriveVirtual</span><span class="p">.</span><span class="n">bDone</span><span class="p">);</span>
<span class="k">IF</span> <span class="n">rtTarget</span><span class="p">.</span><span class="n">Q</span> <span class="k">OR</span> <span class="n">ftExec</span><span class="p">.</span><span class="n">Q</span> <span class="k">THEN</span>
    <span class="k">IF</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bDone</span> <span class="k">THEN</span>
        <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bDone</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="k">IF</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">Error</span> <span class="k">THEN</span>
            <span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Handle</span> <span class="n">auto</span><span class="o">-</span><span class="n">disable</span> <span class="n">timing</span>
<span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nEnableMode</span> <span class="o">=</span> <span class="n">ENUM_StageEnableMode</span><span class="p">.</span><span class="n">DURING_MOTION</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bExecute</span> <span class="k">THEN</span>
    <span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">MotionState</span> <span class="o">=</span> <span class="n">MC_AXISSTATE_STANDSTILL</span> <span class="k">THEN</span>
        <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Get</span> <span class="n">a</span> <span class="n">definitive</span> <span class="n">bEnabled</span> <span class="n">reading</span>
<span class="k">CASE</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">MotionState</span> <span class="k">OF</span>
    <span class="o">//</span> <span class="n">We</span> <span class="n">are</span> <span class="k">not</span> <span class="n">enabled</span> <span class="k">if</span> <span class="n">there</span> <span class="k">is</span> <span class="n">an</span> <span class="n">issue</span>
    <span class="n">MC_AXISSTATE_UNDEFINED</span><span class="p">,</span> <span class="n">MC_AXISSTATE_DISABLED</span><span class="p">,</span> <span class="n">MC_AXISSTATE_ERRORSTOP</span><span class="o">:</span>
        <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnableDone</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">ELSE</span>
        <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnableDone</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_CASE</span>

<span class="o">//</span> <span class="n">Handle</span> <span class="n">the</span> <span class="n">brake</span><span class="p">.</span> <span class="n">TRUE</span> <span class="n">means</span> <span class="n">brake</span> <span class="n">disabled</span><span class="o">/</span><span class="n">released</span>
<span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nBrakeMode</span> <span class="o">&lt;&gt;</span> <span class="n">ENUM_StageBrakeMode</span><span class="p">.</span><span class="n">NO_BRAKE</span> <span class="k">THEN</span>
    <span class="k">CASE</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">Axis</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">MotionState</span> <span class="k">OF</span>
        <span class="n">MC_AXISSTATE_UNDEFINED</span><span class="p">,</span>
        <span class="n">MC_AXISSTATE_DISABLED</span><span class="p">,</span>
        <span class="n">MC_AXISSTATE_ERRORSTOP</span><span class="o">:</span>
            <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bBrakeRelease</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">MC_AXISSTATE_STANDSTILL</span><span class="o">:</span>
            <span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nBrakeMode</span> <span class="o">=</span> <span class="n">ENUM_StageBrakeMode</span><span class="p">.</span><span class="n">IF_MOVING</span> <span class="k">THEN</span>
                <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bBrakeRelease</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="k">ELSE</span>
                <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bBrakeRelease</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">END_IF</span>
        <span class="k">ELSE</span>
            <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bBrakeRelease</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">END_CASE</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Sync</span> <span class="n">the</span> <span class="n">epics</span> <span class="n">status</span> <span class="n">struct</span>
<span class="n">stMotionStage</span><span class="p">.</span><span class="n">stAxisStatus</span> <span class="o">:=</span> <span class="n">fbDriveVirtual</span><span class="p">.</span><span class="n">stAxisStatus</span><span class="p">;</span>
<span class="n">stMotionStage</span><span class="p">.</span><span class="n">stAxisStatus</span><span class="p">.</span><span class="n">bEnabled</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnableDone</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Reset</span> <span class="n">everything</span> <span class="k">when</span> <span class="n">bReset</span> <span class="k">is</span> <span class="n">flagged</span>
<span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bReset</span> <span class="k">THEN</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bReset</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nErrorId</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="p">&#39;&#39;;</span>
    <span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Ignore</span> <span class="n">homing</span> <span class="k">if</span> <span class="n">we</span> <span class="n">have</span> <span class="n">the</span> <span class="n">setting</span> <span class="k">for</span> <span class="n">it</span>
<span class="o">//</span> <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="k">for</span> <span class="n">pre</span><span class="o">-</span><span class="n">calibrated</span> <span class="n">absolute</span> <span class="n">encoders</span>
<span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nHomingMode</span> <span class="o">=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="p">.</span><span class="n">NONE</span> <span class="k">THEN</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">stAxisStatus</span><span class="p">.</span><span class="n">bHomed</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-motionstagesim">
<h2>POU: FB_MotionStageSim<a class="headerlink" href="#pou-fb-motionstagesim" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/FB_MotionStageSim.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_MotionStageSim</span>
<span class="p">(</span><span class="o">*</span>
    <span class="n">Set</span> <span class="k">all</span> <span class="n">the</span> <span class="n">values</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">a</span> <span class="n">fake</span> <span class="n">motor</span> <span class="k">to</span> <span class="n">be</span> <span class="n">movable</span>
    <span class="n">via</span> <span class="n">the</span> <span class="n">IOC</span><span class="p">,</span> <span class="k">then</span> <span class="n">call</span> <span class="n">FB_MotionStage</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stMotionStage</span><span class="o">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbMotionStage</span><span class="o">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">bInit</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bInit</span> <span class="k">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Stand</span><span class="o">-</span><span class="k">in</span> <span class="k">for</span> <span class="n">no</span> <span class="n">forward</span> <span class="n">limit</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bLimitForwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Stand</span><span class="o">-</span><span class="k">in</span> <span class="k">for</span> <span class="n">no</span> <span class="n">reverse</span> <span class="n">limit</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Stand</span><span class="o">-</span><span class="k">in</span> <span class="k">for</span> <span class="n">no</span> <span class="n">STO</span> <span class="n">button</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Stand</span><span class="o">-</span><span class="k">in</span> <span class="k">for</span> <span class="n">no</span> <span class="n">PMPS</span> <span class="n">governer</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Always</span> <span class="n">keep</span> <span class="n">it</span> <span class="n">enabled</span> <span class="k">for</span> <span class="n">testing</span> <span class="n">ease</span>
    <span class="n">stMotionStage</span><span class="p">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="p">.</span><span class="n">ALWAYS</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="o">//</span> <span class="n">Call</span> <span class="n">FB_MotionStage</span> <span class="k">to</span> <span class="n">do</span> <span class="n">the</span> <span class="n">thing</span>
<span class="n">fbMotionStage</span><span class="p">(</span><span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">);</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-ncaxis">
<h2>POU: FB_NcAxis<a class="headerlink" href="#pou-fb-ncaxis" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/Motion/FB_NcAxis.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>///#########################################################
///Function block to communicate between Nc and Plc.
///
///	Library:		
///	Tc2_MC2.lib
///
///	Global Variables:
///	
///	Data types:
///	
///	External functions:
///
///###########################################################
FUNCTION_BLOCK FB_NcAxis
VAR
	sVersion: STRING:=&#39;1.0.0&#39;;
END_VAR
VAR_INPUT
	En: BOOL;
END_VAR
VAR_OUTPUT
	EnO: BOOL;
	bError: BOOL;
	Status: ST_AxisStatus;
END_VAR
VAR
	Axis: AXIS_REF;
	InfoData_State AT %I*: UINT;
END_VAR
EnO:=En;

IF En AND InfoData_State&lt;&gt;16#8 THEN
	bError:=TRUE;
ELSE
	bError:=FALSE;
END_IF

IF En THEN
	Axis.ReadStatus();
	Status:=Axis.Status;
END_IF

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-positionstatelock">
<h2>POU: FB_PositionStateLock<a class="headerlink" href="#pou-fb-positionstatelock" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/States/FB_PositionStateLock.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_PositionStateLock</span>
<span class="p">(</span><span class="o">*</span>
    <span class="n">Implements</span> <span class="n">immutability</span> <span class="k">for</span> <span class="n">a</span> <span class="n">locked</span> <span class="n">DUT_PositionState</span>
    <span class="n">Once</span> <span class="n">this</span> <span class="k">is</span> <span class="n">called</span> <span class="n">the</span> <span class="n">first</span> <span class="kt">time</span><span class="p">,</span> <span class="n">the</span> <span class="n">parameters</span> <span class="n">at</span> <span class="n">the</span> <span class="kt">time</span> <span class="k">of</span> <span class="n">the</span> <span class="n">call</span> <span class="n">will</span> <span class="n">be</span> <span class="n">restored</span> <span class="k">on</span> <span class="k">all</span> <span class="n">subsequent</span> <span class="n">calls</span><span class="p">.</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stPositionState</span><span class="o">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">stCachedPositionState</span><span class="o">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">bInit</span><span class="o">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Force</span> <span class="n">values</span> <span class="k">to</span> <span class="n">be</span> <span class="n">cached</span> <span class="k">if</span> <span class="n">we</span><span class="na">&#39;ve</span> <span class="n">cached</span> <span class="n">something</span>
<span class="k">IF</span> <span class="n">bInit</span> <span class="k">AND</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">bLocked</span> <span class="k">THEN</span>
    <span class="n">stPositionState</span><span class="p">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">sName</span><span class="p">;</span>
    <span class="n">stPositionState</span><span class="p">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">fPosition</span><span class="p">;</span>
    <span class="n">stPositionState</span><span class="p">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">fDelta</span><span class="p">;</span>
    <span class="n">stPositionState</span><span class="p">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">fVelocity</span><span class="p">;</span>
    <span class="n">stPositionState</span><span class="p">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stPositionState</span><span class="p">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">fDecel</span><span class="p">;</span>
<span class="o">//</span> <span class="k">If</span> <span class="n">we</span> <span class="n">haven</span><span class="na">&#39;t</span> <span class="n">cached</span> <span class="k">and</span> <span class="n">we</span> <span class="n">should</span><span class="p">,</span> <span class="n">make</span> <span class="n">the</span> <span class="n">cache</span><span class="p">.</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">we</span> <span class="n">skip</span> <span class="n">bLocked</span><span class="p">,</span> <span class="n">bValid</span><span class="p">,</span> <span class="k">and</span> <span class="n">bMoveOk</span>
<span class="k">ELSIF</span> <span class="k">NOT</span> <span class="n">bInit</span> <span class="k">AND</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">bLocked</span> <span class="k">THEN</span>
    <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">sName</span><span class="p">;</span>
    <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">fPosition</span><span class="p">;</span>
    <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">fDelta</span><span class="p">;</span>
    <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">fVelocity</span><span class="p">;</span>
    <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stCachedPositionState</span><span class="p">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">fDecel</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="o">//</span> <span class="n">Do</span> <span class="n">nothing</span><span class="p">,</span> <span class="k">or</span> <span class="n">unlock</span> <span class="n">the</span> <span class="n">state</span> <span class="k">if</span> <span class="n">bLocked</span> <span class="n">goes</span> <span class="n">FALSE</span>
<span class="k">ELSIF</span> <span class="k">NOT</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">bLocked</span> <span class="k">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-positionstatemanager">
<h2>POU: FB_PositionStateManager<a class="headerlink" href="#pou-fb-positionstatemanager" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/States/FB_PositionStateManager.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>FUNCTION_BLOCK FB_PositionStateManager
(*
    Handles EPICS moves between multiple states for a single axis
    Should be wrapped inside a block with enums for states,
    see FB_EpicsInOut for an example.
*)
VAR_IN_OUT
    // Motor to move
    stMotionStage: DUT_MotionStage;

    // Allocated space for 15 states besides Unknown (16 is the max for an EPICS MBBI)
    {attribute &#39;pytmc&#39; := &#39;
        pv:
        io: io
        expand: %.2d
    &#39;}
    arrStates: ARRAY[1..15] OF DUT_PositionState;

    // Corresponding arrStates index to move to, or 0 if no move selected
    setState: INT;
END_VAR
VAR_INPUT
    // If TRUE, start a move when setState transitions to a nonzero number
    bEnable: BOOL;
    // On rising edge, reset this FB
    {attribute &#39;pytmc&#39; := &#39;
        pv: RESET
        io: io
        field: ZNAM False
        field: ONAM True
    &#39;}
    bReset: BOOL;
END_VAR
VAR_OUTPUT
    // If TRUE, there is an error
    {attribute &#39;pytmc&#39; := &#39;
        pv: ERR
        io: i
        field: ZNAM False
        field: ONAM True
    &#39;}
    bError: BOOL;
    // Error ID
    {attribute &#39;pytmc&#39; := &#39;
        pv: ERRID
        io: i
    &#39;}
    nErrorId: UDINT;
    // The error that caused bError to flip TRUE
    {attribute &#39;pytmc&#39; := &#39;
        pv: ERRMSG
        io: i
    &#39;}
    sErrorMessage: STRING;
    // If TRUE, we are moving the motor
    {attribute &#39;pytmc&#39; := &#39;
        pv: BUSY
        io: i
        field: ZNAM False
        field: ONAM True
    &#39;}
    bBusy: BOOL;
    // If TRUE, we are not moving the motor and the last move completed successfully
    {attribute &#39;pytmc&#39; := &#39;
        pv: DONE
        io: i
        field: ZNAM False
        field: ONAM True
    &#39;}
    bDone: BOOL;

    // The current position we are trying to reach, or 0
    goalState: INT;
    // The readback position
    getState: INT;
END_VAR
VAR
    bInit: BOOL;
    stUnknown: DUT_PositionState;
    stGoal: DUT_PositionState;
    fbStateMove: FB_PositionStateMove;
    nIndex: INT;
    bNewGoal: BOOL;
    bInnerExec: BOOL;
    bInnerReset: BOOL;
    rtReset: R_TRIG;
    bMoveRequested: BOOL;
END_VAR
// Reset just goes through the first-cycle init again
rtReset(CLK:=bReset);
IF rtReset.Q THEN
    bInit := FALSE;
END_IF

// First-cycle init
IF NOT bInit THEN
    bError := FALSE;
    sErrorMessage := &#39;&#39;;
    bBusy := FALSE;
    bDone := FALSE;
    bNewGoal := FALSE;
    bInnerExec := FALSE;
    bInnerReset := TRUE;
    setState := 0;
    goalState := 0;
END_IF

// Check where we are by going through all possible states.
// Note this favors the highest-number state that we&#39;re at, it&#39;s up to you to make your states mutually exclusive.
getState := 0;
FOR nIndex := 1 TO 15 DO
    IF F_AtPositionState(stMotionStage:=stMotionStage, stPositionState:=arrStates[nIndex]) THEN
        getState := nIndex;
    END_IF
END_FOR

// Use the changing set pv as a rising-edge trigger
IF setState &lt;&gt; goalState THEN
    goalState := setState;
    bNewGoal := TRUE;
END_IF

// Special move handling for error/enable state
IF bError OR NOT bEnable THEN
    bInnerExec := FALSE;
// Reset inner block this cycle if we were already moving but want a new move
ELSIF bInnerExec AND bNewGoal THEN
    bInnerExec := FALSE;
    bInnerReset := TRUE;
// If we hit this branch, we&#39;re starting a new move
ELSIF bNewGoal THEN
    bInnerExec := TRUE;
    bInnerReset := FALSE;
    bNewGoal := FALSE;
END_IF

// Pick the correct goal structure or Unknown
IF goalState = 0 THEN
    stGoal := stUnknown;
ELSE
    stGoal := arrStates[goalState];
END_IF

// Do the move
fbStateMove(
    stMotionStage := stMotionStage,
    stPositionState := stGoal,
    bExecute := bInnerExec,
    bReset := bInnerReset,
    enumMotionRequest := ENUM_MotionRequest.INTERRUPT,
    bBusy =&gt; bBusy);

// Only pass up bDone information if this FB is active
IF bInnerExec THEN
    bDone := fbStateMove.bDone;
END_IF

// Pick up any new errors, but don&#39;t override uncleared existing errors
IF NOT bError THEN
    bError := fbStateMove.bError;
    nErrorId := fbStateMove.nErrorId;
    sErrorMessage := fbStateMove.sErrorMessage;
END_IF

// Reset the setpoint and goal to 0 if we&#39;re not doing anything
// because FB is waiting for a change from 0 to &quot;something&quot;
bMoveRequested := bInnerExec AND NOT bDone;
IF NOT bError AND NOT bNewGoal AND NOT bMoveRequested THEN
    setState := 0;
    goalState := 0;
    bInnerExec := FALSE;
END_IF

// Bring inner reset back low at the end of the init cycle so that it can be triggered again later
IF NOT bInit THEN
    bInit := TRUE;
    bInnerReset := FALSE;
END_IF

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-positionstatemove">
<h2>POU: FB_PositionStateMove<a class="headerlink" href="#pou-fb-positionstatemove" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/States/FB_PositionStateMove.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>FUNCTION_BLOCK FB_PositionStateMove
// Request a move to a particular state from an axis controlled via EPICS
// pytmc PVs here only exposed if using directly and not through FB_PositionStateManager
VAR_IN_OUT
    // Motor to move
    stMotionStage: DUT_MotionStage;

    // State to move to
    {attribute &#39;pytmc&#39; := &#39;
        pv:
    &#39;}
    stPositionState: DUT_PositionState;
END_VAR
VAR_INPUT
    // Start move on rising edge, stop move on falling edge
    {attribute &#39;pytmc&#39; := &#39;
        pv: GO
        io: io
        field: ZNAM False
        field: ONAM True
    &#39;}
    bExecute: BOOL;

    // Rising edge error reset
    {attribute &#39;pytmc&#39; := &#39;
        pv: RESET
        io: io
        field: ZNAM False
        field: ONAM True
    &#39;}
    bReset: BOOL;

    // Define behavior for when a move is already active
    enumMotionRequest: ENUM_MotionRequest := ENUM_MotionRequest.WAIT;
END_VAR
VAR_OUTPUT
    // TRUE if the motor is at this state
    {attribute &#39;pytmc&#39; := &#39;
        pv: AT_STATE
        io: input
        field: ZNAM False
        field: ONAM True
    &#39;}
    bAtState: BOOL;

    // TRUE if we have an error
    {attribute &#39;pytmc&#39; := &#39;
        pv: ERR
        io: input
        field: ZNAM False
        field: ONAM True
    &#39;}
    bError: BOOL;

    // Error code
    {attribute &#39;pytmc&#39; := &#39;
        pv: ERRID
        io: input
    &#39;}
    nErrorID: UDINT;

    // Error description
    {attribute &#39;pytmc&#39; := &#39;
        pv: ERRMSG
        io: input
    &#39;}
    sErrorMessage: STRING;

    // TRUE if we are moving to a state
    {attribute &#39;pytmc&#39; := &#39;
        pv: BUSY
        io: input
        field: ZNAM False
        field: ONAM True
    &#39;}
    bBusy: BOOL;

    // TRUE if we are note moving and we reached a state successfully on our last move
    {attribute &#39;pytmc&#39; := &#39;
        pv: DONE
        io: input
        field: ZNAM False
        field: ONAM True
    &#39;}
    bDone: BOOL;
END_VAR
VAR
    fbMotionRequest: FB_MotionRequest;
    bAllowMove: BOOL;
END_VAR
// Veto the move for uninitialized and unsafe states
bAllowMove := stPositionState.bMoveOk AND stPositionState.bValid;

// Do the move
fbMotionRequest(
    stMotionStage := stMotionStage,
    bExecute := bExecute AND bAllowMove,
    bReset := bReset,
    enumMotionRequest := enumMotionRequest,
    fPos := stPositionState.fPosition,
    fVel := stPositionState.fVelocity,
    fAcc := stPositionState.fAccel,
    fDec := stPositionState.fDecel,
    bError =&gt; bError,
    nErrorId =&gt; nErrorId,
    sErrorMessage =&gt; sErrorMessage,
    bBusy =&gt; bBusy,
    bDone =&gt; bDone);

// Inject custom error if we can&#39;t move because of bMoveOk or bValid
IF bExecute AND NOT bAllowMove THEN
    bError := TRUE;
    IF stPositionState.bValid THEN
        nErrorId := 16#7901;
    ELSE
        nErrorId := 16#7902;
    END_IF
    sErrorMessage := F_MotionErrorCodeLookup(nErrorId := nErrorID);
END_IF

// This can be useful if we&#39;re running this FB standalone for some reason
bAtState := F_AtPositionState(stMotionStage:=stMotionStage, stPositionState:=stPositionState);

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-readfloatparameter">
<h2>POU: FB_ReadFloatParameter<a class="headerlink" href="#pou-fb-readfloatparameter" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/ChangeConfig/FB_ReadFloatParameter.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_ReadFloatParameter</span>
<span class="n">VAR_INPUT</span>
	<span class="n">bExecute</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="o">///</span><span class="mi">16#4000</span><span class="o">=</span><span class="n">Axisdata</span><span class="p">,</span> <span class="mi">16#5000</span><span class="o">=</span><span class="n">Encoderdata</span><span class="p">,</span> <span class="mi">16#6000</span><span class="o">=</span><span class="n">Controldata</span><span class="p">,</span> <span class="mi">16#7000</span><span class="o">=</span><span class="n">Drivedata</span>
	<span class="n">nDeviceGroup</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
	<span class="n">nIndexOffset</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
	<span class="n">nData</span><span class="o">:</span> <span class="n">LREAL</span><span class="p">;</span>
	<span class="n">bBusy</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span><span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
	<span class="n">Axis</span><span class="o">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
	<span class="n">nState</span><span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">fbADSREAD</span><span class="o">:</span> <span class="n">ADSREAD</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span><span class="n">Sequence</span> <span class="k">to</span> <span class="n">read</span> <span class="n">parameter</span> <span class="k">in</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
<span class="k">CASE</span> <span class="n">nState</span> <span class="k">OF</span>
<span class="mi">0</span><span class="o">:</span>  <span class="p">(</span><span class="o">*</span><span class="n">Start</span> <span class="n">sequence</span><span class="p">.</span> <span class="k">Wait</span> <span class="k">until</span> <span class="n">bExecute</span> <span class="k">is</span> <span class="n">TRUE</span><span class="o">*</span><span class="p">)</span>
	<span class="k">IF</span> <span class="n">bExecute</span> <span class="k">THEN</span>
		<span class="n">bBusy</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
		<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
		<span class="n">nState</span><span class="o">:=</span><span class="mi">10</span><span class="p">;</span>
	<span class="n">END_IF</span>

<span class="mi">10</span><span class="o">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Read</span> <span class="n">parameter</span> <span class="k">in</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
	<span class="n">fbADSREAD</span><span class="p">(</span>
		<span class="k">PORT</span><span class="o">:=</span><span class="mi">500</span><span class="p">,</span>
		<span class="n">IDXGRP</span><span class="o">:=</span><span class="n">nDeviceGroup</span><span class="o">+</span><span class="n">Axis</span><span class="p">.</span><span class="n">NcToPlc</span><span class="p">.</span><span class="n">AxisId</span><span class="p">,</span>
		<span class="n">IDXOFFS</span><span class="o">:=</span><span class="n">nIndexOffset</span><span class="p">,</span>
		<span class="n">LEN</span><span class="o">:=</span><span class="n">SIZEOF</span><span class="p">(</span><span class="n">nData</span><span class="p">),</span>
		<span class="n">DESTADDR</span><span class="o">:=</span><span class="n">ADR</span><span class="p">(</span><span class="n">nData</span><span class="p">),</span>
		<span class="n">READ</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

	<span class="p">(</span><span class="o">*</span><span class="k">Wait</span> <span class="k">until</span> <span class="n">it</span><span class="na">&#39;s</span> <span class="n">done</span> <span class="k">or</span> <span class="k">if</span> <span class="n">an</span> <span class="n">error</span> <span class="n">occurs</span><span class="o">*</span><span class="p">)</span>
	<span class="k">IF</span> <span class="k">NOT</span> <span class="n">fbADSREAD</span><span class="p">.</span><span class="n">ERR</span> <span class="k">THEN</span>
		<span class="k">IF</span> <span class="k">NOT</span> <span class="n">fbADSREAD</span><span class="p">.</span><span class="n">BUSY</span> <span class="k">THEN</span>
			<span class="n">fbADSREAD</span><span class="p">(</span><span class="n">READ</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
			<span class="n">nState</span><span class="o">:=</span><span class="mi">20</span><span class="p">;</span>
		<span class="n">END_IF</span>
	<span class="k">ELSE</span>
		<span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbADSREAD</span><span class="p">.</span><span class="n">ERRID</span><span class="p">;</span>
		<span class="n">nState</span><span class="o">:=</span><span class="mi">999</span><span class="p">;</span>
	<span class="n">END_IF</span>

<span class="mi">20</span><span class="o">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Sequense</span> <span class="k">is</span> <span class="n">done</span><span class="p">.</span> <span class="n">Waits</span> <span class="k">until</span> <span class="n">bExecute</span> <span class="k">is</span> <span class="n">FALSE</span><span class="o">*</span><span class="p">)</span>
	<span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
	<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bExecute</span> <span class="k">THEN</span>
		<span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
		<span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">END_IF</span>

<span class="mi">999</span><span class="o">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Error</span> <span class="k">in</span> <span class="n">sequence</span><span class="o">*</span><span class="p">)</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
	<span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
	<span class="n">fbADSREAD</span><span class="p">(</span><span class="n">READ</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
	<span class="k">IF</span> <span class="k">NOT</span> <span class="n">bExecute</span> <span class="k">THEN</span>
		<span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">END_IF</span>

<span class="n">END_CASE</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-readparameterinnc-v1-00">
<h2>POU: FB_ReadParameterInNc_v1_00<a class="headerlink" href="#pou-fb-readparameterinnc-v1-00" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/ChangeConfig/FB_ReadParameterInNc_v1_00.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>///#########################################################
///Function block to read parameter in Nc.
///
///	Library:		
///	Tc2_MC2.lib
/// Tc2_System.lib
///
///	Global Variables:
///	
///	Data types:
///	
///	External functions:
///
///	History:
///	2014-02-05	v1.00	NB	Release code.
///
///	Known bugs:
///
///
///
///###########################################################
FUNCTION_BLOCK FB_ReadParameterInNc_v1_00
VAR_INPUT
	bExecute: BOOL;
	///16#4000=Axisdata, 16#5000=Encoderdata, 16#6000=Controldata, 16#7000=Drivedata
	nDeviceGroup: UDINT;
	nIndexOffset: UDINT;
END_VAR
VAR_OUTPUT
	nData: DWORD;
	bBusy: BOOL;
	bDone: BOOL;
	bError: BOOL;
	nErrorId: UDINT;
END_VAR
VAR_IN_OUT
	Axis: AXIS_REF;
END_VAR
VAR
	nState: UINT;
	fbADSREAD: ADSREAD;
END_VAR
(*Sequence to read parameter in Nc*)
CASE nState OF
0:  (*Start sequence. Wait until bExecute is TRUE*)
	IF bExecute THEN
		bBusy:=TRUE;
		bError:=FALSE;
		nErrorId:=0;
		nState:=10;
	END_IF

10: (*Read parameter in Nc*)
	fbADSREAD(
		PORT:=500,
		IDXGRP:=nDeviceGroup+Axis.NcToPlc.AxisId,
		IDXOFFS:=nIndexOffset,
		LEN:=SIZEOF(nData),
		DESTADDR:=ADR(nData),
		READ:=TRUE);

	(*Wait until it&#39;s done or if an error occurs*)
	IF NOT fbADSREAD.ERR THEN
		IF NOT fbADSREAD.BUSY THEN
			fbADSREAD(READ:=FALSE);
			nState:=20;
		END_IF
	ELSE
		nErrorId:=fbADSREAD.ERRID;
		nState:=999;
	END_IF

20: (*Sequense is done. Waits until bExecute is FALSE*)
	bBusy:=FALSE;
	bDone:=TRUE;
	IF NOT bExecute THEN
		bDone:=FALSE;
		nState:=0;
	END_IF

999: (*Error in sequence*)
	bError:=TRUE;
	bBusy:=FALSE;
	bDone:=FALSE;
	fbADSREAD(READ:=FALSE);
	IF NOT bExecute THEN
		nState:=0;
	END_IF

END_CASE

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-setenables">
<h2>POU: FB_SetEnables<a class="headerlink" href="#pou-fb-setenables" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/Utils/FB_SetEnables.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_SetEnables</span>
<span class="o">//</span> <span class="n">Update</span> <span class="n">the</span> <span class="k">all</span> <span class="n">enable</span> <span class="n">booleans</span> <span class="n">based</span> <span class="k">on</span> <span class="n">the</span> <span class="n">booleans</span> <span class="n">that</span> <span class="n">make</span> <span class="n">them</span> <span class="n">up</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stMotionStage</span><span class="o">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stMotionStage</span><span class="p">.</span><span class="n">bAllForwardEnable</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bLimitForwardEnable</span> <span class="k">AND</span> <span class="p">(</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">bGantryForwardEnable</span> <span class="k">OR</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bGantryAxis</span><span class="p">);</span>
<span class="n">stMotionStage</span><span class="p">.</span><span class="n">bAllBackwardEnable</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bLimitBackwardEnable</span> <span class="k">AND</span> <span class="p">(</span><span class="n">stMotionStage</span><span class="p">.</span><span class="n">bGantryBackwardEnable</span> <span class="k">OR</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bGantryAxis</span><span class="p">);</span>

<span class="n">stMotionStage</span><span class="p">.</span><span class="n">bAllEnable</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bEnable</span> <span class="k">AND</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bHardwareEnable</span><span class="p">;</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-stateptpmove">
<h2>POU: FB_StatePTPMove<a class="headerlink" href="#pou-fb-stateptpmove" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Deprecated/FB_StatePTPMove.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>FUNCTION_BLOCK FB_StatePTPMove
// Do not use, this is deprecated
VAR_INPUT
    {attribute &#39;pytmc&#39; := &#39;
        pv:
    &#39;}
    stPositionState: DUT_PositionState;

    {attribute &#39;pytmc&#39; := &#39;
        pv: GO
        io: io
        field: ZNAM False
        field: ONAM True
    &#39;}
    bExecute: BOOL;

    bMoveOk: BOOL;
END_VAR
VAR_IN_OUT
    stMotionStage: DUT_MotionStage;
END_VAR
VAR_OUTPUT
    {attribute &#39;pytmc&#39; := &#39;
        pv: AT_STATE
        io: input
        field: ZNAM False
        field: ONAM True
    &#39;}
    bAtState: BOOL;

    {attribute &#39;pytmc&#39; := &#39;
        pv: DMOV
        io: input
        field: ZNAM False
        field: ONAM True
    &#39;}
    bDone: BOOL;

    {attribute &#39;pytmc&#39; := &#39;
        pv: BUSY
        io: input
        field: ZNAM False
        field: ONAM True
    &#39;}
    bBusy: BOOL;

    {attribute &#39;pytmc&#39; := &#39;
        pv: ERR
        io: input
        field: ZNAM False
        field: ONAM True
    &#39;}
    bError: BOOL;

    {attribute &#39;pytmc&#39; := &#39;
        pv: ERRMSG
        io: input
    &#39;}
    sError: STRING;
END_VAR
VAR
    bExecTrig: R_TRIG;
    bExecEnd: F_TRIG;
    fActPosition: LREAL;
    fLowPos: LREAL;
    fHighPos: LREAL;
END_VAR
bExecTrig(CLK:=bExecute);
IF bExecTrig.Q AND bMoveOk THEN
    IF NOT stMotionStage.bBusy AND NOT stMotionStage.bError THEN
        stMotionStage.bExecute := TRUE;
        stMotionStage.nCommand := ENUM_EpicsMotorCmd.MOVE_ABSOLUTE;
        stMotionStage.fPosition := stPositionState.fPosition;
        stMotionStage.fVelocity := stPositionState.fVelocity;
        stMotionStage.fAcceleration := stPositionState.fAccel;
        stMotionStage.fDeceleration := stPositionState.fDecel;
        bDone := FALSE;
        bBusy := TRUE;
    END_IF
END_IF
bError := stMotionStage.bError;
sError := stMotionStage.sErrorMessage;

fActPosition := stMotionStage.stAxisStatus.fActPosition;
fLowPos := stPositionState.fPosition - stPositionState.fDelta;
fHighPos := stPositionState.fPosition + stPositionState.fDelta;
IF (fLowPos &lt; fActPosition) AND (fHighPos &gt; fActPosition) THEN
    bAtState := TRUE;
    IF NOT stMotionStage.bBusy THEN
        bDone := TRUE;
        bBusy := FALSE;
        bExecute := FALSE;
    END_IF
ELSE
    bAtState := FALSE;
END_IF

bExecEnd(CLK:=bExecute);
IF bExecEnd.Q AND bBusy THEN
    stMotionStage.bExecute := FALSE;
END_IF

IF NOT stMotionStage.bExecute OR NOT bExecute THEN
    bDone := TRUE;
    bBusy := FALSE;
    bExecute := FALSE;
END_IF

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-terminalerror">
<h2>POU: FB_TerminalError<a class="headerlink" href="#pou-fb-terminalerror" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/ErrorHandling/FB_TerminalError.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_TerminalError</span>

<span class="n">VAR_INPUT</span>
	<span class="n">En</span>					<span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">iTerminal_ID</span>		<span class="o">:</span> <span class="n">INT</span><span class="p">;</span>
	<span class="n">bWcState</span>			<span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">uiInfoData_State</span>	<span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">pErrorSystem</span>		<span class="o">:</span> <span class="n">POINTER</span> <span class="k">TO</span> <span class="n">ST_ErrorSystem</span><span class="p">;</span>					<span class="o">//</span><span class="n">Pointer</span> <span class="k">to</span> <span class="n">the</span> <span class="n">error</span> <span class="n">system</span>
<span class="n">END_VAR</span>

<span class="n">VAR_OUTPUT</span>
	<span class="n">EnO</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>
	<span class="n">bError</span> <span class="o">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
	<span class="n">iStateError</span> <span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">iOtherError</span> <span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	<span class="n">ErrorData</span>	<span class="o">:</span> <span class="n">DUT_TerminalError</span><span class="p">;</span>
	<span class="n">nErrSysCNT</span>	<span class="o">:</span> <span class="n">UINT</span><span class="p">;</span>
	
	<span class="o">//</span><span class="n">testing</span>
	<span class="n">bStateChanged</span> <span class="o">:</span> <span class="n">BOOL</span><span class="p">;</span>						<span class="o">//</span><span class="n">Indicate</span> <span class="k">if</span> <span class="n">state</span> <span class="n">change</span> <span class="n">happened</span>
	<span class="n">uiInfoData_State_Prev</span> <span class="o">:</span> <span class="n">UINT</span> <span class="o">:=</span> <span class="mi">16#8</span><span class="p">;</span>		<span class="o">//</span><span class="n">Previous</span> <span class="n">value</span> <span class="k">of</span> <span class="n">Infodata</span><span class="p">.</span><span class="n">State</span>
	<span class="n">bWcState_Prev</span> <span class="o">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>				<span class="o">//</span><span class="n">Previous</span> <span class="n">state</span> <span class="k">of</span> <span class="n">WcState</span>
	
	<span class="o">//</span><span class="n">FB</span><span class="o">-</span><span class="n">s</span>
	
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="n">Currently</span><span class="o">:</span>

<span class="n">Problem</span><span class="o">:</span>

<span class="n">TODO</span><span class="o">:</span>

<span class="o">*</span><span class="p">)</span>

<span class="o">//</span><span class="n">Connect</span> <span class="n">EN</span> <span class="k">to</span> <span class="n">EnO</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span><span class="n">Check</span> <span class="k">if</span> <span class="n">pointer</span> <span class="k">is</span> <span class="n">OK</span>
<span class="k">IF</span> <span class="n">pErrorSystem</span><span class="o">=</span><span class="mi">0</span> <span class="k">THEN</span> <span class="k">RETURN</span><span class="p">;</span> <span class="n">END_IF</span>

<span class="o">//</span><span class="n">Any</span> <span class="n">difference</span> <span class="n">from</span> <span class="n">normal</span> <span class="n">state</span> <span class="n">creates</span> <span class="n">an</span> <span class="n">error</span>
<span class="k">IF</span> <span class="n">En</span> <span class="k">AND</span> <span class="p">(</span><span class="n">bWcState</span> <span class="k">OR</span> <span class="n">uiInfoData_State</span><span class="o">&lt;&gt;</span><span class="mi">16#8</span><span class="p">)</span> <span class="k">THEN</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="k">ELSE</span>
	<span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Change</span> <span class="n">detection</span>
<span class="k">IF</span> <span class="n">uiInfoData_State</span> <span class="o">&lt;&gt;</span> <span class="n">uiInfoData_State_Prev</span> <span class="k">OR</span> <span class="n">bWcState</span> <span class="o">&lt;&gt;</span> <span class="n">bWcState_Prev</span> <span class="k">THEN</span>
	<span class="n">bStateChanged</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="k">ELSE</span>
	<span class="n">bStateChanged</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Update</span> <span class="n">previous</span> <span class="n">values</span>
<span class="n">uiInfoData_State_Prev</span> <span class="o">:=</span> <span class="n">uiInfoData_State</span><span class="p">;</span>
<span class="n">bWcState_Prev</span> <span class="o">:=</span> <span class="n">bWcState</span><span class="p">;</span>

<span class="o">//</span><span class="n">Decision</span> <span class="n">tree</span>
<span class="k">IF</span> <span class="n">bStateChanged</span> <span class="k">THEN</span>
	<span class="k">IF</span> <span class="n">bError</span> <span class="k">THEN</span>
		<span class="k">IF</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">ErrorState</span> <span class="o">=</span> <span class="n">DUT_ErrorState</span><span class="p">.</span><span class="n">Active</span> <span class="k">THEN</span>
			<span class="o">//</span><span class="n">Close</span> <span class="n">active</span> <span class="n">error</span>
			<span class="o">//</span><span class="n">Read</span> <span class="n">system</span> <span class="kt">time</span>
			<span class="n">ErrorData</span><span class="p">.</span><span class="n">nDateTimeOff</span> <span class="o">:=</span> <span class="n">Tc2_EtherCAT</span><span class="p">.</span><span class="n">F_GetActualDcTime64</span><span class="p">();</span>
			<span class="n">ErrorData</span><span class="p">.</span><span class="n">sDateTimeOff</span> <span class="o">:=</span> <span class="n">Tc2_EtherCat</span><span class="p">.</span><span class="n">DCTIME64_TO_STRING</span><span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">nDateTimeOff</span><span class="p">);</span>
			<span class="n">ErrorData</span><span class="p">.</span><span class="n">ErrorState</span> <span class="o">:=</span> <span class="n">DUT_ErrorState</span><span class="p">.</span><span class="n">Inactive</span><span class="p">;</span>
			<span class="o">//</span><span class="n">Write</span> <span class="n">Off</span><span class="o">-</span><span class="kt">time</span> <span class="k">to</span> <span class="n">Error</span> <span class="n">System</span>
			<span class="k">FOR</span> <span class="n">nErrSysCNT</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">TO</span> <span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">DO</span>
				<span class="k">IF</span> <span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nErrSysCNT</span><span class="p">].</span><span class="n">Error_ID</span> <span class="o">=</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">Error_ID</span> <span class="k">THEN</span>
					<span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nErrSysCNT</span><span class="p">].</span><span class="n">nDateTimeOff</span> <span class="o">:=</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">nDateTimeOff</span><span class="p">;</span>
					<span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nErrSysCNT</span><span class="p">].</span><span class="n">sDateTimeOff</span> <span class="o">:=</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">sDateTimeOff</span><span class="p">;</span>
					<span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nErrSysCNT</span><span class="p">].</span><span class="n">ErrorState</span> <span class="o">:=</span> <span class="n">DUT_ErrorState</span><span class="p">.</span><span class="n">Inactive</span><span class="p">;</span>
					<span class="k">EXIT</span><span class="p">;</span>
				<span class="n">END_IF</span>
			<span class="n">END_FOR</span>
				
			<span class="o">//</span><span class="n">Clear</span> <span class="n">ErrorData</span>
			<span class="n">MEMSET</span><span class="p">(</span><span class="n">ADR</span><span class="p">(</span><span class="n">ErrorData</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">ErrorData</span><span class="p">));</span>
		<span class="n">END_IF</span>
		
		<span class="o">//</span><span class="k">Open</span> <span class="n">a</span> <span class="k">new</span> <span class="n">error</span>
		<span class="n">ErrorData</span><span class="p">.</span><span class="n">ErrorState</span> <span class="o">:=</span> <span class="n">DUT_ErrorState</span><span class="p">.</span><span class="n">Active</span><span class="p">;</span>												<span class="o">//</span><span class="n">Set</span> <span class="n">Error</span> <span class="n">State</span>
		<span class="n">ErrorData</span><span class="p">.</span><span class="n">nDateTimeOn</span> <span class="o">:=</span> <span class="n">Tc2_EtherCAT</span><span class="p">.</span><span class="n">F_GetActualDcTime64</span><span class="p">();</span>								<span class="o">//</span><span class="n">Get</span> <span class="n">system</span> <span class="kt">time</span>
		<span class="n">ErrorData</span><span class="p">.</span><span class="n">sDateTimeOn</span> <span class="o">:=</span> <span class="n">Tc2_EtherCat</span><span class="p">.</span><span class="n">DCTIME64_TO_STRING</span><span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">nDateTimeOn</span><span class="p">);</span>			<span class="o">//</span><span class="n">Convert</span> <span class="k">to</span> <span class="kt">string</span>
		<span class="n">ErrorData</span><span class="p">.</span><span class="n">iTerminalID</span> <span class="o">:=</span> <span class="n">iTerminal_ID</span><span class="p">;</span>														<span class="o">//</span><span class="n">Terminal_ID</span>
		<span class="n">ErrorData</span><span class="p">.</span><span class="n">bWcState</span> <span class="o">:=</span> <span class="n">bWcState</span><span class="p">;</span>																<span class="o">//</span><span class="n">WcState</span> <span class="kt">bit</span>
		<span class="n">ErrorData</span><span class="p">.</span><span class="n">uiInfoDataState</span> <span class="o">:=</span> <span class="n">uiInfoData_State</span><span class="p">;</span>												<span class="o">//</span><span class="n">uiInfoData_State</span>
		
		<span class="o">//</span><span class="n">Error</span> <span class="n">message</span> <span class="n">according</span> <span class="k">to</span> <span class="n">uiInfoData_State</span> <span class="k">and</span> <span class="n">WcState</span>
		<span class="n">iStateError</span> <span class="o">:=</span> <span class="p">(</span><span class="n">uiInfoData_State</span> <span class="k">AND</span> <span class="mi">16#000F</span><span class="p">);</span>												<span class="o">//</span><span class="n">Mask</span> <span class="k">for</span> <span class="n">operation</span> <span class="n">state</span> 
		<span class="n">iOtherError</span> <span class="o">:=</span> <span class="p">(</span><span class="n">uiInfoData_State</span> <span class="k">AND</span> <span class="mi">16#00F0</span><span class="p">);</span>												<span class="o">//</span><span class="n">Mask</span> <span class="k">for</span> <span class="n">the</span> <span class="n">other</span> <span class="mi">3</span> <span class="n">kind</span> <span class="k">of</span> <span class="n">errors</span>
		<span class="o">//</span><span class="n">Error</span> <span class="n">messages</span> <span class="n">according</span> <span class="k">to</span> <span class="n">the</span> <span class="n">least</span> <span class="n">significant</span> <span class="n">digit</span>
		<span class="k">CASE</span> <span class="n">iStateError</span> <span class="k">OF</span>
			<span class="mi">16#0001</span> <span class="o">:</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="na">&#39;Slave</span> <span class="k">in</span> <span class="n">INIT</span> <span class="n">state</span><span class="p">;</span>   <span class="p">&#39;;</span>
			<span class="mi">16#0002</span> <span class="o">:</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="na">&#39;Slave</span> <span class="k">in</span> <span class="n">PREOP</span> <span class="n">state</span><span class="p">;</span>   <span class="p">&#39;;</span>
			<span class="mi">16#0003</span> <span class="o">:</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="na">&#39;Slave</span> <span class="k">in</span> <span class="n">BOOT</span> <span class="n">state</span><span class="p">;</span>   <span class="p">&#39;;</span>
			<span class="mi">16#0004</span> <span class="o">:</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="na">&#39;Slave</span> <span class="k">in</span> <span class="n">SAFEOP</span> <span class="n">state</span><span class="p">;</span>   <span class="p">&#39;;</span>
			<span class="mi">16#0008</span> <span class="o">:</span> <span class="p">;</span>																			<span class="o">//</span><span class="n">Normal</span> <span class="n">operation</span> <span class="n">state</span>
		<span class="k">ELSE</span>
			<span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="na">&#39;Undefined</span> <span class="n">State</span> <span class="k">of</span> <span class="n">operation</span><span class="p">;</span>   <span class="p">&#39;;</span>						<span class="o">//</span><span class="n">I</span> <span class="n">hope</span> <span class="n">we</span> <span class="n">will</span> <span class="n">never</span> <span class="n">see</span> <span class="n">this</span> <span class="n">message</span>
			<span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="n">CONCAT</span> <span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span><span class="p">,</span> <span class="n">UINT_TO_STRING</span><span class="p">(</span><span class="n">iStateError</span><span class="p">));</span>
			<span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="n">CONCAT</span> <span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span><span class="p">,</span> <span class="p">&#39;</span>   <span class="p">&#39;);</span>
		<span class="n">END_CASE</span>
		
		<span class="o">//</span><span class="n">Error</span> <span class="n">messages</span> <span class="n">according</span> <span class="k">to</span> <span class="n">the</span> <span class="n">second</span> <span class="n">least</span> <span class="n">significant</span> <span class="n">digit</span>
		<span class="k">CASE</span> <span class="n">iOtherError</span> <span class="k">OF</span>
			<span class="mi">16#0000</span> <span class="o">:</span> <span class="p">;</span>																			<span class="o">//</span><span class="n">No</span> <span class="n">error</span> <span class="k">case</span>
			<span class="mi">16#0010</span> <span class="o">:</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="n">CONCAT</span> <span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span><span class="p">,</span> <span class="na">&#39;Slave</span> <span class="n">signals</span> <span class="n">error</span><span class="p">;</span>   <span class="p">&#39;);</span>
			<span class="mi">16#0020</span> <span class="o">:</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="n">CONCAT</span> <span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span><span class="p">,</span> <span class="na">&#39;Invalid</span> <span class="n">vendorID</span><span class="o">/</span><span class="n">productCode</span> <span class="n">read</span><span class="p">;</span>   <span class="p">&#39;);</span>
			<span class="mi">16#0040</span> <span class="o">:</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="n">CONCAT</span> <span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span><span class="p">,</span> <span class="na">&#39;Initialisation</span> <span class="n">error</span> <span class="n">occured</span><span class="p">;</span>   <span class="p">&#39;);</span>
		<span class="k">ELSE</span>
			<span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="n">CONCAT</span> <span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span><span class="p">,</span> <span class="na">&#39;Undefined</span> <span class="n">Error</span> <span class="n">ID</span><span class="o">:</span> <span class="p">&#39;);</span>
			<span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="n">CONCAT</span> <span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span><span class="p">,</span> <span class="n">UINT_TO_STRING</span><span class="p">(</span><span class="n">iOtherError</span><span class="p">));</span>
			<span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="n">CONCAT</span> <span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span><span class="p">,</span> <span class="p">&#39;</span>   <span class="p">&#39;);</span>
		<span class="n">END_CASE</span>
	
		<span class="o">//</span><span class="n">Errormessage</span> <span class="n">according</span> <span class="k">to</span> <span class="n">WcState</span> <span class="kt">bit</span>
		<span class="k">IF</span> <span class="n">bWcState</span> <span class="k">THEN</span>
			<span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span> <span class="o">:=</span> <span class="n">CONCAT</span> <span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">sErrorMessage</span><span class="p">,</span> <span class="na">&#39;Invalid</span> <span class="n">Data</span><span class="p">;&#39;);</span>
		<span class="n">END_IF</span>
		
		<span class="o">//</span><span class="n">Check</span> <span class="k">for</span> <span class="n">overflow</span>
		<span class="k">IF</span> <span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">nNoErrors</span> <span class="o">=</span> <span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="k">THEN</span>
			<span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">nNoOverflows</span> <span class="o">:=</span> <span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">nNoOverflows</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">END_IF</span>
		
		<span class="o">//</span><span class="n">Write</span> <span class="n">Error</span> <span class="n">Data</span> <span class="n">into</span> <span class="n">Error</span> <span class="n">System</span>
		<span class="n">ErrorData</span><span class="p">.</span><span class="n">Error_ID</span> <span class="o">:=</span> <span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">lNextErrorID</span> <span class="p">;</span>
		<span class="n">MEMMOVE</span><span class="p">(</span> <span class="n">ADR</span><span class="p">(</span><span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">ADR</span><span class="p">(</span><span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">DUT_TerminalError</span><span class="p">));</span>
		<span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:=</span> <span class="n">ErrorData</span><span class="p">;</span>
		<span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">lNextErrorID</span> <span class="o">:=</span> <span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">lNextErrorID</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
		
	<span class="k">ELSE</span>
		<span class="o">//</span><span class="n">Close</span> <span class="n">Active</span> <span class="n">Error</span>
		<span class="o">//</span><span class="n">Read</span> <span class="n">system</span> <span class="kt">time</span>
		<span class="n">ErrorData</span><span class="p">.</span><span class="n">nDateTimeOff</span> <span class="o">:=</span> <span class="n">Tc2_EtherCAT</span><span class="p">.</span><span class="n">F_GetActualDcTime64</span><span class="p">();</span>
		<span class="n">ErrorData</span><span class="p">.</span><span class="n">sDateTimeOff</span> <span class="o">:=</span> <span class="n">Tc2_EtherCat</span><span class="p">.</span><span class="n">DCTIME64_TO_STRING</span><span class="p">(</span><span class="n">ErrorData</span><span class="p">.</span><span class="n">nDateTimeOff</span><span class="p">);</span>
		<span class="n">ErrorData</span><span class="p">.</span><span class="n">ErrorState</span> <span class="o">:=</span> <span class="n">DUT_ErrorState</span><span class="p">.</span><span class="n">Inactive</span><span class="p">;</span>
		
		<span class="o">//</span><span class="n">Write</span> <span class="n">Off</span> <span class="kt">time</span> <span class="k">to</span> <span class="n">Error</span> <span class="n">System</span>
		<span class="k">FOR</span> <span class="n">nErrSysCNT</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">TO</span> <span class="n">GVL_ErrorSystem</span><span class="p">.</span><span class="n">cSizeOfErrorData</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">DO</span>
			<span class="k">IF</span> <span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nErrSysCNT</span><span class="p">].</span><span class="n">Error_ID</span> <span class="o">=</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">Error_ID</span> <span class="k">THEN</span>
				<span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nErrSysCNT</span><span class="p">].</span><span class="n">nDateTimeOff</span> <span class="o">:=</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">nDateTimeOff</span><span class="p">;</span>
				<span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nErrSysCNT</span><span class="p">].</span><span class="n">sDateTimeOff</span> <span class="o">:=</span> <span class="n">ErrorData</span><span class="p">.</span><span class="n">sDateTimeOff</span><span class="p">;</span>
				<span class="n">pErrorSystem</span><span class="o">^</span><span class="p">.</span><span class="n">aErrorData</span><span class="p">[</span><span class="n">nErrSysCNT</span><span class="p">].</span><span class="n">ErrorState</span> <span class="o">:=</span> <span class="n">DUT_ErrorState</span><span class="p">.</span><span class="n">Inactive</span><span class="p">;</span>
				<span class="k">EXIT</span><span class="p">;</span>
			<span class="n">END_IF</span>
		<span class="n">END_FOR</span>
			
		<span class="o">//</span><span class="n">Clear</span> <span class="n">ErrorData</span>
		<span class="n">MEMSET</span><span class="p">(</span><span class="n">ADR</span><span class="p">(</span><span class="n">ErrorData</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">ErrorData</span><span class="p">));</span>
	<span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-writefloatparameter">
<h2>POU: FB_WriteFloatParameter<a class="headerlink" href="#pou-fb-writefloatparameter" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/ChangeConfig/FB_WriteFloatParameter.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>///#########################################################
///Function block to write parameter in Nc.
///
///	Library:		
///	Tc2_MC2.lib
/// Tc2_System.lib
///
///	Global Variables:
///	
///	Data types:
///	
///	External functions:
///
///	History:
///	2014-02-05	v1.00	NB	Release code.
///
///	Known bugs:
///
///
///
///###########################################################
FUNCTION_BLOCK FB_WriteFloatParameter
VAR_INPUT
	bExecute: BOOL;
	///16#4000=Axisdata, 16#5000=Encoderdata, 16#6000=Controldata, 16#7000=Drivedata
	nDeviceGroup: UDINT;
	nIndexOffset: UDINT;
	nData: LREAL;
END_VAR
VAR_OUTPUT
	bBusy: BOOL;
	bDone: BOOL;
	bError: BOOL;
	nErrorId: UDINT;
END_VAR
VAR_IN_OUT
	Axis: AXIS_REF;
END_VAR
VAR
	nState: UINT;
	fbADSWRITE: ADSWRITE;
END_VAR
(*Sequence to write parameter in Nc*)
CASE nState OF
0:  (*Start sequence. Wait until bExecute is TRUE*)
	IF bExecute THEN
		bBusy:=TRUE;
		bError:=FALSE;
		nErrorId:=0;
		nState:=10;
	END_IF

10: (*Write parameter in Nc*)
	fbADSWRITE(
		PORT:=500,
		IDXGRP:=nDeviceGroup+Axis.NcToPlc.AxisId,
		IDXOFFS:=nIndexOffset,
		LEN:=SIZEOF(nData),
		SRCADDR:=ADR(nData),
		WRITE:=TRUE);

	(*Wait until it&#39;s done or if an error occurs*)
	IF NOT fbADSWRITE.ERR THEN
		IF NOT fbADSWRITE.BUSY THEN
			fbADSWRITE(WRITE:=FALSE);
			nState:=20;
		END_IF
	ELSE
		nErrorId:=fbADSWRITE.ERRID;
		nState:=999;
	END_IF

20: (*Sequense is done. Waits until bExecute is FALSE*)
	bBusy:=FALSE;
	bDone:=TRUE;
	IF NOT bExecute THEN
		bDone:=FALSE;
		nState:=0;
	END_IF

999: (*Error in sequence*)
	bError:=TRUE;
	bBusy:=FALSE;
	bDone:=FALSE;
	fbADSWRITE(WRITE:=FALSE);
	IF NOT bExecute THEN
		nState:=0;
	END_IF

END_CASE

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-fb-writeparameterinnc-v1-00">
<h2>POU: FB_WriteParameterInNc_v1_00<a class="headerlink" href="#pou-fb-writeparameterinnc-v1-00" title="Permalink to this headline">¶</a></h2>
<p>File: Library/tc_mca_std_lib/POUs/ChangeConfig/FB_WriteParameterInNc_v1_00.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>///#########################################################
///Function block to write parameter in Nc.
///
///	Library:		
///	Tc2_MC2.lib
/// Tc2_System.lib
///
///	Global Variables:
///	
///	Data types:
///	
///	External functions:
///
///	History:
///	2014-02-05	v1.00	NB	Release code.
///
///	Known bugs:
///
///
///
///###########################################################
FUNCTION_BLOCK FB_WriteParameterInNc_v1_00
VAR_INPUT
	bExecute: BOOL;
	///16#4000=Axisdata, 16#5000=Encoderdata, 16#6000=Controldata, 16#7000=Drivedata
	nDeviceGroup: UDINT;
	nIndexOffset: UDINT;
	nData: DWORD;
END_VAR
VAR_OUTPUT
	bBusy: BOOL;
	bDone: BOOL;
	bError: BOOL;
	nErrorId: UDINT;
END_VAR
VAR_IN_OUT
	Axis: AXIS_REF;
END_VAR
VAR
	nState: UINT;
	fbADSWRITE: ADSWRITE;
END_VAR
(*Sequence to write parameter in Nc*)
CASE nState OF
0:  (*Start sequence. Wait until bExecute is TRUE*)
	IF bExecute THEN
		bBusy:=TRUE;
		bError:=FALSE;
		nErrorId:=0;
		nState:=10;
	END_IF

10: (*Write parameter in Nc*)
	fbADSWRITE(
		PORT:=500,
		IDXGRP:=nDeviceGroup+Axis.NcToPlc.AxisId,
		IDXOFFS:=nIndexOffset,
		LEN:=SIZEOF(nData),
		SRCADDR:=ADR(nData),
		WRITE:=TRUE);

	(*Wait until it&#39;s done or if an error occurs*)
	IF NOT fbADSWRITE.ERR THEN
		IF NOT fbADSWRITE.BUSY THEN
			fbADSWRITE(WRITE:=FALSE);
			nState:=20;
		END_IF
	ELSE
		nErrorId:=fbADSWRITE.ERRID;
		nState:=999;
	END_IF

20: (*Sequense is done. Waits until bExecute is FALSE*)
	bBusy:=FALSE;
	bDone:=TRUE;
	IF NOT bExecute THEN
		bDone:=FALSE;
		nState:=0;
	END_IF

999: (*Error in sequence*)
	bError:=TRUE;
	bBusy:=FALSE;
	bDone:=FALSE;
	fbADSWRITE(WRITE:=FALSE);
	IF NOT bExecute THEN
		nState:=0;
	END_IF

END_CASE

END_FUNCTION_BLOCK
</pre></div>
</div>
</div>
<div class="section" id="pou-f-atpositionstate">
<h2>POU: F_AtPositionState<a class="headerlink" href="#pou-f-atpositionstate" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/States/F_AtPositionState.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION</span> <span class="n">F_AtPositionState</span> <span class="o">:</span> <span class="n">BOOL</span>
    <span class="o">//</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">the</span> <span class="n">motor</span> <span class="k">is</span> <span class="n">within</span> <span class="n">the</span> <span class="n">state</span> <span class="n">bounds</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stMotionStage</span><span class="o">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stPositionState</span><span class="o">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">F_AtPositionState</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="o">//</span> <span class="n">We</span> <span class="n">can</span> <span class="n">never</span> <span class="n">be</span> <span class="n">at</span> <span class="n">invalid</span> <span class="n">states</span><span class="p">.</span> <span class="n">We</span> <span class="n">are</span> <span class="n">also</span> <span class="k">not</span> <span class="n">at</span> <span class="n">a</span> <span class="n">state</span> <span class="k">if</span> <span class="n">a</span> <span class="n">move</span> <span class="n">has</span> <span class="n">been</span> <span class="n">requested</span><span class="p">,</span> <span class="n">we</span> <span class="n">are</span> <span class="n">instead</span> <span class="n">transitioning</span><span class="p">.</span>
<span class="k">IF</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">bValid</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">bExecute</span> <span class="k">THEN</span>
    <span class="k">IF</span> <span class="n">stMotionStage</span><span class="p">.</span><span class="n">stAxisStatus</span><span class="p">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">fPosition</span> <span class="o">+</span> <span class="k">ABS</span><span class="p">(</span><span class="n">stPositionState</span><span class="p">.</span><span class="n">fDelta</span><span class="p">)</span> <span class="k">AND</span>
       <span class="n">stMotionStage</span><span class="p">.</span><span class="n">stAxisStatus</span><span class="p">.</span><span class="n">fActPosition</span> <span class="o">&gt;</span> <span class="n">stPositionState</span><span class="p">.</span><span class="n">fPosition</span> <span class="o">-</span> <span class="k">ABS</span><span class="p">(</span><span class="n">stPositionState</span><span class="p">.</span><span class="n">fDelta</span><span class="p">)</span> <span class="k">THEN</span>
       <span class="n">F_AtPositionState</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-f-motionerrorcodelookup">
<h2>POU: F_MotionErrorCodeLookup<a class="headerlink" href="#pou-f-motionerrorcodelookup" title="Permalink to this headline">¶</a></h2>
<p>File: Library/POUs/Motion/Utils/F_MotionErrorCodeLookup.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION</span> <span class="n">F_MotionErrorCodeLookup</span> <span class="o">:</span> <span class="kt">STRING</span>
<span class="n">VAR_INPUT</span>
    <span class="n">nErrorId</span><span class="o">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">msg</span><span class="o">:</span> <span class="kt">STRING</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="k">CASE</span> <span class="n">nErrorId</span> <span class="k">OF</span>
    <span class="o">//</span> <span class="n">Common</span> <span class="n">NC</span> <span class="n">errors</span>
    <span class="mi">16#4221</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Requested</span> <span class="n">set</span> <span class="n">velocity</span> <span class="k">is</span> <span class="k">not</span> <span class="n">allowed</span><span class="p">&#39;;</span>
    <span class="mi">16#4222</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Requested</span> <span class="n">set</span> <span class="n">position</span> <span class="k">is</span> <span class="k">not</span> <span class="n">allowed</span><span class="p">&#39;;</span>
    <span class="mi">16#4225</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Drive</span> <span class="k">not</span> <span class="n">ready</span> <span class="n">during</span> <span class="n">axis</span> <span class="n">start</span><span class="p">&#39;;</span>
    <span class="mi">16#4260</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Drive</span> <span class="n">disabled</span><span class="p">&#39;;</span>
    <span class="mi">16#4357</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Negative</span> <span class="n">limit</span> <span class="n">hit</span><span class="p">&#39;;</span>
    <span class="mi">16#4358</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Positive</span> <span class="n">limit</span> <span class="n">hit</span><span class="p">&#39;;</span>
    <span class="mi">16#4550</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Stall</span><span class="o">:</span> <span class="n">position</span> <span class="n">lag</span> <span class="n">monitoring</span> <span class="n">error</span><span class="p">&#39;;</span>

    <span class="o">//</span> <span class="n">Custom</span> <span class="n">error</span> <span class="n">definitions</span>
    <span class="mi">16#7900</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Aborted</span> <span class="n">move</span> <span class="n">request</span> <span class="k">with</span> <span class="n">active</span> <span class="n">move</span> <span class="k">in</span> <span class="n">progress</span><span class="p">&#39;;</span>
    <span class="mi">16#7901</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Position</span> <span class="n">state</span> <span class="n">unsafe</span><span class="p">&#39;;</span>
    <span class="mi">16#7902</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Position</span> <span class="n">state</span> <span class="n">invalid</span><span class="p">&#39;;</span>

    <span class="o">//</span> <span class="n">Fallbacks</span>
    <span class="mi">0</span><span class="o">:</span> <span class="n">msg</span><span class="o">:=</span><span class="p">&#39;&#39;;</span>
    <span class="k">ELSE</span>
        <span class="n">msg</span><span class="o">:=</span><span class="na">&#39;Contact</span> <span class="n">PCDS</span> <span class="k">to</span> <span class="n">add</span> <span class="k">new</span> <span class="n">message</span><span class="p">&#39;;</span>
<span class="n">END_CASE</span>
<span class="n">F_MotionErrorCodeLookup</span> <span class="o">:=</span> <span class="n">msg</span><span class="p">;</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
</div>
<div class="section" id="pou-interactive">
<h2>POU: Interactive<a class="headerlink" href="#pou-interactive" title="Permalink to this headline">¶</a></h2>
<p>File: Library/UnitTests/Interactive.TcPOU</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>PROGRAM Interactive
VAR
    bInit: BOOL := FALSE;

    M1: DUT_MotionStage;
    fbMotionStageSim: FB_MotionStageSim;
    nCounter: UINT;

    stOut: DUT_PositionState;
    fbGoOut: FB_PositionStateMove;
    bOut: BOOL;
    bGoOut: BOOL;
    stIn: DUT_PositionState;
    fbGoIn: FB_PositionStateMove;
    bIn: BOOL;
    bGoIn: BOOL;
    stUnsafe: DUT_PositionState;
    fbGoBad: FB_PositionStateMove;
    bHCF: BOOL;
    bGoHCF: BOOL;

    {attribute &#39;pytmc&#39; := &#39;
        pv: TST:STATE
        io: io
    &#39;}
    fbEpicsInOut: FB_EpicsInOut;

    fbStateManager: FB_PositionStateManager;
    setState: INT;
    arrStates: ARRAY [1..15] OF DUT_PositionState;
END_VAR
BasicTests();

fbMotionStageSim(stMotionStage:=M1);
nCounter := nCounter + 1;

IF NOT bInit THEN
    bInit := TRUE;

    stOut.sName := &#39;Out&#39;;
    stOut.fPosition := 100;
    stOut.fDelta := 20;
    stOut.fVelocity := 10;
    stOut.bValid := TRUE;
    stOut.bMoveOk := TRUE;

    stIn.sName := &#39;In&#39;;
    stIn.fPosition := 0;
    stIn.fDelta := 0.1;
    stIn.fVelocity := 5;
    stIn.bValid := TRUE;
    stIn.bMoveOk := TRUE;

    stUnsafe.sName := &#39;HCF&#39;;
    stUnsafe.fPosition := -999;
    stUnsafe.fDelta := 6;
    stUnsafe.fVelocity := 42;
    stUnsafe.bValid := TRUE;
    stUnsafe.bMoveOk := FALSE;

    fbEpicsInOut.bEnable := TRUE;
    fbStateManager.bEnable := TRUE;
END_IF

fbGoOut(
    bExecute:=bGoOut,
    stMotionStage:=M1,
    stPositionState:=stOut,
    bAtState=&gt;bOut);
fbGoIn(
    bExecute:=bGoIn,
    stMotionStage:=M1,
    stPositionState:=stIn,
    bAtState=&gt;bIn);
fbGoBad(
    bExecute:=bGoHCF,
    stMotionStage:=M1,
    stPositionState:=stUnsafe,
    bAtState=&gt;bHCF);

arrStates[1] := stOut;
arrStates[2] := stIn;
arrStates[3] := stUnsafe;

fbEpicsInOut(
    stMotionStage := M1,
    stOut := stOut,
    stIn := stIn);

fbStateManager(
    stMotionStage := M1,
    arrStates := arrStates,
    setState := setState);

END_PROGRAM
</pre></div>
</div>
</div>
<div class="section" id="symbols">
<h2>Symbols<a class="headerlink" href="#symbols" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BasicTests</span><span class="o">.</span><span class="n">Motor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="p">(</span><span class="mi">4546112</span> <span class="mi">11264</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">Motor</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span> <span class="p">:</span> <span class="n">NCTOPLC_AXIS_REF</span> <span class="p">(</span><span class="mi">4547200</span> <span class="mi">2048</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">Motor</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">PlcToNc</span> <span class="p">:</span> <span class="n">PLCTONC_AXIS_REF</span> <span class="p">(</span><span class="mi">4546176</span> <span class="mi">1024</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">Motor</span><span class="o">.</span><span class="n">bBrakeRelease</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4555160</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">Motor</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4555168</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">Motor</span><span class="o">.</span><span class="n">bHome</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4555152</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">Motor</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4555144</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">Motor</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4555136</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">bError</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4323376</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">errState</span> <span class="p">:</span> <span class="n">Tc2_MC2</span><span class="o">.</span><span class="n">MC_AxisStates</span> <span class="p">(</span><span class="mi">4711680</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">fbMotion</span> <span class="p">:</span> <span class="n">FB_MotionStageSim</span> <span class="p">(</span><span class="mi">4557376</span> <span class="mi">152704</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">fbMotion</span><span class="o">.</span><span class="n">fbMotionStage</span><span class="o">.</span><span class="n">fbDriveVirtual</span><span class="o">.</span><span class="n">MasterAxis</span><span class="o">.</span><span class="n">NcToPlc</span> <span class="p">:</span> <span class="n">NCTOPLC_AXIS_REF</span> <span class="p">(</span><span class="mi">4559936</span> <span class="mi">2048</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">fbMotion</span><span class="o">.</span><span class="n">fbMotionStage</span><span class="o">.</span><span class="n">fbDriveVirtual</span><span class="o">.</span><span class="n">MasterAxis</span><span class="o">.</span><span class="n">PlcToNc</span> <span class="p">:</span> <span class="n">PLCTONC_AXIS_REF</span> <span class="p">(</span><span class="mi">4558912</span> <span class="mi">1024</span><span class="p">)</span>
<span class="n">BasicTests</span><span class="o">.</span><span class="n">fbRequest</span> <span class="p">:</span> <span class="n">FB_MotionRequest</span> <span class="p">(</span><span class="mi">4710080</span> <span class="mi">1600</span><span class="p">)</span>
<span class="n">Constants</span><span class="o">.</span><span class="n">CompilerVersion</span> <span class="p">:</span> <span class="n">VERSION</span> <span class="p">(</span><span class="mi">4714576</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Constants</span><span class="o">.</span><span class="n">CompilerVersionNumeric</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4714720</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Constants</span><span class="o">.</span><span class="n">RuntimeVersion</span> <span class="p">:</span> <span class="n">VERSION</span> <span class="p">(</span><span class="mi">4714512</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Constants</span><span class="o">.</span><span class="n">RuntimeVersionNumeric</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4714688</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Constants</span><span class="o">.</span><span class="n">bFPUSupport</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4714672</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Constants</span><span class="o">.</span><span class="n">bLittleEndian</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4714496</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Constants</span><span class="o">.</span><span class="n">bSimulationMode</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4714504</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Constants</span><span class="o">.</span><span class="n">nPackMode</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4714656</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Constants</span><span class="o">.</span><span class="n">nRegisterSize</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4714640</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">GVL</span><span class="o">.</span><span class="n">nHomingError</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4714464</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">GVL_ErrorSystem</span><span class="o">.</span><span class="n">cSizeOfErrorData</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4711696</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_DEVICE_DATA</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097664</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_IOIMAGE_CLEARI</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097568</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_IOIMAGE_CLEARO</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097600</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_IOIMAGE_RISIZE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097440</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_IOIMAGE_ROSIZE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097536</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_IOIMAGE_RWIB</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097376</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_IOIMAGE_RWIOB</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097632</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_IOIMAGE_RWIX</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097408</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_IOIMAGE_RWOB</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097472</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_IOIMAGE_RWOX</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097504</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYMNAME</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4096960</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYMNOTE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097344</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYMTAB</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4096928</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYMVAL</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4096992</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYM_DOWNLOAD</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097248</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYM_HNDBYNAME</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097024</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYM_INFOBYNAME</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097152</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYM_INFOBYNAMEEX</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097216</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYM_RELEASEHND</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097120</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYM_UPLOAD</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097280</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYM_UPLOADINFO</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097312</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYM_VALBYHND</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097088</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYM_VALBYNAME</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097056</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIGRP_SYM_VERSION</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097184</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIOFFS_DEVDATA_ADSSTATE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097696</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSIOFFS_DEVDATA_DEVSTATE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097728</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSLOG_MSGTYPE_ERROR</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4098784</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSLOG_MSGTYPE_HINT</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4098720</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSLOG_MSGTYPE_LOG</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4098816</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSLOG_MSGTYPE_MSGBOX</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4098848</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSLOG_MSGTYPE_RESOURCE</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4098880</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSLOG_MSGTYPE_STRING</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4098912</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSLOG_MSGTYPE_WARN</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4098752</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_CONFIG</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096832</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_ERROR</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096768</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_EXCEPTION</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096896</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_IDLE</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096608</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_INCOMPATIBLE</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096880</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_INIT</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096640</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_INVALID</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096592</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_LOADCFG</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096720</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_MAXSTATES</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096912</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_POWERFAILURE</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096736</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_POWERGOOD</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096752</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_RECONFIG</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096848</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_RESET</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096624</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_RESUME</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096816</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_RUN</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096672</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_SAVECFG</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096704</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_SHUTDOWN</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096784</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_START</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096656</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_STOP</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096688</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_STOPPING</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096864</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ADSSTATE_SUSPEND</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096800</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSLOGGER_IGR_GENERAL</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4164512</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSLOGGER_IOF_MODE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4164544</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_AMSLOGGER</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4163248</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_EVENTLOG</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096304</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_LOGGER</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096288</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_CAM</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096528</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_CAMTOOL</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096544</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_CNC</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096416</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_IO</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096336</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_ISG</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096400</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_LINE</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096432</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_NC</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096352</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_NCSAF</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096368</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_NCSVB</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096384</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_PLC</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096448</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_PLC_RTS1</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096464</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_PLC_RTS2</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096480</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_PLC_RTS3</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096496</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_PLC_RTS4</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096512</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R0_RTIME</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096320</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R3_SCOPESERVER</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096576</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">AMSPORT_R3_SYSSERV</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4096560</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">BOOTDATAFLAGS_PERSISTENT_INVALID</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4098976</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">BOOTDATAFLAGS_PERSISTENT_LOADED</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4098968</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">BOOTDATAFLAGS_RETAIN_INVALID</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4098952</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">BOOTDATAFLAGS_RETAIN_LOADED</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4098944</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">BOOTDATAFLAGS_RETAIN_REQUESTED</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4098960</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DATE_AND_TIME_SECPERDAY</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4177472</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DATE_AND_TIME_SECPERWEEK</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4177504</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DBG_OUTPUT_FILE</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4183776</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DBG_OUTPUT_LOG</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4183744</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DBG_OUTPUT_NONE</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4183712</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DBG_OUTPUT_VISU</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4183808</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DEFAULT_ADS_TIMEOUT</span> <span class="p">:</span> <span class="n">TIME</span> <span class="p">(</span><span class="mi">4099712</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DEFAULT_BACKLASHVALUE</span> <span class="p">:</span> <span class="n">LREAL</span> <span class="p">(</span><span class="mi">4310848</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DEFAULT_CSV_FIELD_DOUBLE_QUOTE</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4300976</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DEFAULT_CSV_FIELD_SEP</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4101240</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DEFAULT_CSV_RECORD_SEP_CR</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4300984</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DEFAULT_CSV_RECORD_SEP_LF</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4300992</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">DEFAULT_HOME_POSITION</span> <span class="p">:</span> <span class="n">LREAL</span> <span class="p">(</span><span class="mi">4310784</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">EMPTY_ARG_VALUE</span> <span class="p">:</span> <span class="n">Tc2_Utilities</span><span class="o">.</span><span class="n">T_Arg</span> <span class="p">(</span><span class="mi">4165120</span> <span class="mi">96</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">EMPTY_GUID_REGSTRING</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">(</span><span class="mi">38</span><span class="p">)</span> <span class="p">(</span><span class="mi">4303176</span> <span class="mi">312</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">EMPTY_GUID_STRING</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span> <span class="p">(</span><span class="mi">4302880</span> <span class="mi">296</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">EMPTY_GUID_STRUCT</span> <span class="p">:</span> <span class="n">GUID</span> <span class="p">(</span><span class="mi">4302752</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">EMPTY_ROUTE_ENTRY</span> <span class="p">:</span> <span class="n">Tc2_Utilities</span><span class="o">.</span><span class="n">ST_AmsRouteEntry</span> <span class="p">(</span><span class="mi">4163264</span> <span class="mi">1184</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FLOATREC_EXP_IS_INF</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4164608</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FLOATREC_EXP_IS_NAN</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4164592</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FLOATREC_MAX_DIGITS</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4164624</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FLOATREC_MAX_PRECISION</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4164640</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FLOATREC_MIN_PRECISION</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4164656</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_ARGTYPEINVALID</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164960</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_ASTERISKPOSITION</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164736</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_DESTBUFFOVERFLOW</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4165056</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_FLAGPOSITION</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164832</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_INSUFFICIENTARGS</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4165024</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_INVALIDPOINTERINPUT</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4165088</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_NOERROR</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164672</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_PERCENTSIGNPOSITION</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164704</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_PRECISIONDOTPOSITION</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164896</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_PRECISIONVALUE</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164800</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_TYPEFIELDVALUE</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164928</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_UNACCEPTEDPARAMETER</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164992</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_WIDTHPRECISIONVALPOS</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164864</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FMTERR_WIDTHVALUE</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4164768</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FOPEN_MODEAPPEND</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4099072</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FOPEN_MODEBINARY</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4099136</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FOPEN_MODEPLUS</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4099104</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FOPEN_MODEREAD</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4099008</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FOPEN_MODETEXT</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4099168</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FOPEN_MODEWRITE</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4099040</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FORMAT_DECASC_CODES</span> <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">0.</span><span class="o">.</span><span class="mi">9</span><span class="p">]</span> <span class="n">OF</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4165472</span> <span class="mi">80</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FORMAT_HEXASC_CODES</span> <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">0.</span><span class="o">.</span><span class="mi">1</span><span class="p">]</span> <span class="n">OF</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4165216</span> <span class="mi">256</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">FORMAT_MAX_ARGS</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4164576</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">GLOBAL_DCF77_PULSE_SPLIT</span> <span class="p">:</span> <span class="n">TIME</span> <span class="p">(</span><span class="mi">4101248</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">GLOBAL_DCF77_SEQUENCE_CHECK</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4101232</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">GLOBAL_FORMAT_HASH_PREFIX_TYPE</span> <span class="p">:</span> <span class="n">Tc2_Utilities</span><span class="o">.</span><span class="n">E_HashPrefixTypes</span> <span class="p">(</span><span class="mi">4101200</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">GLOBAL_SBCS_TABLE</span> <span class="p">:</span> <span class="n">Tc2_Utilities</span><span class="o">.</span><span class="n">E_SBCSType</span> <span class="p">(</span><span class="mi">4101216</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">HKEY_MAX_BINARY_DATA_SIZE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4164480</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">IPHELPERAPI_ADAPTERSINFO</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4162912</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">IPHELPERAPI_IPADDRBYHOSTNAME</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4162944</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MAX_ADAPTER_ADDRESS_LENGTH</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4162816</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MAX_ADAPTER_DESCRIPTION_LENGTH</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4162784</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MAX_ADAPTER_NAME_LENGTH</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4162752</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MAX_AVERAGE_MEASURES</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4101184</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MAX_LOCAL_ADAPTERS</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4162976</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MAX_REMOTE_PCS</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4163104</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MAX_ROUTE_ADDR_LEN</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4163128</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MAX_ROUTE_NAME_LEN</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4163120</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MAX_ROUTE_TRANSPORT</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4163240</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MAX_STRING_LENGTH</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4099744</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">MIN_ROUTE_TRANSPORT</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4163232</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">PI</span> <span class="p">:</span> <span class="n">LREAL</span> <span class="p">(</span><span class="mi">4099648</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ROUTE_FLAG_DYNAMIC</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4163168</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ROUTE_FLAG_NOOVERRIDE</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4163200</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">ROUTE_FLAG_TEMPORARY</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4163136</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_ADDREMOTE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4163008</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_CHANGENETID</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098528</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_CLOSEHANDLE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097888</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_CREATEFILE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097856</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_DELREMOTE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4163040</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_ENUMREMOTE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4163072</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FCLOSE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097952</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FDELETE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098272</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FEOF</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098240</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FFILEFIND</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4164448</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FGETS</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098112</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FOPEN</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097920</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FPRINTF</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098208</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FPUTS</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098144</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FREAD</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097984</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FRENAME</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098304</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FSCANF</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098176</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FSEEK</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098048</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FTELL</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098080</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_FWRITE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098016</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_IPHELPERAPI</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4162848</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_IPHOSTNAME</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4162880</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_MKDIR</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098336</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_OPENCREATE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097760</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_OPENREAD</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097792</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_OPENWRITE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4097824</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_REG_HKEYLOCALMACHINE</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098400</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_RMDIR</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098368</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_SENDEMAIL</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098432</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_STARTPROCESS</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098496</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSERVICE_TIMESERVICES</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098464</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSTATEFLAGS_BSOD</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4098984</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMSTATEFLAGS_RTVIOLATION</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4098992</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_DATEDELTA_OFFSET</span> <span class="p">:</span> <span class="n">DWORD</span> <span class="p">(</span><span class="mi">4171808</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_DATE_AND_TIME_MAX</span> <span class="p">:</span> <span class="n">Tc2_Utilities</span><span class="o">.</span><span class="n">T_ULARGE_INTEGER</span> <span class="p">(</span><span class="mi">4172096</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_DATE_AND_TIME_MAX64</span> <span class="p">:</span> <span class="n">ULINT</span> <span class="p">(</span><span class="mi">4172416</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_DATE_AND_TIME_MIN</span> <span class="p">:</span> <span class="n">Tc2_Utilities</span><span class="o">.</span><span class="n">T_ULARGE_INTEGER</span> <span class="p">(</span><span class="mi">4172032</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_DATE_AND_TIME_MIN64</span> <span class="p">:</span> <span class="n">ULINT</span> <span class="p">(</span><span class="mi">4172352</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_MAX_MONTHDAYS</span> <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">0.</span><span class="o">.</span><span class="mi">1</span><span class="p">]</span> <span class="n">OF</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4170960</span> <span class="mi">384</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_MAX_YEARSDAY</span> <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">0.</span><span class="o">.</span><span class="mi">1</span><span class="p">]</span> <span class="n">OF</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4171344</span> <span class="mi">448</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_TICKSPERDAY</span> <span class="p">:</span> <span class="n">Tc2_Utilities</span><span class="o">.</span><span class="n">T_ULARGE_INTEGER</span> <span class="p">(</span><span class="mi">4171968</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_TICKSPERDAY64</span> <span class="p">:</span> <span class="n">ULINT</span> <span class="p">(</span><span class="mi">4172288</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_TICKSPERMSEC</span> <span class="p">:</span> <span class="n">Tc2_Utilities</span><span class="o">.</span><span class="n">T_ULARGE_INTEGER</span> <span class="p">(</span><span class="mi">4171840</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_TICKSPERMSEC64</span> <span class="p">:</span> <span class="n">ULINT</span> <span class="p">(</span><span class="mi">4172160</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_TICKSPERSEC</span> <span class="p">:</span> <span class="n">Tc2_Utilities</span><span class="o">.</span><span class="n">T_ULARGE_INTEGER</span> <span class="p">(</span><span class="mi">4171904</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">SYSTEMTIME_TICKSPERSEC64</span> <span class="p">:</span> <span class="n">ULINT</span> <span class="p">(</span><span class="mi">4172224</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTFLAG_AUTOFMTALL</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099504</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTFLAG_FMTSELF</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099440</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTFLAG_LOG</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099456</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTFLAG_MSGBOX</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099472</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTFLAG_PRIOCLASS</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099424</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTFLAG_SRCID</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099488</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTSTATE_CONFIRMED</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099568</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTSTATE_INVALID</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099520</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTSTATE_RESET</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099552</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTSTATE_RESETCON</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099584</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENTSTATE_SIGNALED</span> <span class="p">:</span> <span class="n">WORD</span> <span class="p">(</span><span class="mi">4099536</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENT_FMTPRGSIZE</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4099616</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TCEVENT_SRCNAMESIZE</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4099600</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TIMESERVICE_ADJUSTTIMETORTC</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098656</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TIMESERVICE_DATEANDTIME</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098560</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TIMESERVICE_RTCTIMEDIFF</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098624</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TIMESERVICE_SYSTEMTIMES</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098592</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TIMESERVICE_TIMEZONINFORMATION</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="p">(</span><span class="mi">4098688</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">TcMcGlobal</span> <span class="p">:</span> <span class="n">Tc2_MC2</span><span class="o">.</span><span class="n">_TCMCGLOBAL</span> <span class="p">(</span><span class="mi">4303776</span> <span class="mi">6976</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">WEST_EUROPE_TZI</span> <span class="p">:</span> <span class="n">Tc2_Utilities</span><span class="o">.</span><span class="n">ST_TimeZoneInformation</span> <span class="p">(</span><span class="mi">4172480</span> <span class="mi">864</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">eWatchdogConfig</span> <span class="p">:</span> <span class="n">Tc2_System</span><span class="o">.</span><span class="n">E_WATCHDOG_TIME_CONFIG</span> <span class="p">(</span><span class="mi">4099632</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Global_Variables</span><span class="o">.</span><span class="n">nWatchdogTime</span> <span class="p">:</span> <span class="n">BYTE</span> <span class="p">(</span><span class="mi">4099000</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Global_Version</span><span class="o">.</span><span class="n">stLibVersion_Tc2_MC2</span> <span class="p">:</span> <span class="n">ST_LibVersion</span> <span class="p">(</span><span class="mi">4303488</span> <span class="mi">288</span><span class="p">)</span>
<span class="n">Global_Version</span><span class="o">.</span><span class="n">stLibVersion_Tc2_Math</span> <span class="p">:</span> <span class="n">ST_LibVersion</span> <span class="p">(</span><span class="mi">4310912</span> <span class="mi">288</span><span class="p">)</span>
<span class="n">Global_Version</span><span class="o">.</span><span class="n">stLibVersion_Tc2_System</span> <span class="p">:</span> <span class="n">ST_LibVersion</span> <span class="p">(</span><span class="mi">4096000</span> <span class="mi">288</span><span class="p">)</span>
<span class="n">Global_Version</span><span class="o">.</span><span class="n">stLibVersion_Tc2_Utilities</span> <span class="p">:</span> <span class="n">ST_LibVersion</span> <span class="p">(</span><span class="mi">4100896</span> <span class="mi">288</span><span class="p">)</span>
<span class="n">Global_Version</span><span class="o">.</span><span class="n">stLibVersion_Tc3_Module</span> <span class="p">:</span> <span class="n">ST_LibVersion</span> <span class="p">(</span><span class="mi">4100288</span> <span class="mi">288</span><span class="p">)</span>
<span class="n">Global_Version</span><span class="o">.</span><span class="n">stLibVersion_lcls_twincat_motion</span> <span class="p">:</span> <span class="n">ST_LibVersion</span> <span class="p">(</span><span class="mi">4714176</span> <span class="mi">288</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">M1</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="p">(</span><span class="mi">4323392</span> <span class="mi">11264</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span> <span class="p">:</span> <span class="n">NCTOPLC_AXIS_REF</span> <span class="p">(</span><span class="mi">4324480</span> <span class="mi">2048</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">PlcToNc</span> <span class="p">:</span> <span class="n">PLCTONC_AXIS_REF</span> <span class="p">(</span><span class="mi">4323456</span> <span class="mi">1024</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bBrakeRelease</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4332440</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4332448</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bHome</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4332432</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4332424</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4332416</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">arrStates</span> <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="mi">15</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span> <span class="p">(</span><span class="mi">4529792</span> <span class="mi">16320</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">bGoHCF</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4310776</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">bGoIn</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4310760</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">bGoOut</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4302744</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">bHCF</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4310768</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">bIn</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4310752</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4301032</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">bOut</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="p">(</span><span class="mi">4302736</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">fbEpicsInOut</span> <span class="p">:</span> <span class="n">FB_EpicsInOut</span> <span class="p">(</span><span class="mi">4498304</span> <span class="mi">25600</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">fbGoBad</span> <span class="p">:</span> <span class="n">FB_PositionStateMove</span> <span class="p">(</span><span class="mi">4495744</span> <span class="mi">2560</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">fbGoIn</span> <span class="p">:</span> <span class="n">FB_PositionStateMove</span> <span class="p">(</span><span class="mi">4492096</span> <span class="mi">2560</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">fbGoOut</span> <span class="p">:</span> <span class="n">FB_PositionStateMove</span> <span class="p">(</span><span class="mi">4488448</span> <span class="mi">2560</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">fbMotionStageSim</span> <span class="p">:</span> <span class="n">FB_MotionStageSim</span> <span class="p">(</span><span class="mi">4334656</span> <span class="mi">152704</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">fbMotionStageSim</span><span class="o">.</span><span class="n">fbMotionStage</span><span class="o">.</span><span class="n">fbDriveVirtual</span><span class="o">.</span><span class="n">MasterAxis</span><span class="o">.</span><span class="n">NcToPlc</span> <span class="p">:</span> <span class="n">NCTOPLC_AXIS_REF</span> <span class="p">(</span><span class="mi">4337216</span> <span class="mi">2048</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">fbMotionStageSim</span><span class="o">.</span><span class="n">fbMotionStage</span><span class="o">.</span><span class="n">fbDriveVirtual</span><span class="o">.</span><span class="n">MasterAxis</span><span class="o">.</span><span class="n">PlcToNc</span> <span class="p">:</span> <span class="n">PLCTONC_AXIS_REF</span> <span class="p">(</span><span class="mi">4336192</span> <span class="mi">1024</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">fbStateManager</span> <span class="p">:</span> <span class="n">FB_PositionStateManager</span> <span class="p">(</span><span class="mi">4523904</span> <span class="mi">5888</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">nCounter</span> <span class="p">:</span> <span class="n">UINT</span> <span class="p">(</span><span class="mi">4301040</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">setState</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">(</span><span class="mi">4323360</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">stIn</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="p">(</span><span class="mi">4491008</span> <span class="mi">1088</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">stOut</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="p">(</span><span class="mi">4487360</span> <span class="mi">1088</span><span class="p">)</span>
<span class="n">Interactive</span><span class="o">.</span><span class="n">stUnsafe</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="p">(</span><span class="mi">4494656</span> <span class="mi">1088</span><span class="p">)</span>
<span class="n">TwinCAT_SystemInfoVarList</span><span class="o">.</span><span class="n">_AppInfo</span> <span class="p">:</span> <span class="n">PlcAppSystemInfo</span> <span class="p">(</span><span class="mi">4714752</span> <span class="mi">2048</span><span class="p">)</span>
<span class="n">TwinCAT_SystemInfoVarList</span><span class="o">.</span><span class="n">_TaskInfo</span> <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="mi">1</span><span class="p">]</span> <span class="n">OF</span> <span class="n">PlcTaskSystemInfo</span> <span class="p">(</span><span class="mi">4716800</span> <span class="mi">1024</span><span class="p">)</span>
<span class="n">TwinCAT_SystemInfoVarList</span><span class="o">.</span><span class="n">_TaskOid_PlcTask</span> <span class="p">:</span> <span class="n">OTCID</span> <span class="p">(</span><span class="mi">4717856</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">TwinCAT_SystemInfoVarList</span><span class="o">.</span><span class="n">_TaskPouOid_PlcTask</span> <span class="p">:</span> <span class="n">OTCID</span> <span class="p">(</span><span class="mi">4717824</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">TwinCAT_SystemInfoVarList</span><span class="o">.</span><span class="n">__PlcTask</span> <span class="p">:</span> <span class="n">_Implicit_Task_Info</span> <span class="p">(</span><span class="mi">4717888</span> <span class="mi">704</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="boxes">
<h2>Boxes<a class="headerlink" href="#boxes" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="nc-axes">
<h2>NC axes<a class="headerlink" href="#nc-axes" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">4.</span><span class="p">)</span> <span class="s1">&#39;Library 1&#39;</span><span class="p">:</span>
    <span class="n">Id</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">CreateSymbols</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
    <span class="n">AxisType</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">AxisFolder</span> <span class="o">=</span> <span class="s1">&#39;Library Axes&#39;</span>
    <span class="n">OtherSettings</span><span class="p">:</span><span class="n">AllowMotionCmdToSlave</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
    <span class="n">Enc</span><span class="p">:</span><span class="n">EncType</span> <span class="o">=</span> <span class="mi">1</span>

<span class="mf">5.</span><span class="p">)</span> <span class="s1">&#39;Library 2&#39;</span><span class="p">:</span>
    <span class="n">Id</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">CreateSymbols</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
    <span class="n">AxisType</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">AxisFolder</span> <span class="o">=</span> <span class="s1">&#39;Library Axes&#39;</span>
    <span class="n">OtherSettings</span><span class="p">:</span><span class="n">AllowMotionCmdToSlave</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
    <span class="n">Enc</span><span class="p">:</span><span class="n">EncType</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="links">
<h2>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="p">)</span> <span class="n">A</span> <span class="p">(</span><span class="s1">&#39;Library Instance&#39;</span><span class="p">,</span> <span class="s1">&#39;PlcTask Inputs^Interactive.M1.Axis.NcToPlc&#39;</span><span class="p">)</span>
      <span class="n">B</span> <span class="p">(</span><span class="s1">&#39;TINC^NC-Task 1 SAF^Axes^Library 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Outputs^ToPlc&#39;</span><span class="p">)</span>
<span class="mf">2.</span><span class="p">)</span> <span class="n">A</span> <span class="p">(</span><span class="s1">&#39;Library Instance&#39;</span><span class="p">,</span> <span class="s1">&#39;PlcTask Outputs^Interactive.M1.Axis.PlcToNc&#39;</span><span class="p">)</span>
      <span class="n">B</span> <span class="p">(</span><span class="s1">&#39;TINC^NC-Task 1 SAF^Axes^Library 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Inputs^FromPlc&#39;</span><span class="p">)</span>
<span class="mf">3.</span><span class="p">)</span> <span class="n">A</span> <span class="p">(</span><span class="s1">&#39;Library Instance&#39;</span><span class="p">,</span> <span class="s1">&#39;PlcTask Inputs^BasicTests.Motor.Axis.NcToPlc&#39;</span><span class="p">)</span>
      <span class="n">B</span> <span class="p">(</span><span class="s1">&#39;TINC^NC-Task 1 SAF^Axes^Library 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Outputs^ToPlc&#39;</span><span class="p">)</span>
<span class="mf">4.</span><span class="p">)</span> <span class="n">A</span> <span class="p">(</span><span class="s1">&#39;Library Instance&#39;</span><span class="p">,</span> <span class="s1">&#39;PlcTask Outputs^BasicTests.Motor.Axis.PlcToNc&#39;</span><span class="p">)</span>
      <span class="n">B</span> <span class="p">(</span><span class="s1">&#39;TINC^NC-Task 1 SAF^Axes^Library 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Inputs^FromPlc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="pragma-lint-results">
<h2>Pragma lint results<a class="headerlink" href="#pragma-lint-results" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span><span class="p">:</span><span class="n">pytmc</span><span class="o">.</span><span class="n">bin</span><span class="o">.</span><span class="n">pragmalint</span><span class="p">:</span><span class="n">Total</span> <span class="n">pragmas</span> <span class="n">found</span><span class="p">:</span> <span class="mi">108</span> <span class="n">Total</span> <span class="n">linter</span> <span class="n">errors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">PLC</span> <span class="n">Project</span> <span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Library</span>
<span class="o">========================</span>


<span class="n">DUTs</span><span class="o">/</span><span class="n">DUT_MotionStage</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">----------------------------------------</span>

    <span class="o">-</span> <span class="n">DUT_MotionStage</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">32</span> <span class="n">pragmas</span>


<span class="n">DUTs</span><span class="o">/</span><span class="n">DUT_PositionState</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">------------------------------------------</span>

    <span class="o">-</span> <span class="n">DUT_PositionState</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">9</span> <span class="n">pragmas</span>


<span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">------------------------------------------</span>

    <span class="o">-</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">2</span> <span class="n">pragmas</span>


<span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_EpicsInOut</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">----------------------------------------</span>

    <span class="o">-</span> <span class="n">ENUM_EpicsInOut</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">pragmas</span>


<span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_EpicsMotorCmd</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">-------------------------------------------</span>

    <span class="o">-</span> <span class="n">ENUM_EpicsMotorCmd</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">2</span> <span class="n">pragmas</span>


<span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_MotionRequest</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">-------------------------------------------</span>

    <span class="o">-</span> <span class="n">ENUM_MotionRequest</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">2</span> <span class="n">pragmas</span>


<span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">--------------------------------------------</span>

    <span class="o">-</span> <span class="n">ENUM_StageBrakeMode</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">2</span> <span class="n">pragmas</span>


<span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">---------------------------------------------</span>

    <span class="o">-</span> <span class="n">ENUM_StageEnableMode</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">2</span> <span class="n">pragmas</span>


<span class="n">DUTs</span><span class="o">/</span><span class="n">DUT_MotionPneumaticActuator</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">----------------------------------------------------</span>

    <span class="o">-</span> <span class="n">DUT_MotionPneumaticActuator</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">18</span> <span class="n">pragmas</span>


<span class="n">DUTs</span><span class="o">/</span><span class="n">ENUM_PnuematicActuatorPositionState</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">------------------------------------------------------------</span>

    <span class="o">-</span> <span class="n">ENUM_PnuematicActuatorPositionState</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">2</span> <span class="n">pragmas</span>


<span class="n">POUs</span><span class="o">/</span><span class="n">Deprecated</span><span class="o">/</span><span class="n">FB_StatePTPMove</span><span class="o">.</span><span class="n">TcPOU</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">---------------------------------------------------</span>

    <span class="o">-</span> <span class="n">FB_StatePTPMove</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">7</span> <span class="n">pragmas</span>


<span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">FB_MotionPneumaticActuator</span><span class="o">.</span><span class="n">TcPOU</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">----------------------------------------------------------</span>

    <span class="o">-</span> <span class="n">FB_MotionPneumaticActuator</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">3</span> <span class="n">pragmas</span>


<span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">States</span><span class="o">/</span><span class="n">FB_EpicsInOut</span><span class="o">.</span><span class="n">TcPOU</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">----------------------------------------------------</span>

    <span class="o">-</span> <span class="n">FB_EpicsInOut</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">3</span> <span class="n">pragmas</span>


<span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">States</span><span class="o">/</span><span class="n">FB_PositionStateManager</span><span class="o">.</span><span class="n">TcPOU</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">--------------------------------------------------------------</span>

    <span class="o">-</span> <span class="n">FB_PositionStateManager</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">7</span> <span class="n">pragmas</span>


<span class="n">POUs</span><span class="o">/</span><span class="n">Motion</span><span class="o">/</span><span class="n">States</span><span class="o">/</span><span class="n">FB_PositionStateMove</span><span class="o">.</span><span class="n">TcPOU</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">-----------------------------------------------------------</span>

    <span class="o">-</span> <span class="n">FB_PositionStateMove</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">9</span> <span class="n">pragmas</span>


<span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ErrorHandling</span><span class="o">/</span><span class="n">DUT_ErrorState</span><span class="o">.</span><span class="n">TcDUT</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">--------------------------------------------------------------------</span>

    <span class="o">-</span> <span class="n">DUT_ErrorState</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">2</span> <span class="n">pragmas</span>


<span class="n">tc_mca_std_lib</span><span class="o">/</span><span class="n">POUs</span><span class="o">/</span><span class="n">ErrorHandling</span><span class="o">/</span><span class="n">GVL_ErrorSystem</span><span class="o">.</span><span class="n">TcGVL</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------</span>

    <span class="o">-</span> <span class="n">GVL_ErrorSystem</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">pragmas</span>


<span class="n">UnitTests</span><span class="o">/</span><span class="n">Interactive</span><span class="o">.</span><span class="n">TcPOU</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">-----------------------------------------</span>

    <span class="o">-</span> <span class="n">Interactive</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">pragmas</span>


<span class="n">Version</span><span class="o">/</span><span class="n">Global_Version</span><span class="o">.</span><span class="n">TcGVL</span> <span class="p">(</span><span class="n">TcPlcObject</span><span class="p">)</span>
<span class="o">------------------------------------------</span>

    <span class="o">-</span> <span class="n">Global_Version</span><span class="p">:</span> <span class="n">Declaration</span> <span class="o">-</span> <span class="mi">3</span> <span class="n">pragmas</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pcdshub/lcls-twincat-motion</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Library.tmc.html">Library.tmc</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PLC Project (1): Library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dut-dut-axisstatus-v0-01">DUT: DUT_AxisStatus_v0_01</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-dut-errorstate">DUT: DUT_ErrorState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-dut-motionpneumaticactuator">DUT: DUT_MotionPneumaticActuator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-dut-motionstage">DUT: DUT_MotionStage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-dut-positionstate">DUT: DUT_PositionState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-dut-terminalerror">DUT: DUT_TerminalError</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-el5042-status">DUT: EL5042_Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-enum-epicshomecmd">DUT: ENUM_EpicsHomeCmd</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-enum-epicsinout">DUT: ENUM_EpicsInOut</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-enum-epicsmotorcmd">DUT: ENUM_EpicsMotorCmd</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-enum-motionrequest">DUT: ENUM_MotionRequest</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-enum-pnuematicactuatorpositionstate">DUT: ENUM_PnuematicActuatorPositionState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-enum-stagebrakemode">DUT: ENUM_StageBrakeMode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-enum-stageenablemode">DUT: ENUM_StageEnableMode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-st-errorsystem">DUT: ST_ErrorSystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-st-renishawabsenc">DUT: ST_RenishawAbsEnc</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-dutel2521-ctrl">DUT: dutEL2521_Ctrl</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-dutel2521-status">DUT: dutEL2521_Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-gvl">GVL: GVL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-gvl-errorsystem">GVL: GVL_ErrorSystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-global-version">GVL: Global_Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-basictests">POU: BasicTests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-checkbounds">POU: CheckBounds</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-checkdivdint">POU: CheckDivDInt</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-checkdivlint">POU: CheckDivLInt</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-checkdivlreal">POU: CheckDivLReal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-checkdivreal">POU: CheckDivReal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-ek1200">POU: EK1200</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el1008">POU: EL1008</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el1018">POU: EL1018</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el1808">POU: EL1808</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el1809">POU: EL1809</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el1819">POU: EL1819</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el2014">POU: EL2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el2252">POU: EL2252</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el2808">POU: EL2808</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el2819">POU: EL2819</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el3174-0002">POU: EL3174_0002</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el3214">POU: EL3214</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el3255">POU: EL3255</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el5002">POU: EL5002</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el5021">POU: EL5021</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el5042">POU: EL5042</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el5101">POU: EL5101</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el7211-v1-00">POU: EL7211_v1_00</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el9410">POU: EL9410</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el9505">POU: EL9505</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-el9576-v1-00">POU: EL9576_v1_00</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-calculatefrequency-3702-v0-01">POU: FB_CalculateFrequency_3702_v0_01</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-drivevirtual">POU: FB_DriveVirtual</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-el1252asm-v1-00">POU: FB_EL1252ASM_v1_00</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-epicsinout">POU: FB_EpicsInOut</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-errorlist">POU: FB_ErrorList</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-gantryautocoupling">POU: FB_GantryAutoCoupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-gantrydiffvirtuallimitswitch">POU: FB_GantryDiffVirtualLimitSwitch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-homedirect">POU: FB_HomeDirect</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-homefinish">POU: FB_HomeFinish</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-homeprepare">POU: FB_HomePrepare</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-homereadncvelocities">POU: FB_HomeReadNcVelocities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-homereadsoftlimenable">POU: FB_HomeReadSoftLimEnable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-hometoswitch">POU: FB_HomeToSwitch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-homevirtual">POU: FB_HomeVirtual</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-homewritencvelocities">POU: FB_HomeWriteNcVelocities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-homewritesoftlimenable">POU: FB_HomeWriteSoftLimEnable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-microstepcounttest">POU: FB_MicroStepCountTest</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-motionpneumaticactuator">POU: FB_MotionPneumaticActuator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-motionrequest">POU: FB_MotionRequest</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-motionstage">POU: FB_MotionStage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-motionstagesim">POU: FB_MotionStageSim</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-ncaxis">POU: FB_NcAxis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-positionstatelock">POU: FB_PositionStateLock</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-positionstatemanager">POU: FB_PositionStateManager</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-positionstatemove">POU: FB_PositionStateMove</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-readfloatparameter">POU: FB_ReadFloatParameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-readparameterinnc-v1-00">POU: FB_ReadParameterInNc_v1_00</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-setenables">POU: FB_SetEnables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-stateptpmove">POU: FB_StatePTPMove</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-terminalerror">POU: FB_TerminalError</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-writefloatparameter">POU: FB_WriteFloatParameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-fb-writeparameterinnc-v1-00">POU: FB_WriteParameterInNc_v1_00</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-f-atpositionstate">POU: F_AtPositionState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-f-motionerrorcodelookup">POU: F_MotionErrorCodeLookup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pou-interactive">POU: Interactive</a></li>
<li class="toctree-l2"><a class="reference internal" href="#symbols">Symbols</a></li>
<li class="toctree-l2"><a class="reference internal" href="#boxes">Boxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nc-axes">NC axes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#links">Links</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pragma-lint-results">Pragma lint results</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="Library.tmc.html" title="previous chapter">Library.tmc</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, SLAC National Accelerator Laboratory.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/lcls-twincat-motion.tsproj.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>